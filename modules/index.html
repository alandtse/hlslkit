
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tools for automating HLSL shader compilation, diagnostics, and define management.">
      
      
        <meta name="author" content="Alan Tse">
      
      
        <link rel="canonical" href="https://alandtse.github.io/hlslkit/modules/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../CONTRIBUTING/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Modules - hlslkit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hlslkit.buffer_scan" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="hlslkit" class="md-header__button md-logo" aria-label="hlslkit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            hlslkit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Modules
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/alandtse/hlslkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    alandtse/hlslkit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="hlslkit" class="md-nav__button md-logo" aria-label="hlslkit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    hlslkit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/alandtse/hlslkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    alandtse/hlslkit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan" class="md-nav__link">
    <span class="md-ellipsis">
      buffer_scan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.AnalysisLink" class="md-nav__link">
    <span class="md-ellipsis">
      AnalysisLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner" class="md-nav__link">
    <span class="md-ellipsis">
      FileScanner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileScanner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner.scan_for_buffers" class="md-nav__link">
    <span class="md-ellipsis">
      scan_for_buffers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner.scan_for_structs" class="md-nav__link">
    <span class="md-ellipsis">
      scan_for_structs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      StructAnalyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StructAnalyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.add_buffer_location" class="md-nav__link">
    <span class="md-ellipsis">
      add_buffer_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.compare_all_structs" class="md-nav__link">
    <span class="md-ellipsis">
      compare_all_structs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.find_struct_candidates" class="md-nav__link">
    <span class="md-ellipsis">
      find_struct_candidates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.get_buffer_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_buffer_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.get_field_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.get_nested_fields" class="md-nav__link">
    <span class="md-ellipsis">
      get_nested_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.print_comparison_tables" class="md-nav__link">
    <span class="md-ellipsis">
      print_comparison_tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.update_result_map" class="md-nav__link">
    <span class="md-ellipsis">
      update_result_map
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructCandidate" class="md-nav__link">
    <span class="md-ellipsis">
      StructCandidate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructMatch" class="md-nav__link">
    <span class="md-ellipsis">
      StructMatch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StructMatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructMatch.is_matched" class="md-nav__link">
    <span class="md-ellipsis">
      is_matched
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.add_debug_info" class="md-nav__link">
    <span class="md-ellipsis">
      add_debug_info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.are_fields_equivalent" class="md-nav__link">
    <span class="md-ellipsis">
      are_fields_equivalent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.calculate_hlsl_struct_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_hlsl_struct_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.calculate_struct_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_struct_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.capture_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      capture_pattern
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.clean_body" class="md-nav__link">
    <span class="md-ellipsis">
      clean_body
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.clear_debug_info" class="md-nav__link">
    <span class="md-ellipsis">
      clear_debug_info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.compute_match_score" class="md-nav__link">
    <span class="md-ellipsis">
      compute_match_score
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.compute_name_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      compute_name_similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.compute_struct_alignment" class="md-nav__link">
    <span class="md-ellipsis">
      compute_struct_alignment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.count_field_differences" class="md-nav__link">
    <span class="md-ellipsis">
      count_field_differences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.create_link" class="md-nav__link">
    <span class="md-ellipsis">
      create_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.create_struct_analysis_link" class="md-nav__link">
    <span class="md-ellipsis">
      create_struct_analysis_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.create_struct_section_id" class="md-nav__link">
    <span class="md-ellipsis">
      create_struct_section_id
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_cpp_structs" class="md-nav__link">
    <span class="md-ellipsis">
      extract_cpp_structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_hlsl_structs" class="md-nav__link">
    <span class="md-ellipsis">
      extract_hlsl_structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_matrix_size" class="md-nav__link">
    <span class="md-ellipsis">
      extract_matrix_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_structs" class="md-nav__link">
    <span class="md-ellipsis">
      extract_structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.finditer_with_line_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      finditer_with_line_numbers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.fuzzy_lcs" class="md-nav__link">
    <span class="md-ellipsis">
      fuzzy_lcs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.generate_comparison_table" class="md-nav__link">
    <span class="md-ellipsis">
      generate_comparison_table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_defines_list" class="md-nav__link">
    <span class="md-ellipsis">
      get_defines_list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_excluded_dirs" class="md-nav__link">
    <span class="md-ellipsis">
      get_excluded_dirs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_field_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_field_size" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_hlsl_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_hlsl_types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_struct_signature" class="md-nav__link">
    <span class="md-ellipsis">
      get_struct_signature
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.is_padding_field" class="md-nav__link">
    <span class="md-ellipsis">
      is_padding_field
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.normalize_array_types" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_array_types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.normalize_field_type" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_field_type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.parse_type_with_array" class="md-nav__link">
    <span class="md-ellipsis">
      parse_type_with_array
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.preprocess_content" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.print_buffers_and_conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      print_buffers_and_conflicts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.process_file" class="md-nav__link">
    <span class="md-ellipsis">
      process_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.scan_files" class="md-nav__link">
    <span class="md-ellipsis">
      scan_files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.strip_array_notation" class="md-nav__link">
    <span class="md-ellipsis">
      strip_array_notation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders" class="md-nav__link">
    <span class="md-ellipsis">
      compile_shaders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.ErrorHandler" class="md-nav__link">
    <span class="md-ellipsis">
      ErrorHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErrorHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.ErrorHandler.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler" class="md-nav__link">
    <span class="md-ellipsis">
      IssueHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IssueHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler.add_to_instances" class="md-nav__link">
    <span class="md-ellipsis">
      add_to_instances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler.create_issue_data" class="md-nav__link">
    <span class="md-ellipsis">
      create_issue_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler.normalize_location" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_location
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.WarningHandler" class="md-nav__link">
    <span class="md-ellipsis">
      WarningHandler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.adjust_target_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_target_jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.analyze_and_report_results" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_and_report_results
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.build_defines_lookup" class="md-nav__link">
    <span class="md-ellipsis">
      build_defines_lookup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.compile_shader" class="md-nav__link">
    <span class="md-ellipsis">
      compile_shader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.count_fxc_processes" class="md-nav__link">
    <span class="md-ellipsis">
      count_fxc_processes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.flatten_defines" class="md-nav__link">
    <span class="md-ellipsis">
      flatten_defines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.get_file_issue_summary" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_issue_summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.get_instance_count" class="md-nav__link">
    <span class="md-ellipsis">
      get_instance_count
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.get_system_adaptive_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      get_system_adaptive_jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.handle_termination" class="md-nav__link">
    <span class="md-ellipsis">
      handle_termination
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.initialize_compilation" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_compilation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.load_baseline_warnings" class="md-nav__link">
    <span class="md-ellipsis">
      load_baseline_warnings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.log_new_issues" class="md-nav__link">
    <span class="md-ellipsis">
      log_new_issues
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.manage_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      manage_jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.normalize_path" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.parse_args_for_defaults" class="md-nav__link">
    <span class="md-ellipsis">
      parse_args_for_defaults
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.parse_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      parse_arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.parse_shader_configs" class="md-nav__link">
    <span class="md-ellipsis">
      parse_shader_configs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_completed_futures" class="md-nav__link">
    <span class="md-ellipsis">
      process_completed_futures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_single_error" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_error
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_single_warning" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_warning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_warnings_and_errors" class="md-nav__link">
    <span class="md-ellipsis">
      process_warnings_and_errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.run_compilation" class="md-nav__link">
    <span class="md-ellipsis">
      run_compilation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.setup_environment" class="md-nav__link">
    <span class="md-ellipsis">
      setup_environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.submit_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      submit_tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.validate_shader_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_shader_inputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines" class="md-nav__link">
    <span class="md-ellipsis">
      generate_shader_defines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.CompilationTask" class="md-nav__link">
    <span class="md-ellipsis">
      CompilationTask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.collect_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      collect_tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.collect_warnings_and_errors" class="md-nav__link">
    <span class="md-ellipsis">
      collect_warnings_and_errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.compute_common_defines" class="md-nav__link">
    <span class="md-ellipsis">
      compute_common_defines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.count_compiling_lines" class="md-nav__link">
    <span class="md-ellipsis">
      count_compiling_lines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.count_log_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      count_log_blocks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.generate_yaml_data" class="md-nav__link">
    <span class="md-ellipsis">
      generate_yaml_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.get_shader_type_from_entry" class="md-nav__link">
    <span class="md-ellipsis">
      get_shader_type_from_entry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.normalize_path" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.optimize_anchor_deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_anchor_deduplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.parse_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      parse_arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.parse_log" class="md-nav__link">
    <span class="md-ellipsis">
      parse_log
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.parse_timestamp" class="md-nav__link">
    <span class="md-ellipsis">
      parse_timestamp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.populate_configs" class="md-nav__link">
    <span class="md-ellipsis">
      populate_configs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.save_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      save_yaml
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan" class="md-nav__link">
    <span class="md-ellipsis">
      buffer_scan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.AnalysisLink" class="md-nav__link">
    <span class="md-ellipsis">
      AnalysisLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner" class="md-nav__link">
    <span class="md-ellipsis">
      FileScanner
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileScanner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner.scan_for_buffers" class="md-nav__link">
    <span class="md-ellipsis">
      scan_for_buffers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.FileScanner.scan_for_structs" class="md-nav__link">
    <span class="md-ellipsis">
      scan_for_structs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      StructAnalyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StructAnalyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.add_buffer_location" class="md-nav__link">
    <span class="md-ellipsis">
      add_buffer_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.compare_all_structs" class="md-nav__link">
    <span class="md-ellipsis">
      compare_all_structs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.find_struct_candidates" class="md-nav__link">
    <span class="md-ellipsis">
      find_struct_candidates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.get_buffer_location" class="md-nav__link">
    <span class="md-ellipsis">
      get_buffer_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.get_field_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.get_nested_fields" class="md-nav__link">
    <span class="md-ellipsis">
      get_nested_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.print_comparison_tables" class="md-nav__link">
    <span class="md-ellipsis">
      print_comparison_tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructAnalyzer.update_result_map" class="md-nav__link">
    <span class="md-ellipsis">
      update_result_map
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructCandidate" class="md-nav__link">
    <span class="md-ellipsis">
      StructCandidate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructMatch" class="md-nav__link">
    <span class="md-ellipsis">
      StructMatch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StructMatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.StructMatch.is_matched" class="md-nav__link">
    <span class="md-ellipsis">
      is_matched
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.add_debug_info" class="md-nav__link">
    <span class="md-ellipsis">
      add_debug_info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.are_fields_equivalent" class="md-nav__link">
    <span class="md-ellipsis">
      are_fields_equivalent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.calculate_hlsl_struct_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_hlsl_struct_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.calculate_struct_size" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_struct_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.capture_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      capture_pattern
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.clean_body" class="md-nav__link">
    <span class="md-ellipsis">
      clean_body
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.clear_debug_info" class="md-nav__link">
    <span class="md-ellipsis">
      clear_debug_info
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.compute_match_score" class="md-nav__link">
    <span class="md-ellipsis">
      compute_match_score
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.compute_name_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      compute_name_similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.compute_struct_alignment" class="md-nav__link">
    <span class="md-ellipsis">
      compute_struct_alignment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.count_field_differences" class="md-nav__link">
    <span class="md-ellipsis">
      count_field_differences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.create_link" class="md-nav__link">
    <span class="md-ellipsis">
      create_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.create_struct_analysis_link" class="md-nav__link">
    <span class="md-ellipsis">
      create_struct_analysis_link
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.create_struct_section_id" class="md-nav__link">
    <span class="md-ellipsis">
      create_struct_section_id
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_cpp_structs" class="md-nav__link">
    <span class="md-ellipsis">
      extract_cpp_structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_hlsl_structs" class="md-nav__link">
    <span class="md-ellipsis">
      extract_hlsl_structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_matrix_size" class="md-nav__link">
    <span class="md-ellipsis">
      extract_matrix_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.extract_structs" class="md-nav__link">
    <span class="md-ellipsis">
      extract_structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.finditer_with_line_numbers" class="md-nav__link">
    <span class="md-ellipsis">
      finditer_with_line_numbers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.fuzzy_lcs" class="md-nav__link">
    <span class="md-ellipsis">
      fuzzy_lcs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.generate_comparison_table" class="md-nav__link">
    <span class="md-ellipsis">
      generate_comparison_table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_defines_list" class="md-nav__link">
    <span class="md-ellipsis">
      get_defines_list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_excluded_dirs" class="md-nav__link">
    <span class="md-ellipsis">
      get_excluded_dirs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_field_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_similarity
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_field_size" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_size
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_hlsl_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_hlsl_types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.get_struct_signature" class="md-nav__link">
    <span class="md-ellipsis">
      get_struct_signature
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.is_padding_field" class="md-nav__link">
    <span class="md-ellipsis">
      is_padding_field
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.normalize_array_types" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_array_types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.normalize_field_type" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_field_type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.parse_type_with_array" class="md-nav__link">
    <span class="md-ellipsis">
      parse_type_with_array
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.preprocess_content" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.print_buffers_and_conflicts" class="md-nav__link">
    <span class="md-ellipsis">
      print_buffers_and_conflicts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.process_file" class="md-nav__link">
    <span class="md-ellipsis">
      process_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.scan_files" class="md-nav__link">
    <span class="md-ellipsis">
      scan_files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.buffer_scan.strip_array_notation" class="md-nav__link">
    <span class="md-ellipsis">
      strip_array_notation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders" class="md-nav__link">
    <span class="md-ellipsis">
      compile_shaders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.ErrorHandler" class="md-nav__link">
    <span class="md-ellipsis">
      ErrorHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErrorHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.ErrorHandler.process" class="md-nav__link">
    <span class="md-ellipsis">
      process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler" class="md-nav__link">
    <span class="md-ellipsis">
      IssueHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IssueHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler.add_to_instances" class="md-nav__link">
    <span class="md-ellipsis">
      add_to_instances
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler.create_issue_data" class="md-nav__link">
    <span class="md-ellipsis">
      create_issue_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.IssueHandler.normalize_location" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_location
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.WarningHandler" class="md-nav__link">
    <span class="md-ellipsis">
      WarningHandler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.adjust_target_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_target_jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.analyze_and_report_results" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_and_report_results
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.build_defines_lookup" class="md-nav__link">
    <span class="md-ellipsis">
      build_defines_lookup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.compile_shader" class="md-nav__link">
    <span class="md-ellipsis">
      compile_shader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.count_fxc_processes" class="md-nav__link">
    <span class="md-ellipsis">
      count_fxc_processes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.flatten_defines" class="md-nav__link">
    <span class="md-ellipsis">
      flatten_defines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.get_file_issue_summary" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_issue_summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.get_instance_count" class="md-nav__link">
    <span class="md-ellipsis">
      get_instance_count
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.get_system_adaptive_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      get_system_adaptive_jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.handle_termination" class="md-nav__link">
    <span class="md-ellipsis">
      handle_termination
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.initialize_compilation" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_compilation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.load_baseline_warnings" class="md-nav__link">
    <span class="md-ellipsis">
      load_baseline_warnings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.log_new_issues" class="md-nav__link">
    <span class="md-ellipsis">
      log_new_issues
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.manage_jobs" class="md-nav__link">
    <span class="md-ellipsis">
      manage_jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.normalize_path" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.parse_args_for_defaults" class="md-nav__link">
    <span class="md-ellipsis">
      parse_args_for_defaults
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.parse_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      parse_arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.parse_shader_configs" class="md-nav__link">
    <span class="md-ellipsis">
      parse_shader_configs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_completed_futures" class="md-nav__link">
    <span class="md-ellipsis">
      process_completed_futures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_single_error" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_error
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_single_warning" class="md-nav__link">
    <span class="md-ellipsis">
      process_single_warning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.process_warnings_and_errors" class="md-nav__link">
    <span class="md-ellipsis">
      process_warnings_and_errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.run_compilation" class="md-nav__link">
    <span class="md-ellipsis">
      run_compilation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.setup_environment" class="md-nav__link">
    <span class="md-ellipsis">
      setup_environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.submit_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      submit_tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.compile_shaders.validate_shader_inputs" class="md-nav__link">
    <span class="md-ellipsis">
      validate_shader_inputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines" class="md-nav__link">
    <span class="md-ellipsis">
      generate_shader_defines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.CompilationTask" class="md-nav__link">
    <span class="md-ellipsis">
      CompilationTask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.collect_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      collect_tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.collect_warnings_and_errors" class="md-nav__link">
    <span class="md-ellipsis">
      collect_warnings_and_errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.compute_common_defines" class="md-nav__link">
    <span class="md-ellipsis">
      compute_common_defines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.count_compiling_lines" class="md-nav__link">
    <span class="md-ellipsis">
      count_compiling_lines
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.count_log_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      count_log_blocks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.generate_yaml_data" class="md-nav__link">
    <span class="md-ellipsis">
      generate_yaml_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.get_shader_type_from_entry" class="md-nav__link">
    <span class="md-ellipsis">
      get_shader_type_from_entry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.normalize_path" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_path
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.optimize_anchor_deduplication" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_anchor_deduplication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.parse_arguments" class="md-nav__link">
    <span class="md-ellipsis">
      parse_arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.parse_log" class="md-nav__link">
    <span class="md-ellipsis">
      parse_log
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.parse_timestamp" class="md-nav__link">
    <span class="md-ellipsis">
      parse_timestamp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.populate_configs" class="md-nav__link">
    <span class="md-ellipsis">
      populate_configs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlslkit.generate_shader_defines.save_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      save_yaml
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Modules</h1>

<div class="doc doc-object doc-module">



<a id="hlslkit.buffer_scan"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="hlslkit.buffer_scan.AnalysisLink" class="doc doc-heading">
            <code>AnalysisLink</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hlslkit.buffer_scan.AnalysisLink" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Represents a link to struct analysis results.</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AnalysisLink</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a link to struct analysis results.&quot;&quot;&quot;</span>

    <span class="n">link</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">is_match</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">cpp_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cpp_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cpp_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">score</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hlslkit.buffer_scan.FileScanner" class="doc doc-heading">
            <code>FileScanner</code>


<a href="#hlslkit.buffer_scan.FileScanner" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class to handle file scanning operations.</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileScanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle file scanning operations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the scanner with current working directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            cwd: Current working directory path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_dirs</span> <span class="o">=</span> <span class="n">get_excluded_dirs</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_short_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get shortened path relative to skyrim-community-shaders or cwd.&quot;&quot;&quot;</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">full_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">short_path_start</span> <span class="o">=</span> <span class="n">full_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;skyrim-community-shaders&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">short_path_start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">full_path</span><span class="p">[</span><span class="n">short_path_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;skyrim-community-shaders&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_for_buffers</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">feature_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">shader_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">hlsl_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">defines_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scan HLSL files for buffer definitions and track compilation units.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern: Compiled regex pattern to match HLSL files.</span>
<span class="sd">            feature_pattern: Compiled regex pattern to extract feature names.</span>
<span class="sd">            shader_pattern: Compiled regex pattern for buffer definitions.</span>
<span class="sd">            hlsl_types: Mapping of HLSL register types to descriptions.</span>
<span class="sd">            defines_list: List of preprocessor define dictionaries.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            - List of buffer entries</span>
<span class="sd">            - Dictionary of compilation units</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">compilation_units</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">):</span>
            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_dirs</span><span class="p">]</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">root_normalized</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">feature_match</span> <span class="o">=</span> <span class="n">feature_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">root_normalized</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">feature_match</span><span class="p">:</span>
                <span class="n">feature</span> <span class="o">=</span> <span class="n">feature_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">)):</span>
                    <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="n">short_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_short_path</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file: </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">defines</span> <span class="ow">in</span> <span class="n">defines_list</span><span class="p">:</span>
                        <span class="n">process_file</span><span class="p">(</span>
                            <span class="n">full_path</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span>
                            <span class="n">defines</span><span class="p">,</span>
                            <span class="n">shader_pattern</span><span class="p">,</span>
                            <span class="n">hlsl_types</span><span class="p">,</span>
                            <span class="n">feature</span><span class="p">,</span>
                            <span class="n">short_path</span><span class="p">,</span>
                            <span class="n">result_map</span><span class="p">,</span>
                            <span class="n">compilation_units</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> buffers&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">compilation_units</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scan_for_structs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scan directory for HLSL and C++ files and extract structs.&quot;&quot;&quot;</span>
        <span class="n">hlsl_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cpp_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">):</span>
            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_dirs</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.cpp&quot;</span><span class="p">,</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="s2">&quot;.hpp&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">)):</span>
                    <span class="k">continue</span>
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">short_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_short_path</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
                    <span class="n">is_hlsl</span> <span class="o">=</span> <span class="n">full_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">))</span>
                    <span class="n">structs</span> <span class="o">=</span> <span class="n">extract_structs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">is_hlsl</span><span class="p">,</span> <span class="n">short_path</span><span class="p">)</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">hlsl_structs</span> <span class="k">if</span> <span class="n">is_hlsl</span> <span class="k">else</span> <span class="n">cpp_structs</span>
                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">is_shader_io_struct</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping shader IO buffer: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid struct data for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

                        <span class="c1"># Check if we already have a real definition and this is a template</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">target</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                            <span class="c1"># Check if any existing definition is not a template (has fields)</span>
                            <span class="n">has_real_definition</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                                <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">existing</span> <span class="ow">in</span> <span class="n">target</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">has_real_definition</span><span class="p">:</span>
                                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping template </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> - real struct definition already exists&quot;</span><span class="p">)</span>
                                <span class="k">continue</span>

                        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
                            <span class="n">target</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">target</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="s1">&#39;hlsl&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_hlsl</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;cpp&#39;</span><span class="si">}</span><span class="s2"> structs&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read or process file </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hlsl_structs</span><span class="p">,</span> <span class="n">cpp_structs</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.FileScanner.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.FileScanner.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the scanner with current working directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cwd</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current working directory path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the scanner with current working directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        cwd: Current working directory path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span> <span class="o">=</span> <span class="n">cwd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_dirs</span> <span class="o">=</span> <span class="n">get_excluded_dirs</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.FileScanner.scan_for_buffers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan_for_buffers</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">feature_pattern</span><span class="p">,</span> <span class="n">shader_pattern</span><span class="p">,</span> <span class="n">hlsl_types</span><span class="p">,</span> <span class="n">defines_list</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.FileScanner.scan_for_buffers" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Scan HLSL files for buffer definitions and track compilation units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pattern</code></td>
            <td>
                  <code><span title="re.Pattern">Pattern</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compiled regex pattern to match HLSL files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>feature_pattern</code></td>
            <td>
                  <code><span title="re.Pattern">Pattern</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compiled regex pattern to extract feature names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_pattern</code></td>
            <td>
                  <code><span title="re.Pattern">Pattern</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compiled regex pattern for buffer definitions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_types</code></td>
            <td>
                  <code>dict[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of HLSL register types to descriptions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>defines_list</code></td>
            <td>
                  <code>list[dict[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of preprocessor define dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[dict[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>dict[tuple[str, frozenset[str]], dict[str, set[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>List of buffer entries</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[list[dict[str, <span title="typing.Any">Any</span>]], dict[tuple[str, frozenset[str]], dict[str, set[str]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>Dictionary of compilation units</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">scan_for_buffers</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">feature_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">shader_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">hlsl_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">defines_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan HLSL files for buffer definitions and track compilation units.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern: Compiled regex pattern to match HLSL files.</span>
<span class="sd">        feature_pattern: Compiled regex pattern to extract feature names.</span>
<span class="sd">        shader_pattern: Compiled regex pattern for buffer definitions.</span>
<span class="sd">        hlsl_types: Mapping of HLSL register types to descriptions.</span>
<span class="sd">        defines_list: List of preprocessor define dictionaries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - List of buffer entries</span>
<span class="sd">        - Dictionary of compilation units</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">compilation_units</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">):</span>
        <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_dirs</span><span class="p">]</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">root_normalized</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">feature_match</span> <span class="o">=</span> <span class="n">feature_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">root_normalized</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">feature_match</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">feature_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">)):</span>
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="n">short_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_short_path</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file: </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">defines</span> <span class="ow">in</span> <span class="n">defines_list</span><span class="p">:</span>
                    <span class="n">process_file</span><span class="p">(</span>
                        <span class="n">full_path</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span>
                        <span class="n">defines</span><span class="p">,</span>
                        <span class="n">shader_pattern</span><span class="p">,</span>
                        <span class="n">hlsl_types</span><span class="p">,</span>
                        <span class="n">feature</span><span class="p">,</span>
                        <span class="n">short_path</span><span class="p">,</span>
                        <span class="n">result_map</span><span class="p">,</span>
                        <span class="n">compilation_units</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> buffers&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">compilation_units</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.FileScanner.scan_for_structs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan_for_structs</span><span class="p">()</span></code>

<a href="#hlslkit.buffer_scan.FileScanner.scan_for_structs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Scan directory for HLSL and C++ files and extract structs.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">scan_for_structs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan directory for HLSL and C++ files and extract structs.&quot;&quot;&quot;</span>
    <span class="n">hlsl_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cpp_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">):</span>
        <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_dirs</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.cpp&quot;</span><span class="p">,</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="s2">&quot;.hpp&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">short_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_short_path</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
                <span class="n">is_hlsl</span> <span class="o">=</span> <span class="n">full_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">))</span>
                <span class="n">structs</span> <span class="o">=</span> <span class="n">extract_structs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">is_hlsl</span><span class="p">,</span> <span class="n">short_path</span><span class="p">)</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">hlsl_structs</span> <span class="k">if</span> <span class="n">is_hlsl</span> <span class="k">else</span> <span class="n">cpp_structs</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">is_shader_io_struct</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping shader IO buffer: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid struct data for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

                    <span class="c1"># Check if we already have a real definition and this is a template</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">target</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="c1"># Check if any existing definition is not a template (has fields)</span>
                        <span class="n">has_real_definition</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
                            <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">existing</span> <span class="ow">in</span> <span class="n">target</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">has_real_definition</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping template </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> - real struct definition already exists&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
                        <span class="n">target</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">target</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="s1">&#39;hlsl&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_hlsl</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;cpp&#39;</span><span class="si">}</span><span class="s2"> structs&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read or process file </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hlsl_structs</span><span class="p">,</span> <span class="n">cpp_structs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hlslkit.buffer_scan.StructAnalyzer" class="doc doc-heading">
            <code>StructAnalyzer</code>


<a href="#hlslkit.buffer_scan.StructAnalyzer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class to handle struct comparison and analysis.</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StructAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle struct comparison and analysis.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hlsl_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]],</span>
        <span class="n">cpp_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]],</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hlsl_structs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpp_structs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructDict</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cpp_structs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">composite_buffers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comparison_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store analysis links</span>
        <span class="n">hlsl_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">struct_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">struct_list</span> <span class="ow">in</span> <span class="n">hlsl_structs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">cpp_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">struct_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">struct_list</span> <span class="ow">in</span> <span class="n">cpp_structs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initialized with </span><span class="si">{</span><span class="n">hlsl_count</span><span class="si">}</span><span class="s2"> HLSL structs and </span><span class="si">{</span><span class="n">cpp_count</span><span class="si">}</span><span class="s2"> C++ structs&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_buffer_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a buffer location to the map.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: File path</span>
<span class="sd">            buffer_name: Name of the buffer</span>
<span class="sd">            line: Line number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">buffer_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added buffer location: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> -&gt; (</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_buffer_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the location of a buffer.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: File path</span>
<span class="sd">            buffer_name: Name of the buffer</span>
<span class="sd">            line: Line number</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[str, int] | None: (file, line) tuple if found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">buffer_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_composite_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_cbuffer&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># At least one field is a user-defined struct type</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span> <span class="ow">and</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_composite_buffer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">buffer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">buffer_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">,</span>
        <span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">matched_cpp_structs</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">buffer_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">composite_buffers</span><span class="p">[</span><span class="n">buffer_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Processing composite buffer </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> with contained structs: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">composite_buffers</span><span class="p">[</span><span class="n">buffer_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># --- Process sub-buffers first ---</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">struct_type</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">struct_type</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Field </span><span class="si">{</span><span class="n">field</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> with built-in type </span><span class="si">{</span><span class="n">struct_type</span><span class="si">}</span><span class="s2"> in composite buffer </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;at </span><span class="si">{</span><span class="n">buffer_data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">buffer_data</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> will be skipped&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">struct_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">struct_data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">[</span><span class="n">struct_type</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">struct_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid struct_data for </span><span class="si">{</span><span class="n">struct_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">struct_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="n">struct_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">struct_data</span><span class="p">)</span>
                    <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_struct_candidates</span><span class="p">(</span>
                        <span class="n">struct_type</span><span class="p">,</span> <span class="n">struct_data</span><span class="p">,</span> <span class="n">struct_fields</span><span class="p">,</span> <span class="n">matched_cpp_structs</span>
                    <span class="p">)</span>
                    <span class="c1"># Use shared helper to find best match without score boosts for sub-structs</span>
                    <span class="n">best_match</span><span class="p">,</span> <span class="n">sorted_candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_match_from_candidates</span><span class="p">(</span>
                        <span class="n">struct_type</span><span class="p">,</span> <span class="n">struct_data</span><span class="p">,</span> <span class="n">struct_fields</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">apply_score_boosts</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">best_match</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_match_good_enough</span><span class="p">(</span>
                        <span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="n">sorted_candidates</span><span class="p">,</span> <span class="n">struct_type</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span>
                    <span class="p">):</span>
                        <span class="n">unique_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">matched_cpp_structs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">unique_id</span><span class="p">)</span>
                        <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_match</span><span class="p">)</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Best match for sub-struct </span><span class="si">{</span><span class="n">struct_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (score=</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">) from </span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_line</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;No suitable C++ struct found for &#39;</span><span class="si">{</span><span class="n">struct_type</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Field type </span><span class="si">{</span><span class="n">struct_type</span><span class="si">}</span><span class="s2"> in composite buffer </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;at </span><span class="si">{</span><span class="n">buffer_data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">buffer_data</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> not found in hlsl_structs&quot;</span>
                <span class="p">)</span>

        <span class="c1"># --- Now update fields and size ---</span>
        <span class="n">hlsl_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">buffer_data</span><span class="p">)</span>
        <span class="n">buffer_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hlsl_fields</span>

        <span class="n">buffer_data</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">align_to_16</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Updated composite buffer </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> size to </span><span class="si">{</span><span class="n">buffer_data</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> bytes (fields: </span><span class="si">{</span><span class="p">[(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">hlsl_fields</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># --- Now match the composite buffer itself ---</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_struct_candidates</span><span class="p">(</span><span class="n">buffer_name</span><span class="p">,</span> <span class="n">buffer_data</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">matched_cpp_structs</span><span class="p">)</span>

        <span class="c1"># Use shared helper to find best match without score boosts for composite buffer</span>
        <span class="n">best_match</span><span class="p">,</span> <span class="n">sorted_candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_match_from_candidates</span><span class="p">(</span>
            <span class="n">buffer_name</span><span class="p">,</span> <span class="n">buffer_data</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">apply_score_boosts</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">best_match</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_match_good_enough</span><span class="p">(</span>
            <span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="n">sorted_candidates</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span>
        <span class="p">):</span>
            <span class="n">unique_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">matched_cpp_structs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">unique_id</span><span class="p">)</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_match</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No suitable C++ struct found for composite buffer &#39;</span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="n">buffer_data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">buffer_data</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_comparison_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructMatch</span><span class="p">],</span> <span class="n">print_tables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comparison tables for all matches.</span>

<span class="sd">        Args:</span>
<span class="sd">            matches: List of StructMatch objects.</span>
<span class="sd">            print_tables: Whether to print the tables immediately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comparison_tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span> <span class="ow">and</span> <span class="n">print_tables</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No matching structs found between HLSL and C++.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">composite_matches</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructMatch</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">regular_matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructMatch</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2"> comparison tables&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">hlsl_name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span>
            <span class="n">found_in_composite</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">composite_name</span><span class="p">,</span> <span class="n">contained_structs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composite_buffers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">hlsl_name</span> <span class="ow">in</span> <span class="n">contained_structs</span> <span class="ow">or</span> <span class="n">hlsl_name</span> <span class="o">==</span> <span class="n">composite_name</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">composite_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">composite_matches</span><span class="p">:</span>
                        <span class="n">composite_matches</span><span class="p">[</span><span class="n">composite_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">composite_matches</span><span class="p">[</span><span class="n">composite_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                    <span class="n">found_in_composite</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found_in_composite</span><span class="p">:</span>
                <span class="n">regular_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">regular_matches</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_single_comparison_table</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">print_tables</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">composite_name</span><span class="p">,</span> <span class="n">comp_matches</span> <span class="ow">in</span> <span class="n">composite_matches</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">print_tables</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Composite Buffer: </span><span class="si">{</span><span class="n">composite_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Find the match for the composite buffer itself</span>
                <span class="n">comp_match</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">comp_matches</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">hlsl_name</span> <span class="o">==</span> <span class="n">composite_name</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">comp_match</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_generate_single_comparison_table</span><span class="p">(</span><span class="n">comp_match</span><span class="p">,</span> <span class="n">print_tables</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Select the first StructDict for the composite buffer</span>
                    <span class="n">comp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">composite_name</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">comp_data</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data found for composite buffer </span><span class="si">{</span><span class="n">composite_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;**HLSL File:** [</span><span class="si">{</span><span class="n">comp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">comp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">create_link</span><span class="p">(</span><span class="n">comp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">comp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**Best Match:** None</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">comp_matches</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span> <span class="o">!=</span> <span class="n">composite_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_generate_single_comparison_table</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">print_tables</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_match_good_enough</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">score</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">hlsl_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">cpp_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Improved match quality assessment with more nuanced criteria.&quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

        <span class="c1"># 1. Absolute minimum score threshold (lowered)</span>
        <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># Reduced from 0.6</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: score </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> below threshold 0.5&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># 2. Enhanced field count analysis</span>
        <span class="n">total_fields</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_fields&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cpp_total_fields</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpp_total_fields&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">field_count_ratio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_fields</span><span class="p">,</span> <span class="n">cpp_total_fields</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">total_fields</span><span class="p">,</span> <span class="n">cpp_total_fields</span><span class="p">)</span>

        <span class="c1"># More lenient for small structs</span>
        <span class="n">min_ratio</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">total_fields</span><span class="p">,</span> <span class="n">cpp_total_fields</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="mf">0.6</span>
        <span class="k">if</span> <span class="n">field_count_ratio</span> <span class="o">&lt;</span> <span class="n">min_ratio</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Rejected match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: field count ratio </span><span class="si">{</span><span class="n">field_count_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">min_ratio</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># 3. Improved exact match requirements</span>
        <span class="n">exact_matches</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exact_matches&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">high_sim_matches</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_sim_matches&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">total_good_matches</span> <span class="o">=</span> <span class="n">exact_matches</span> <span class="o">+</span> <span class="n">high_sim_matches</span>

        <span class="n">min_fields</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_fields</span><span class="p">,</span> <span class="n">cpp_total_fields</span><span class="p">)</span>

        <span class="c1"># Require at least 30% good matches for small structs, 50% for larger ones</span>
        <span class="n">required_match_ratio</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="k">if</span> <span class="n">min_fields</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="mf">0.5</span>
        <span class="n">good_match_ratio</span> <span class="o">=</span> <span class="n">total_good_matches</span> <span class="o">/</span> <span class="n">min_fields</span> <span class="k">if</span> <span class="n">min_fields</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">good_match_ratio</span> <span class="o">&lt;</span> <span class="n">required_match_ratio</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Rejected match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: good match ratio </span><span class="si">{</span><span class="n">good_match_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">required_match_ratio</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># 4. Name similarity boost for very similar names</span>
        <span class="n">name_sim</span> <span class="o">=</span> <span class="n">compute_name_similarity</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">cpp_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name_sim</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="c1"># Very similar names get more lenient treatment</span>
            <span class="k">return</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mf">0.4</span> <span class="ow">and</span> <span class="n">good_match_ratio</span> <span class="o">&gt;</span> <span class="mf">0.2</span>

        <span class="c1"># 5. Size difference check (more lenient)</span>
        <span class="n">size_difference</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size_difference&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">max_size_diff</span> <span class="o">=</span> <span class="mi">128</span> <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">total_fields</span><span class="p">,</span> <span class="n">cpp_total_fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">else</span> <span class="mi">64</span>
        <span class="k">if</span> <span class="n">size_difference</span> <span class="o">&gt;</span> <span class="n">max_size_diff</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Rejected match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: size difference </span><span class="si">{</span><span class="n">size_difference</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">max_size_diff</span><span class="si">}</span><span class="s2"> bytes&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># 6. Relative candidate quality (more lenient)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
            <span class="c1"># Handle both StructCandidate objects and old tuple format</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">candidates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;score&quot;</span><span class="p">):</span>
                <span class="n">second_best_score</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">score</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">second_best_score</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">score_gap</span> <span class="o">=</span> <span class="n">best_score</span> <span class="o">-</span> <span class="n">second_best_score</span>

            <span class="c1"># Only reject if the best candidate isn&#39;t significantly better AND the score is low</span>
            <span class="k">if</span> <span class="n">score_gap</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="n">best_score</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: insufficient score gap </span><span class="si">{</span><span class="n">score_gap</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compare_all_structs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_map</span><span class="p">:</span> <span class="n">ResultMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare HLSL and C++ structs, generating alignment reports.&quot;&quot;&quot;</span>
        <span class="n">analysis_links</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructMatch</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">matched_cpp_structs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">match_counts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Matched&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Perfect matches</span>
            <span class="s2">&quot;Mismatched&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Partial matches</span>
            <span class="s2">&quot;Unmatched&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># No matches</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No HLSL structs found.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span> <span class="o">=</span> <span class="n">analysis_links</span>
            <span class="k">return</span> <span class="n">analysis_links</span>

        <span class="k">for</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_struct_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">hlsl_data</span> <span class="ow">in</span> <span class="n">hlsl_struct_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid hlsl_data for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">hlsl_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Processing HLSL struct: </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> : size=</span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_composite_buffer</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_process_composite_buffer</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">matched_cpp_structs</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;template_type&quot;</span> <span class="ow">in</span> <span class="n">hlsl_data</span><span class="p">:</span>
                    <span class="n">template_type</span> <span class="o">=</span> <span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;template_type&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">template_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">:</span>
                        <span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">[</span><span class="n">template_type</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
                <span class="n">hlsl_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">hlsl_fields</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Find all potential candidates (including exact name matches)</span>
                <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_struct_candidates</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">matched_cpp_structs</span><span class="p">)</span>

                <span class="c1"># Use shared helper to find best match with score boosts</span>
                <span class="n">best_match</span><span class="p">,</span> <span class="n">sorted_candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_match_from_candidates</span><span class="p">(</span>
                    <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">apply_score_boosts</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

                <span class="c1"># ONLY AFTER finding the best match, check if it&#39;s good enough</span>
                <span class="k">if</span> <span class="n">best_match</span><span class="p">:</span>
                    <span class="c1"># Check if the match is good enough</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_match_good_enough</span><span class="p">(</span>
                        <span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="n">sorted_candidates</span><span class="p">,</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span>
                    <span class="p">):</span>
                        <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_match</span><span class="p">)</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Accepted match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (score=</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># For rejected matches, create a match with empty cpp info but preserve candidate data</span>
                        <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">StructMatch</span><span class="p">(</span>
                                <span class="n">hlsl_name</span><span class="o">=</span><span class="n">hlsl_name</span><span class="p">,</span>
                                <span class="n">hlsl_file</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span>
                                <span class="n">hlsl_line</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">],</span>
                                <span class="n">cpp_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_name indicates rejection</span>
                                <span class="n">cpp_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_file</span>
                                <span class="n">cpp_line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Empty cpp_line</span>
                                <span class="n">score</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Zero score for status determination</span>
                                <span class="n">align_matches</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Empty align_matches for rejected</span>
                                <span class="n">report</span><span class="o">=</span><span class="n">best_match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span>  <span class="c1"># Preserve the actual report from best match</span>
                                <span class="n">candidates</span><span class="o">=</span><span class="n">sorted_candidates</span><span class="p">,</span>  <span class="c1"># Preserve sorted candidates with full alignment info</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Rejected match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (score=</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">) - quality too low&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># No candidates found</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">StructMatch</span><span class="p">(</span>
                            <span class="n">hlsl_name</span><span class="o">=</span><span class="n">hlsl_name</span><span class="p">,</span>
                            <span class="n">hlsl_file</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span>
                            <span class="n">hlsl_line</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">],</span>
                            <span class="n">cpp_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_name</span>
                            <span class="n">cpp_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_file</span>
                            <span class="n">cpp_line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Empty cpp_line</span>
                            <span class="n">score</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Zero score</span>
                            <span class="n">align_matches</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Empty align_matches</span>
                            <span class="n">report</span><span class="o">=</span><span class="p">{</span>  <span class="c1"># Empty report</span>
                                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="s2">&quot;exact_matches&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="s2">&quot;high_sim_matches&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="s2">&quot;total_fields&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">),</span>
                                <span class="s2">&quot;missing_fields&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">),</span>
                            <span class="p">},</span>
                            <span class="n">candidates</span><span class="o">=</span><span class="n">sorted_candidates</span><span class="p">,</span>  <span class="c1"># Empty sorted_candidates</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_comparison_tables</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">print_tables</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Store analysis_links as an attribute for later use in print_comparison_tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span> <span class="o">=</span> <span class="n">analysis_links</span>

        <span class="c1"># Update analysis links in result_map</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># New logic for status:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
                <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Unmatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field_diff_count</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_diff_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">cpp_total_fields</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpp_total_fields&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">hlsl_total_fields</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_fields&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">min_fields</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">hlsl_total_fields</span><span class="p">,</span> <span class="n">cpp_total_fields</span><span class="p">)</span>
                <span class="n">diff_ratio</span> <span class="o">=</span> <span class="n">field_diff_count</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_fields</span><span class="p">)</span>
                <span class="n">debug_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;DEBUG: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: field_diff_count=</span><span class="si">{</span><span class="n">field_diff_count</span><span class="si">}</span><span class="s2">, min_fields=</span><span class="si">{</span><span class="n">min_fields</span><span class="si">}</span><span class="s2">, diff_ratio=</span><span class="si">{</span><span class="n">diff_ratio</span><span class="si">}</span><span class="s2">, score=</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">add_debug_info</span><span class="p">(</span><span class="n">debug_msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">diff_ratio</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">or</span> <span class="n">match</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;</span> <span class="mf">0.75</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
                    <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Unmatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">field_diff_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Matched&quot;</span>
                    <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Matched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">field_diff_count</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mismatched (</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Mismatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mismatched (</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Mismatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">create_struct_analysis_link</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
                <span class="s2">&quot;is_match&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="p">),</span>
                <span class="s2">&quot;cpp_name&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="p">,</span>
                <span class="s2">&quot;cpp_file&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_file</span><span class="p">,</span>
                <span class="s2">&quot;cpp_line&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_line</span><span class="p">,</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># Look for entries using template type for struct analysis</span>
            <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">template_type</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Template Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="c1"># Use template type for struct analysis if available, otherwise use buffer name</span>
                <span class="n">struct_name</span> <span class="o">=</span> <span class="n">template_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">template_type</span> <span class="k">else</span> <span class="n">buffer_name</span>

                <span class="c1"># Check if this buffer entry should link to this struct analysis</span>
                <span class="k">if</span> <span class="n">file_path</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">struct_name</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Updated result_map for </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2"> using template type </span><span class="si">{</span><span class="n">template_type</span><span class="si">}</span><span class="s2"> with link: </span><span class="si">{</span><span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Fallback: try name-only match for user-defined types</span>
                <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">template_type</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Template Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">struct_name</span> <span class="o">=</span> <span class="n">template_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">template_type</span> <span class="k">else</span> <span class="n">buffer_name</span>

                    <span class="k">if</span> <span class="n">struct_name</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
                        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fallback name-only match for </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No buffer table entry found for struct </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;Matching Struct Analysis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buffer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> not matched to any struct&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">analysis_links</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_single_comparison_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match</span><span class="p">:</span> <span class="n">StructMatch</span><span class="p">,</span> <span class="n">print_tables</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a single comparison table.</span>

<span class="sd">        Args:</span>
<span class="sd">            match: StructMatch containing match data.</span>
<span class="sd">            print_tables: Whether to print the table immediately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Use hlsl_data from match if available, else find it</span>
        <span class="n">hlsl_data</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">m</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_line</span>
            <span class="p">),</span>
            <span class="p">{},</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hlsl_data</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No HLSL data found for </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Only use cpp_data if there is a valid match (score &gt; 0 and cpp_name is not empty)</span>
        <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">match</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cpp_data</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">s</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_structs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_file</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_line</span>
                <span class="p">),</span>
                <span class="p">{},</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cpp_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Validate types</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidStructDictType</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidStructDictType</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating table for HLSL </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_line</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>

        <span class="c1"># Convert StructCandidate objects to the format expected by generate_comparison_table</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">candidates</span><span class="p">]</span>

        <span class="n">table_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hlsl_name&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="p">,</span>
            <span class="s2">&quot;cpp_name&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span> <span class="k">if</span> <span class="n">cpp_data</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hlsl_data&quot;</span><span class="p">:</span> <span class="n">hlsl_data</span><span class="p">,</span>
            <span class="s2">&quot;cpp_data&quot;</span><span class="p">:</span> <span class="n">cpp_data</span><span class="p">,</span>
            <span class="s2">&quot;align_matches&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">align_matches</span> <span class="k">if</span> <span class="n">cpp_data</span> <span class="k">else</span> <span class="p">[],</span>
            <span class="s2">&quot;report&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span>
            <span class="s2">&quot;candidates&quot;</span><span class="p">:</span> <span class="n">candidates</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comparison_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_tables</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">generate_comparison_table</span><span class="p">(</span>
                    <span class="k">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="p">,</span>
                    <span class="k">match</span><span class="o">.</span><span class="n">cpp_name</span> <span class="k">if</span> <span class="n">cpp_data</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">hlsl_data</span><span class="p">,</span>
                    <span class="n">cpp_data</span><span class="p">,</span>
                    <span class="k">match</span><span class="o">.</span><span class="n">align_matches</span> <span class="k">if</span> <span class="n">cpp_data</span> <span class="k">else</span> <span class="p">[],</span>
                    <span class="k">match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span>
                    <span class="n">candidates</span><span class="p">,</span>
                    <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">),</span>
                    <span class="n">section_id</span><span class="o">=</span><span class="n">create_struct_section_id</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_comparison_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_matched</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">show_top_candidate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print comparison tables for all HLSL structs, with sub-buffers nested under their parents, using result_map as the source.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Struct Comparison Results&quot;</span><span class="p">)</span>
        <span class="n">printed_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># Build a lookup for table data</span>
        <span class="n">table_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison_tables</span><span class="p">}</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table lookup keys: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">table_lookup</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Build a lookup for composite buffer relationships</span>
        <span class="n">composite_to_subs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">buffer_name</span><span class="p">,</span> <span class="n">sub_names</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composite_buffers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">sub_name</span> <span class="ow">in</span> <span class="n">sub_names</span><span class="p">:</span>
                <span class="c1"># Find the file for the sub-buffer</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison_tables</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_name</span><span class="p">:</span>
                        <span class="n">sub_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">parent_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">composite_to_subs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">sub_key</span>
                        <span class="p">)</span>  <span class="c1"># Use buffer_locations as the source</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buffer locations: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="n">composite_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># If this is a composite buffer, check if any sub-buffers should be printed</span>
            <span class="k">if</span> <span class="n">composite_key</span> <span class="ow">in</span> <span class="n">composite_to_subs</span><span class="p">:</span>
                <span class="n">sub_keys</span> <span class="o">=</span> <span class="n">composite_to_subs</span><span class="p">[</span><span class="n">composite_key</span><span class="p">]</span>
                <span class="c1"># Check if composite or any sub-buffer should be printed</span>
                <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">composite_key</span><span class="p">,</span> <span class="o">*</span><span class="n">sub_keys</span><span class="p">]</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">should_print</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{}</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">only_matched</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;Unmatched&quot;</span>
                    <span class="k">return</span> <span class="kc">True</span>

                <span class="n">should_print_any</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">should_print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">should_print_any</span> <span class="ow">and</span> <span class="n">composite_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">printed_keys</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Composite Buffer: </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Print composite buffer table if present</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">composite_key</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
                        <span class="c1"># Handle show_top_candidate for composite buffer</span>
                        <span class="n">cpp_name</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_name&quot;</span><span class="p">]</span>
                        <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_data&quot;</span><span class="p">]</span>
                        <span class="n">align_matches</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;align_matches&quot;</span><span class="p">]</span>
                        <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                        <span class="c1"># If no accepted match but we want to show top candidate, extract from candidates</span>
                        <span class="k">if</span> <span class="n">show_top_candidate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">]:</span>
                            <span class="n">top_candidate</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Best candidate</span>
                            <span class="n">cpp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">top_candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (top candidate - rejected)&quot;</span>
                            <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="c1"># For regular candidate tuples, use empty alignment data</span>
                            <span class="n">align_matches</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="n">generate_comparison_table</span><span class="p">(</span>
                                    <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span>
                                    <span class="n">cpp_name</span><span class="p">,</span>
                                    <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">],</span>
                                    <span class="n">cpp_data</span><span class="p">,</span>
                                    <span class="n">align_matches</span><span class="p">,</span>
                                    <span class="n">report</span><span class="p">,</span>
                                    <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">],</span>
                                    <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                        <span class="p">{},</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                    <span class="n">show_top_candidate</span><span class="o">=</span><span class="n">show_top_candidate</span><span class="p">,</span>
                                    <span class="n">section_id</span><span class="o">=</span><span class="n">create_struct_section_id</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">][</span><span class="s2">&quot;file&quot;</span><span class="p">]),</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="n">printed_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">composite_key</span><span class="p">)</span>
                    <span class="c1"># Print sub-buffers</span>
                    <span class="k">for</span> <span class="n">sub_key</span> <span class="ow">in</span> <span class="n">sub_keys</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sub_key</span> <span class="ow">in</span> <span class="n">printed_keys</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sub_key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">should_print</span><span class="p">(</span><span class="n">sub_key</span><span class="p">):</span>
                            <span class="c1"># Handle show_top_candidate for sub-buffers</span>
                            <span class="n">cpp_name</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_name&quot;</span><span class="p">]</span>
                            <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_data&quot;</span><span class="p">]</span>
                            <span class="n">align_matches</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;align_matches&quot;</span><span class="p">]</span>
                            <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                            <span class="c1"># If no accepted match but we want to show top candidate, use the first candidate</span>
                            <span class="k">if</span> <span class="n">show_top_candidate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">]:</span>
                                <span class="n">top_candidate</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First candidate should be best after sorting</span>
                                <span class="n">cpp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">top_candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (top candidate - rejected)&quot;</span>
                                <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="c1"># Use the alignment data from the candidate</span>
                                <span class="n">align_matches</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_candidate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[]</span>
                                <span class="n">report</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_candidate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                            <span class="nb">print</span><span class="p">(</span>
                                <span class="n">generate_comparison_table</span><span class="p">(</span>
                                    <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span>
                                    <span class="n">cpp_name</span><span class="p">,</span>
                                    <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">],</span>
                                    <span class="n">cpp_data</span><span class="p">,</span>
                                    <span class="n">align_matches</span><span class="p">,</span>
                                    <span class="n">report</span><span class="p">,</span>
                                    <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">],</span>
                                    <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                        <span class="p">{},</span>
                                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                    <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">printed_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sub_key</span><span class="p">)</span>
            <span class="c1"># Otherwise, print as a regular buffer if not already printed</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_lookup</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking for key_lookup: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key_lookup</span> <span class="ow">in</span> <span class="n">printed_keys</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Already printed: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_lookup</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found table for: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{}</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status for </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">only_matched</span> <span class="ow">and</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;Unmatched&quot;</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping unmatched: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="c1"># Handle show_top_candidate for regular buffers</span>
                    <span class="n">cpp_name</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_name&quot;</span><span class="p">]</span>
                    <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_data&quot;</span><span class="p">]</span>

                    <span class="c1"># If no accepted match but we want to show top candidate, use the first candidate</span>
                    <span class="k">if</span> <span class="n">show_top_candidate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">]:</span>
                        <span class="n">top_candidate</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First candidate should be best after sorting</span>
                        <span class="n">cpp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">top_candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (top candidate - rejected)&quot;</span>
                        <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c1"># Use empty alignment data for simple candidate tuples</span>
                        <span class="n">align_matches</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">align_matches</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;align_matches&quot;</span><span class="p">]</span>
                        <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                    <span class="nb">print</span><span class="p">(</span>
                        <span class="n">generate_comparison_table</span><span class="p">(</span>
                            <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span>
                            <span class="n">cpp_name</span><span class="p">,</span>
                            <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">],</span>
                            <span class="n">cpp_data</span><span class="p">,</span>
                            <span class="n">align_matches</span><span class="p">,</span>
                            <span class="n">report</span><span class="p">,</span>
                            <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">],</span>
                            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">printed_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key_lookup</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No table found for: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_result_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the result map with stored analysis results.</span>

<span class="sd">        Args:</span>
<span class="sd">            result_map: Dictionary mapping keys to buffer metadata, to be updated with analysis links.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_results</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No analysis results available to update result_map&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Create template type mapping</span>
        <span class="n">template_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">struct_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">struct</span> <span class="ow">in</span> <span class="n">struct_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">struct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;template_type&quot;</span> <span class="ow">in</span> <span class="n">struct</span><span class="p">:</span>
                    <span class="n">template_types</span><span class="p">[</span><span class="n">hlsl_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="p">[</span><span class="s2">&quot;template_type&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">analysis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result_map</span><span class="p">:</span>
                <span class="n">result_map</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated result_map for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> with link: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid key format in analysis_results: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">buffer_name</span><span class="p">:</span>
                    <span class="n">result_map</span><span class="p">[</span><span class="n">result_key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matched </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="c1"># Fallback: try file+name match (legacy)</span>
                <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">buffer_name</span><span class="p">:</span>
                    <span class="n">result_map</span><span class="p">[</span><span class="n">result_key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fallback file+name match for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="c1"># Fallback: try name-only match for user-defined types</span>
                <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">buffer_name</span> <span class="ow">and</span> <span class="n">buffer_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
                    <span class="n">result_map</span><span class="p">[</span><span class="n">result_key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fallback name-only match for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No buffer table entry found for struct </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;Matching Struct Analysis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buffer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> not matched to any struct&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nested_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all fields from a struct, including nested struct fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            struct_data: Dictionary containing struct metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[FieldDict]: List of field dictionaries, including nested fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">processed_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Determine which struct dictionary to use based on the struct&#39;s origin</span>
        <span class="n">struct_file</span> <span class="o">=</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">is_cpp_struct</span> <span class="o">=</span> <span class="n">struct_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.cpp&quot;</span><span class="p">,</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="s2">&quot;.hpp&quot;</span><span class="p">))</span>
        <span class="n">struct_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_structs</span> <span class="k">if</span> <span class="n">is_cpp_struct</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">struct_dict</span><span class="p">:</span>
                <span class="c1"># Process each StructDict in the list for nested structs</span>
                <span class="n">nested_structs</span> <span class="o">=</span> <span class="n">struct_dict</span><span class="p">[</span><span class="n">field_type</span><span class="p">]</span>
                <span class="n">struct_file</span> <span class="o">=</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">preferred_struct</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">nested_struct</span> <span class="ow">in</span> <span class="n">nested_structs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested_struct</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid nested struct for </span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">nested_struct</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">nested_struct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">struct_file</span><span class="p">:</span>
                        <span class="n">preferred_struct</span> <span class="o">=</span> <span class="n">nested_struct</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">preferred_struct</span><span class="p">:</span>
                    <span class="n">preferred_struct</span> <span class="o">=</span> <span class="n">nested_structs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># fallback to first if no file match</span>
                <span class="n">nested_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">preferred_struct</span><span class="p">)</span>
                <span class="n">processed_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">nested_fields</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">processed_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">processed_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">FieldDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the field name without array notation.</span>

<span class="sd">        Args:</span>
<span class="sd">            field: Field dictionary containing name information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Field name without array notation.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; analyzer.get_field_name({&quot;name&quot;: &quot;myArray[3]&quot;})</span>
<span class="sd">            &#39;myArray&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid field dictionary: </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">strip_array_notation</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_struct_candidates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hlsl_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hlsl_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">,</span>
        <span class="n">hlsl_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">],</span>
        <span class="n">matched_cpp_structs</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StructDict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find candidate C++ structs for an HLSL struct.</span>

<span class="sd">        Args:</span>
<span class="sd">            hlsl_name: Name of the HLSL struct.</span>
<span class="sd">            hlsl_data: HLSL struct metadata.</span>
<span class="sd">            hlsl_fields: List of HLSL fields.</span>
<span class="sd">            matched_cpp_structs: Set of already matched C++ struct names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[tuple[str, StructDict, float]]: List of (cpp_name, cpp_data, similarity) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StructDict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">cpp_name</span><span class="p">,</span> <span class="n">cpp_struct_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">cpp_data</span> <span class="ow">in</span> <span class="n">cpp_struct_list</span><span class="p">:</span>
                <span class="c1"># Test original version</span>
                <span class="n">original_fields</span> <span class="o">=</span> <span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="n">original_fields</span><span class="p">:</span>
                    <span class="n">temp_cpp_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">)</span>
                    <span class="n">temp_cpp_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_fields</span>

                    <span class="n">result</span> <span class="o">=</span> <span class="n">align_structs</span><span class="p">(</span><span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">alignment_score</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">result</span>
                        <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cpp_name</span><span class="p">,</span> <span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">alignment_score</span><span class="p">))</span>

                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2"> Candidate </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (original) from </span><span class="si">{</span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;alignment_score=</span><span class="si">{</span><span class="n">alignment_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, total_size=</span><span class="si">{</span><span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">original_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">, fields: </span><span class="si">{</span><span class="p">[(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">original_fields</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                <span class="c1"># Test flattened version if different</span>
                <span class="n">flattened_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">flattened_fields</span> <span class="o">!=</span> <span class="n">original_fields</span><span class="p">:</span>
                    <span class="n">temp_cpp_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">)</span>
                    <span class="n">temp_cpp_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flattened_fields</span>
                    <span class="n">temp_cpp_data</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">flattened_fields</span><span class="p">)</span>

                    <span class="n">result</span> <span class="o">=</span> <span class="n">align_structs</span><span class="p">(</span><span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">alignment_score</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">result</span>
                        <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">alignment_score</span><span class="p">))</span>

                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2"> Candidate </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (flattened) from </span><span class="si">{</span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;alignment_score=</span><span class="si">{</span><span class="n">alignment_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, total_size=</span><span class="si">{</span><span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">flattened_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">, fields: </span><span class="si">{</span><span class="p">[(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">flattened_fields</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
        <span class="n">candidates</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">candidates</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_best_match_from_candidates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hlsl_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hlsl_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">,</span>
        <span class="n">hlsl_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">],</span>
        <span class="n">candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StructDict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">apply_score_boosts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">StructMatch</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructCandidate</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the best match among candidates and return StructMatch with candidate list.</span>

<span class="sd">        Args:</span>
<span class="sd">            hlsl_name: Name of the HLSL struct</span>
<span class="sd">            hlsl_data: HLSL struct metadata</span>
<span class="sd">            hlsl_fields: List of HLSL fields</span>
<span class="sd">            candidates: List of (cpp_name, cpp_data, similarity) tuples</span>
<span class="sd">            apply_score_boosts: Whether to apply score boosts for exact name matches and outliers</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: (StructMatch_or_None, list_of_StructCandidates)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>

        <span class="n">evaluated_candidates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">best_match</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">cpp_name</span><span class="p">,</span> <span class="n">cpp_data</span><span class="p">,</span> <span class="n">similarity</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid cpp_data for </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">cpp_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">struct_name_weight</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="mf">0.5</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">align_structs</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">struct_name_weight</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">score</span><span class="p">,</span> <span class="n">align_matches</span><span class="p">,</span> <span class="n">report</span> <span class="o">=</span> <span class="n">result</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: score=</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Apply score boosts if requested</span>
                <span class="k">if</span> <span class="n">apply_score_boosts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cpp_name</span> <span class="o">==</span> <span class="n">hlsl_name</span><span class="p">:</span>
                        <span class="n">score</span> <span class="o">*=</span> <span class="mf">1.05</span>
                    <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="mf">0.85</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">similarity</span> <span class="o">-</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">score</span> <span class="o">*=</span> <span class="mf">1.05</span>

                <span class="c1"># Store evaluated candidate with full alignment info</span>
                <span class="n">candidate</span> <span class="o">=</span> <span class="n">StructCandidate</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">cpp_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">cpp_data</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span> <span class="n">align_matches</span><span class="o">=</span><span class="n">align_matches</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="n">report</span>
                <span class="p">)</span>
                <span class="n">evaluated_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New best match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (score=</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                    <span class="n">best_match</span> <span class="o">=</span> <span class="n">StructMatch</span><span class="p">(</span>
                        <span class="n">hlsl_name</span><span class="o">=</span><span class="n">hlsl_name</span><span class="p">,</span>
                        <span class="n">hlsl_file</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span>
                        <span class="n">hlsl_line</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">],</span>
                        <span class="n">cpp_name</span><span class="o">=</span><span class="n">cpp_name</span><span class="p">,</span>
                        <span class="n">cpp_file</span><span class="o">=</span><span class="n">cpp_data</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span>
                        <span class="n">cpp_line</span><span class="o">=</span><span class="n">cpp_data</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">],</span>
                        <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
                        <span class="n">align_matches</span><span class="o">=</span><span class="n">align_matches</span><span class="p">,</span>
                        <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">,</span>
                        <span class="n">candidates</span><span class="o">=</span><span class="n">evaluated_candidates</span><span class="p">,</span>  <span class="c1"># Will be updated below</span>
                    <span class="p">)</span>

        <span class="c1"># Re-sort candidates by actual evaluation scores</span>
        <span class="n">evaluated_candidates</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Update the match to use sorted candidates</span>
        <span class="k">if</span> <span class="n">best_match</span><span class="p">:</span>
            <span class="n">best_match</span><span class="o">.</span><span class="n">candidates</span> <span class="o">=</span> <span class="n">evaluated_candidates</span>

        <span class="k">return</span> <span class="n">best_match</span><span class="p">,</span> <span class="n">evaluated_candidates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.add_buffer_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_buffer_location</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.add_buffer_location" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add a buffer location to the map.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>buffer_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the buffer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>line</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line number</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_buffer_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a buffer location to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        file: File path</span>
<span class="sd">        buffer_name: Name of the buffer</span>
<span class="sd">        line: Line number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">buffer_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added buffer location: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> -&gt; (</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.compare_all_structs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compare_all_structs</span><span class="p">(</span><span class="n">result_map</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.compare_all_structs" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compare HLSL and C++ structs, generating alignment reports.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_all_structs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_map</span><span class="p">:</span> <span class="n">ResultMap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare HLSL and C++ structs, generating alignment reports.&quot;&quot;&quot;</span>
    <span class="n">analysis_links</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructMatch</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matched_cpp_structs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">match_counts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Matched&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Perfect matches</span>
        <span class="s2">&quot;Mismatched&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Partial matches</span>
        <span class="s2">&quot;Unmatched&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># No matches</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No HLSL structs found.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span> <span class="o">=</span> <span class="n">analysis_links</span>
        <span class="k">return</span> <span class="n">analysis_links</span>

    <span class="k">for</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_struct_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">hlsl_data</span> <span class="ow">in</span> <span class="n">hlsl_struct_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid hlsl_data for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">hlsl_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Processing HLSL struct: </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> : size=</span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_composite_buffer</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_composite_buffer</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">matched_cpp_structs</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;template_type&quot;</span> <span class="ow">in</span> <span class="n">hlsl_data</span><span class="p">:</span>
                <span class="n">template_type</span> <span class="o">=</span> <span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;template_type&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">template_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">:</span>
                    <span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="p">[</span><span class="n">template_type</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span>
            <span class="n">hlsl_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hlsl_fields</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Find all potential candidates (including exact name matches)</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_struct_candidates</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">matched_cpp_structs</span><span class="p">)</span>

            <span class="c1"># Use shared helper to find best match with score boosts</span>
            <span class="n">best_match</span><span class="p">,</span> <span class="n">sorted_candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_match_from_candidates</span><span class="p">(</span>
                <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">apply_score_boosts</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># ONLY AFTER finding the best match, check if it&#39;s good enough</span>
            <span class="k">if</span> <span class="n">best_match</span><span class="p">:</span>
                <span class="c1"># Check if the match is good enough</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_match_good_enough</span><span class="p">(</span>
                    <span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span> <span class="n">sorted_candidates</span><span class="p">,</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span>
                <span class="p">):</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_match</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Accepted match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (score=</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For rejected matches, create a match with empty cpp info but preserve candidate data</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">StructMatch</span><span class="p">(</span>
                            <span class="n">hlsl_name</span><span class="o">=</span><span class="n">hlsl_name</span><span class="p">,</span>
                            <span class="n">hlsl_file</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span>
                            <span class="n">hlsl_line</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">],</span>
                            <span class="n">cpp_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_name indicates rejection</span>
                            <span class="n">cpp_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_file</span>
                            <span class="n">cpp_line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Empty cpp_line</span>
                            <span class="n">score</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Zero score for status determination</span>
                            <span class="n">align_matches</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Empty align_matches for rejected</span>
                            <span class="n">report</span><span class="o">=</span><span class="n">best_match</span><span class="o">.</span><span class="n">report</span><span class="p">,</span>  <span class="c1"># Preserve the actual report from best match</span>
                            <span class="n">candidates</span><span class="o">=</span><span class="n">sorted_candidates</span><span class="p">,</span>  <span class="c1"># Preserve sorted candidates with full alignment info</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Rejected match for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (score=</span><span class="si">{</span><span class="n">best_match</span><span class="o">.</span><span class="n">score</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">) - quality too low&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No candidates found</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">StructMatch</span><span class="p">(</span>
                        <span class="n">hlsl_name</span><span class="o">=</span><span class="n">hlsl_name</span><span class="p">,</span>
                        <span class="n">hlsl_file</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">],</span>
                        <span class="n">hlsl_line</span><span class="o">=</span><span class="n">hlsl_data</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">],</span>
                        <span class="n">cpp_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_name</span>
                        <span class="n">cpp_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Empty cpp_file</span>
                        <span class="n">cpp_line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Empty cpp_line</span>
                        <span class="n">score</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Zero score</span>
                        <span class="n">align_matches</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Empty align_matches</span>
                        <span class="n">report</span><span class="o">=</span><span class="p">{</span>  <span class="c1"># Empty report</span>
                            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                            <span class="s2">&quot;exact_matches&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s2">&quot;high_sim_matches&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s2">&quot;total_fields&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">),</span>
                            <span class="s2">&quot;missing_fields&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">),</span>
                        <span class="p">},</span>
                        <span class="n">candidates</span><span class="o">=</span><span class="n">sorted_candidates</span><span class="p">,</span>  <span class="c1"># Empty sorted_candidates</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_generate_comparison_tables</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">print_tables</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Store analysis_links as an attribute for later use in print_comparison_tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span> <span class="o">=</span> <span class="n">analysis_links</span>

    <span class="c1"># Update analysis links in result_map</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># New logic for status:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
            <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Unmatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field_diff_count</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_diff_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">cpp_total_fields</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpp_total_fields&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">hlsl_total_fields</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_fields&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">min_fields</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">hlsl_total_fields</span><span class="p">,</span> <span class="n">cpp_total_fields</span><span class="p">)</span>
            <span class="n">diff_ratio</span> <span class="o">=</span> <span class="n">field_diff_count</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_fields</span><span class="p">)</span>
            <span class="n">debug_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;DEBUG: </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">: field_diff_count=</span><span class="si">{</span><span class="n">field_diff_count</span><span class="si">}</span><span class="s2">, min_fields=</span><span class="si">{</span><span class="n">min_fields</span><span class="si">}</span><span class="s2">, diff_ratio=</span><span class="si">{</span><span class="n">diff_ratio</span><span class="si">}</span><span class="s2">, score=</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">add_debug_info</span><span class="p">(</span><span class="n">debug_msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">diff_ratio</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">or</span> <span class="n">match</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;</span> <span class="mf">0.75</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
                <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Unmatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">field_diff_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;Matched&quot;</span>
                <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Matched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">field_diff_count</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mismatched (</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Mismatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mismatched (</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">match_counts</span><span class="p">[</span><span class="s2">&quot;Mismatched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">create_struct_analysis_link</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="s2">&quot;is_match&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="p">),</span>
            <span class="s2">&quot;cpp_name&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_name</span><span class="p">,</span>
            <span class="s2">&quot;cpp_file&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_file</span><span class="p">,</span>
            <span class="s2">&quot;cpp_line&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">cpp_line</span><span class="p">,</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Look for entries using template type for struct analysis</span>
        <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">template_type</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Template Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Use template type for struct analysis if available, otherwise use buffer name</span>
            <span class="n">struct_name</span> <span class="o">=</span> <span class="n">template_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">template_type</span> <span class="k">else</span> <span class="n">buffer_name</span>

            <span class="c1"># Check if this buffer entry should link to this struct analysis</span>
            <span class="k">if</span> <span class="n">file_path</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">struct_name</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Updated result_map for </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2"> using template type </span><span class="si">{</span><span class="n">template_type</span><span class="si">}</span><span class="s2"> with link: </span><span class="si">{</span><span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback: try name-only match for user-defined types</span>
            <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">template_type</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Template Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">struct_name</span> <span class="o">=</span> <span class="n">template_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">template_type</span> <span class="k">else</span> <span class="n">buffer_name</span>

                <span class="k">if</span> <span class="n">struct_name</span> <span class="o">==</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_links</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fallback name-only match for </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No buffer table entry found for struct </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Matching Struct Analysis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buffer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> not matched to any struct&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">analysis_links</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.find_struct_candidates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_struct_candidates</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">matched_cpp_structs</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.find_struct_candidates" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Find candidate C++ structs for an HLSL struct.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>hlsl_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the HLSL struct.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_data</code></td>
            <td>
                  <code><span title="hlslkit.buffer_scan.StructDict">StructDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HLSL struct metadata.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_fields</code></td>
            <td>
                  <code>list[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of HLSL fields.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>matched_cpp_structs</code></td>
            <td>
                  <code>set[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of already matched C++ struct names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[tuple[str, <span title="hlslkit.buffer_scan.StructDict">StructDict</span>, float]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[tuple[str, StructDict, float]]: List of (cpp_name, cpp_data, similarity) tuples.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_struct_candidates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">hlsl_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">hlsl_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">,</span>
    <span class="n">hlsl_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">],</span>
    <span class="n">matched_cpp_structs</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StructDict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find candidate C++ structs for an HLSL struct.</span>

<span class="sd">    Args:</span>
<span class="sd">        hlsl_name: Name of the HLSL struct.</span>
<span class="sd">        hlsl_data: HLSL struct metadata.</span>
<span class="sd">        hlsl_fields: List of HLSL fields.</span>
<span class="sd">        matched_cpp_structs: Set of already matched C++ struct names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple[str, StructDict, float]]: List of (cpp_name, cpp_data, similarity) tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StructDict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cpp_name</span><span class="p">,</span> <span class="n">cpp_struct_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">cpp_data</span> <span class="ow">in</span> <span class="n">cpp_struct_list</span><span class="p">:</span>
            <span class="c1"># Test original version</span>
            <span class="n">original_fields</span> <span class="o">=</span> <span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">original_fields</span><span class="p">:</span>
                <span class="n">temp_cpp_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">)</span>
                <span class="n">temp_cpp_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_fields</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">align_structs</span><span class="p">(</span><span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">alignment_score</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cpp_name</span><span class="p">,</span> <span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">alignment_score</span><span class="p">))</span>

                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2"> Candidate </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (original) from </span><span class="si">{</span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;alignment_score=</span><span class="si">{</span><span class="n">alignment_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, total_size=</span><span class="si">{</span><span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">original_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">, fields: </span><span class="si">{</span><span class="p">[(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">original_fields</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># Test flattened version if different</span>
            <span class="n">flattened_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flattened_fields</span> <span class="o">!=</span> <span class="n">original_fields</span><span class="p">:</span>
                <span class="n">temp_cpp_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">)</span>
                <span class="n">temp_cpp_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flattened_fields</span>
                <span class="n">temp_cpp_data</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">flattened_fields</span><span class="p">)</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">align_structs</span><span class="p">(</span><span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">alignment_score</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">temp_cpp_data</span><span class="p">,</span> <span class="n">alignment_score</span><span class="p">))</span>

                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2"> Candidate </span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2"> (flattened) from </span><span class="si">{</span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;alignment_score=</span><span class="si">{</span><span class="n">alignment_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, total_size=</span><span class="si">{</span><span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">flattened_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">, fields: </span><span class="si">{</span><span class="p">[(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">flattened_fields</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
    <span class="n">candidates</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.get_buffer_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_buffer_location</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.get_buffer_location" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the location of a buffer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>buffer_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the buffer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>line</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line number</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[str, int] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[str, int] | None: (file, line) tuple if found, None otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_buffer_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the location of a buffer.</span>

<span class="sd">    Args:</span>
<span class="sd">        file: File path</span>
<span class="sd">        buffer_name: Name of the buffer</span>
<span class="sd">        line: Line number</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, int] | None: (file, line) tuple if found, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">buffer_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.get_field_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_field_name</span><span class="p">(</span><span class="n">field</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.get_field_name" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the field name without array notation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>field</code></td>
            <td>
                  <code><span title="hlslkit.buffer_scan.FieldDict">FieldDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field dictionary containing name information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field name without array notation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>analyzer.get_field_name({"name": "myArray[3]"})
'myArray'</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">FieldDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the field name without array notation.</span>

<span class="sd">    Args:</span>
<span class="sd">        field: Field dictionary containing name information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Field name without array notation.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; analyzer.get_field_name({&quot;name&quot;: &quot;myArray[3]&quot;})</span>
<span class="sd">        &#39;myArray&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid field dictionary: </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">strip_array_notation</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.get_nested_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">struct_data</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.get_nested_fields" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get all fields from a struct, including nested struct fields.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>struct_data</code></td>
            <td>
                  <code><span title="hlslkit.buffer_scan.StructDict">StructDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing struct metadata.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[FieldDict]: List of field dictionaries, including nested fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nested_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all fields from a struct, including nested struct fields.</span>

<span class="sd">    Args:</span>
<span class="sd">        struct_data: Dictionary containing struct metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[FieldDict]: List of field dictionaries, including nested fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">processed_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Determine which struct dictionary to use based on the struct&#39;s origin</span>
    <span class="n">struct_file</span> <span class="o">=</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">is_cpp_struct</span> <span class="o">=</span> <span class="n">struct_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.cpp&quot;</span><span class="p">,</span> <span class="s2">&quot;.h&quot;</span><span class="p">,</span> <span class="s2">&quot;.hpp&quot;</span><span class="p">))</span>
    <span class="n">struct_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpp_structs</span> <span class="k">if</span> <span class="n">is_cpp_struct</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">field_type</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">struct_dict</span><span class="p">:</span>
            <span class="c1"># Process each StructDict in the list for nested structs</span>
            <span class="n">nested_structs</span> <span class="o">=</span> <span class="n">struct_dict</span><span class="p">[</span><span class="n">field_type</span><span class="p">]</span>
            <span class="n">struct_file</span> <span class="o">=</span> <span class="n">struct_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">preferred_struct</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">nested_struct</span> <span class="ow">in</span> <span class="n">nested_structs</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested_struct</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid nested struct for </span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">nested_struct</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">nested_struct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">struct_file</span><span class="p">:</span>
                    <span class="n">preferred_struct</span> <span class="o">=</span> <span class="n">nested_struct</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">preferred_struct</span><span class="p">:</span>
                <span class="n">preferred_struct</span> <span class="o">=</span> <span class="n">nested_structs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># fallback to first if no file match</span>
            <span class="n">nested_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nested_fields</span><span class="p">(</span><span class="n">preferred_struct</span><span class="p">)</span>
            <span class="n">processed_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">nested_fields</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">processed_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">processed_fields</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.print_comparison_tables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_comparison_tables</span><span class="p">(</span><span class="n">only_matched</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_top_candidate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.print_comparison_tables" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Print comparison tables for all HLSL structs, with sub-buffers nested under their parents, using result_map as the source.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">print_comparison_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_matched</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">show_top_candidate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print comparison tables for all HLSL structs, with sub-buffers nested under their parents, using result_map as the source.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Struct Comparison Results&quot;</span><span class="p">)</span>
    <span class="n">printed_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c1"># Build a lookup for table data</span>
    <span class="n">table_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison_tables</span><span class="p">}</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table lookup keys: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">table_lookup</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Build a lookup for composite buffer relationships</span>
    <span class="n">composite_to_subs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">buffer_name</span><span class="p">,</span> <span class="n">sub_names</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">composite_buffers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">sub_name</span> <span class="ow">in</span> <span class="n">sub_names</span><span class="p">:</span>
            <span class="c1"># Find the file for the sub-buffer</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison_tables</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_name</span><span class="p">:</span>
                    <span class="n">sub_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">parent_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">composite_to_subs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">sub_key</span>
                    <span class="p">)</span>  <span class="c1"># Use buffer_locations as the source</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buffer locations: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_locations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">entry</span>
        <span class="n">composite_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># If this is a composite buffer, check if any sub-buffers should be printed</span>
        <span class="k">if</span> <span class="n">composite_key</span> <span class="ow">in</span> <span class="n">composite_to_subs</span><span class="p">:</span>
            <span class="n">sub_keys</span> <span class="o">=</span> <span class="n">composite_to_subs</span><span class="p">[</span><span class="n">composite_key</span><span class="p">]</span>
            <span class="c1"># Check if composite or any sub-buffer should be printed</span>
            <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">composite_key</span><span class="p">,</span> <span class="o">*</span><span class="n">sub_keys</span><span class="p">]</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">should_print</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{}</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">only_matched</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;Unmatched&quot;</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="n">should_print_any</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">should_print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">should_print_any</span> <span class="ow">and</span> <span class="n">composite_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">printed_keys</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Composite Buffer: </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Print composite buffer table if present</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">composite_key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
                    <span class="c1"># Handle show_top_candidate for composite buffer</span>
                    <span class="n">cpp_name</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_name&quot;</span><span class="p">]</span>
                    <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_data&quot;</span><span class="p">]</span>
                    <span class="n">align_matches</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;align_matches&quot;</span><span class="p">]</span>
                    <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                    <span class="c1"># If no accepted match but we want to show top candidate, extract from candidates</span>
                    <span class="k">if</span> <span class="n">show_top_candidate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">]:</span>
                        <span class="n">top_candidate</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Best candidate</span>
                        <span class="n">cpp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">top_candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (top candidate - rejected)&quot;</span>
                        <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c1"># For regular candidate tuples, use empty alignment data</span>
                        <span class="n">align_matches</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="n">generate_comparison_table</span><span class="p">(</span>
                                <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span>
                                <span class="n">cpp_name</span><span class="p">,</span>
                                <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">],</span>
                                <span class="n">cpp_data</span><span class="p">,</span>
                                <span class="n">align_matches</span><span class="p">,</span>
                                <span class="n">report</span><span class="p">,</span>
                                <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">],</span>
                                <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                    <span class="p">{},</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                <span class="n">show_top_candidate</span><span class="o">=</span><span class="n">show_top_candidate</span><span class="p">,</span>
                                <span class="n">section_id</span><span class="o">=</span><span class="n">create_struct_section_id</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">][</span><span class="s2">&quot;file&quot;</span><span class="p">]),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="n">printed_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">composite_key</span><span class="p">)</span>
                <span class="c1"># Print sub-buffers</span>
                <span class="k">for</span> <span class="n">sub_key</span> <span class="ow">in</span> <span class="n">sub_keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sub_key</span> <span class="ow">in</span> <span class="n">printed_keys</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sub_key</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">should_print</span><span class="p">(</span><span class="n">sub_key</span><span class="p">):</span>
                        <span class="c1"># Handle show_top_candidate for sub-buffers</span>
                        <span class="n">cpp_name</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_name&quot;</span><span class="p">]</span>
                        <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_data&quot;</span><span class="p">]</span>
                        <span class="n">align_matches</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;align_matches&quot;</span><span class="p">]</span>
                        <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                        <span class="c1"># If no accepted match but we want to show top candidate, use the first candidate</span>
                        <span class="k">if</span> <span class="n">show_top_candidate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">]:</span>
                            <span class="n">top_candidate</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First candidate should be best after sorting</span>
                            <span class="n">cpp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">top_candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (top candidate - rejected)&quot;</span>
                            <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="c1"># Use the alignment data from the candidate</span>
                            <span class="n">align_matches</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_candidate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[]</span>
                            <span class="n">report</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_candidate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                        <span class="nb">print</span><span class="p">(</span>
                            <span class="n">generate_comparison_table</span><span class="p">(</span>
                                <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span>
                                <span class="n">cpp_name</span><span class="p">,</span>
                                <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">],</span>
                                <span class="n">cpp_data</span><span class="p">,</span>
                                <span class="n">align_matches</span><span class="p">,</span>
                                <span class="n">report</span><span class="p">,</span>
                                <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">],</span>
                                <span class="n">status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                    <span class="p">{},</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                                <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">printed_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sub_key</span><span class="p">)</span>
        <span class="c1"># Otherwise, print as a regular buffer if not already printed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_lookup</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking for key_lookup: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key_lookup</span> <span class="ow">in</span> <span class="n">printed_keys</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Already printed: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">table_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_lookup</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found table for: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_data&#39;</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;hlsl_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">{}</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status for </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">only_matched</span> <span class="ow">and</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;Unmatched&quot;</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping unmatched: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="c1"># Handle show_top_candidate for regular buffers</span>
                <span class="n">cpp_name</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_name&quot;</span><span class="p">]</span>
                <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cpp_data&quot;</span><span class="p">]</span>

                <span class="c1"># If no accepted match but we want to show top candidate, use the first candidate</span>
                <span class="k">if</span> <span class="n">show_top_candidate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">]:</span>
                    <span class="n">top_candidate</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First candidate should be best after sorting</span>
                    <span class="n">cpp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">top_candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (top candidate - rejected)&quot;</span>
                    <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># Use empty alignment data for simple candidate tuples</span>
                    <span class="n">align_matches</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">align_matches</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;align_matches&quot;</span><span class="p">]</span>
                    <span class="n">report</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;report&quot;</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span>
                    <span class="n">generate_comparison_table</span><span class="p">(</span>
                        <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_name&quot;</span><span class="p">],</span>
                        <span class="n">cpp_name</span><span class="p">,</span>
                        <span class="n">table</span><span class="p">[</span><span class="s2">&quot;hlsl_data&quot;</span><span class="p">],</span>
                        <span class="n">cpp_data</span><span class="p">,</span>
                        <span class="n">align_matches</span><span class="p">,</span>
                        <span class="n">report</span><span class="p">,</span>
                        <span class="n">table</span><span class="p">[</span><span class="s2">&quot;candidates&quot;</span><span class="p">],</span>
                        <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">printed_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key_lookup</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No table found for: </span><span class="si">{</span><span class="n">key_lookup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.buffer_scan.StructAnalyzer.update_result_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_result_map</span><span class="p">(</span><span class="n">result_map</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.StructAnalyzer.update_result_map" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Update the result map with stored analysis results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>result_map</code></td>
            <td>
                  <code>dict[str, dict[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping keys to buffer metadata, to be updated with analysis links.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_result_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the result map with stored analysis results.</span>

<span class="sd">    Args:</span>
<span class="sd">        result_map: Dictionary mapping keys to buffer metadata, to be updated with analysis links.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_results</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No analysis results available to update result_map&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Create template type mapping</span>
    <span class="n">template_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">struct_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">struct</span> <span class="ow">in</span> <span class="n">struct_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">struct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;template_type&quot;</span> <span class="ow">in</span> <span class="n">struct</span><span class="p">:</span>
                <span class="n">template_types</span><span class="p">[</span><span class="n">hlsl_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="p">[</span><span class="s2">&quot;template_type&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">analysis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result_map</span><span class="p">:</span>
            <span class="n">result_map</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated result_map for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> with link: </span><span class="si">{</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid key format in analysis_results: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">buffer_name</span><span class="p">:</span>
                <span class="n">result_map</span><span class="p">[</span><span class="n">result_key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matched </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="c1"># Fallback: try file+name match (legacy)</span>
            <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">buffer_name</span><span class="p">:</span>
                <span class="n">result_map</span><span class="p">[</span><span class="n">result_key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fallback file+name match for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="c1"># Fallback: try name-only match for user-defined types</span>
            <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">buffer_name</span> <span class="ow">and</span> <span class="n">buffer_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
                <span class="n">result_map</span><span class="p">[</span><span class="n">result_key</span><span class="p">][</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fallback name-only match for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> to result_map key </span><span class="si">{</span><span class="n">result_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No buffer table entry found for struct </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Matching Struct Analysis&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Unmatched&quot;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buffer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> not matched to any struct&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hlslkit.buffer_scan.StructCandidate" class="doc doc-heading">
            <code>StructCandidate</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hlslkit.buffer_scan.StructCandidate" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Represents a candidate C++ struct for matching with an HLSL struct.</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StructCandidate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a candidate C++ struct for matching with an HLSL struct.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">StructDict</span>
    <span class="n">score</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">align_matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="n">report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hlslkit.buffer_scan.StructMatch" class="doc doc-heading">
            <code>StructMatch</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hlslkit.buffer_scan.StructMatch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Represents a match between an HLSL struct and a C++ struct.</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StructMatch</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a match between an HLSL struct and a C++ struct.&quot;&quot;&quot;</span>

    <span class="n">hlsl_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">hlsl_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">hlsl_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">cpp_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cpp_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cpp_line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">score</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">align_matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="n">report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">StructCandidate</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_matched</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if there&#39;s a valid C++ match.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpp_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="hlslkit.buffer_scan.StructMatch.is_matched" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_matched</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#hlslkit.buffer_scan.StructMatch.is_matched" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>True if there's a valid C++ match.</p>
    </div>

</div>





  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.add_debug_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_debug_info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.add_debug_info" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add debug information to be included in the output.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_debug_info</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add debug information to be included in the output.&quot;&quot;&quot;</span>
    <span class="n">DEBUG_INFO</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.are_fields_equivalent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">are_fields_equivalent</span><span class="p">(</span><span class="n">cpp_field</span><span class="p">,</span> <span class="n">hlsl_field</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.are_fields_equivalent" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Check if fields are equivalent despite different types.</p>
<p>This function uses the following criteria to determine equivalence:
1. Name similarity (using compute_name_similarity)
2. Type compatibility (using normalize_field_type)
3. Size matching</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cpp_field</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>C++ field dictionary with name, type and size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_field</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HLSL field dictionary with name, type and size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if fields are equivalent, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">are_fields_equivalent</span><span class="p">(</span><span class="n">cpp_field</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">hlsl_field</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if fields are equivalent despite different types.</span>

<span class="sd">    This function uses the following criteria to determine equivalence:</span>
<span class="sd">    1. Name similarity (using compute_name_similarity)</span>
<span class="sd">    2. Type compatibility (using normalize_field_type)</span>
<span class="sd">    3. Size matching</span>

<span class="sd">    Args:</span>
<span class="sd">        cpp_field: C++ field dictionary with name, type and size.</span>
<span class="sd">        hlsl_field: HLSL field dictionary with name, type and size.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if fields are equivalent, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get field similarities using our helper function</span>
    <span class="n">type_sim</span><span class="p">,</span> <span class="n">name_sim</span><span class="p">,</span> <span class="n">size_match</span> <span class="o">=</span> <span class="n">get_field_similarity</span><span class="p">(</span><span class="n">cpp_field</span><span class="p">,</span> <span class="n">hlsl_field</span><span class="p">)</span>

    <span class="c1"># Fields are equivalent if they have both matching names and types</span>
    <span class="k">return</span> <span class="n">name_sim</span> <span class="o">&gt;=</span> <span class="n">NAME_SIM_THRESHOLD</span> <span class="ow">and</span> <span class="n">type_sim</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">size_match</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.calculate_hlsl_struct_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_hlsl_struct_size</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.calculate_hlsl_struct_size" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate HLSL struct size, handling packoffset and 16-byte alignment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fields</code></td>
            <td>
                  <code>list[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of field dictionaries with type, size, and optional packoffset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total size in bytes, aligned to 16-byte boundaries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_hlsl_struct_size</span><span class="p">(</span><span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate HLSL struct size, handling packoffset and 16-byte alignment.</span>

<span class="sd">    Args:</span>
<span class="sd">        fields: List of field dictionaries with type, size, and optional packoffset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Total size in bytes, aligned to 16-byte boundaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">packoffset</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;packoffset&quot;</span><span class="p">)</span>
        <span class="n">field_size</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_field_size</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;array_size&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">packoffset</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;c(\d+)\.([xyzw])&quot;</span><span class="p">,</span> <span class="n">packoffset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">register</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">component</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
                <span class="n">field_offset</span> <span class="o">=</span> <span class="n">register</span> <span class="o">*</span> <span class="n">ALIGN_TO_16</span> <span class="o">+</span> <span class="n">component</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">field_offset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="p">(</span><span class="n">ALIGN_TO_4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">ALIGN_TO_4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Align to 4-byte boundary</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="n">field_size</span>
        <span class="n">max_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_offset</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">max_offset</span> <span class="o">+</span> <span class="p">(</span><span class="n">ALIGN_TO_16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">ALIGN_TO_16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Align to 16-byte boundary</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.calculate_struct_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">align_to_16</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.calculate_struct_size" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate total size of a struct, accounting for alignment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fields</code></td>
            <td>
                  <code>list[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of field dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>align_to_16</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to align to 16-byte boundaries (e.g., for cbuffers).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total size in bytes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_struct_size</span><span class="p">(</span><span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">],</span> <span class="n">align_to_16</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate total size of a struct, accounting for alignment.</span>

<span class="sd">    Args:</span>
<span class="sd">        fields: List of field dictionaries.</span>
<span class="sd">        align_to_16: Whether to align to 16-byte boundaries (e.g., for cbuffers).</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Total size in bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">align_to_16</span><span class="p">:</span>
            <span class="c1"># Align each field to 16-byte boundary for cbuffers</span>
            <span class="n">total_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">ALIGN_TO_16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">ALIGN_TO_16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">total_size</span> <span class="o">+=</span> <span class="n">size</span>
    <span class="k">if</span> <span class="n">align_to_16</span><span class="p">:</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">ALIGN_TO_16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">ALIGN_TO_16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># logging.debug(</span>
    <span class="c1">#     f&quot;Calculated struct size: {total_size} bytes for fields: {[(f[&#39;name&#39;], f[&#39;type&#39;], f[&#39;size&#39;]) for f in fields]}&quot;</span>
    <span class="c1"># )</span>
    <span class="k">return</span> <span class="n">total_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.capture_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">capture_pattern</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.capture_pattern" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Capture matches of a pattern in the given text, accounting for line directives.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to search.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pattern</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The regular expression pattern to match.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[tuple[int, <span title="re.Match">Match</span>[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[tuple[int, Match[str]]]: A list of tuples containing the line number and match object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">capture_pattern</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Capture matches of a pattern in the given text, accounting for line directives.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The text to search.</span>
<span class="sd">        pattern: The regular expression pattern to match.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple[int, Match[str]]]: A list of tuples containing the line number and match object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># line adjust</span>
    <span class="c1"># line 288 &quot;features/Grass Lighting/Shaders/RunGrass.hlsl&quot;</span>
    <span class="n">line_adjust</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^#line (?P&lt;line&gt;[0-9]+) </span><span class="se">\&quot;</span><span class="s2">(?P&lt;filename&gt;.*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
    <span class="c1"># Compile the regular expression pattern.</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Iterate over the lines of the text.</span>
    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()):</span>
        <span class="n">line_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line_adjust</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line_match</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">))</span> <span class="o">-</span> <span class="n">line_number</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># Match the pattern against the line.</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="c1"># If there is a match, return the line number.</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line_number</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">match</span><span class="p">))</span>

    <span class="c1"># If no match is found, return None.</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.clean_body" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_body</span><span class="p">(</span><span class="n">body</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.clean_body" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Clean comments and empty lines from struct body.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clean_body</span><span class="p">(</span><span class="n">body</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clean comments and empty lines from struct body.&quot;&quot;&quot;</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/\*.*?\*/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">cleaned_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;//.*$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;//.*$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cleaned_lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.clear_debug_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clear_debug_info</span><span class="p">()</span></code>

<a href="#hlslkit.buffer_scan.clear_debug_info" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Clear collected debug information.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_debug_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear collected debug information.&quot;&quot;&quot;</span>
    <span class="n">DEBUG_INFO</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.compute_match_score" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_match_score</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">cpp_name</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">cpp_fields</span><span class="p">,</span> <span class="n">lcs_pairs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">struct_name_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.compute_match_score" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute overall match score using LCS information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>hlsl_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of HLSL struct</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpp_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of C++ struct</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_fields</code></td>
            <td>
                  <code>list[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of HLSL fields</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpp_fields</code></td>
            <td>
                  <code>list[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of C++ fields</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lcs_pairs</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[list[tuple[int, int]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of matched field index pairs from LCS</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>struct_name_weight</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for struct name similarity</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Match score between 0 and 1</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_match_score</span><span class="p">(</span>
    <span class="n">hlsl_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cpp_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">hlsl_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">],</span>
    <span class="n">cpp_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldDict</span><span class="p">],</span>
    <span class="n">lcs_pairs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">struct_name_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute overall match score using LCS information.</span>

<span class="sd">    Args:</span>
<span class="sd">        hlsl_name: Name of HLSL struct</span>
<span class="sd">        cpp_name: Name of C++ struct</span>
<span class="sd">        hlsl_fields: List of HLSL fields</span>
<span class="sd">        cpp_fields: List of C++ fields</span>
<span class="sd">        lcs_pairs: List of matched field index pairs from LCS</span>
<span class="sd">        struct_name_weight: Weight for struct name similarity</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Match score between 0 and 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Name similarity</span>
    <span class="n">name_sim</span> <span class="o">=</span> <span class="n">compute_name_similarity</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">cpp_name</span><span class="p">)</span>

    <span class="c1"># Field matching score based on LCS</span>
    <span class="n">lcs_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lcs_pairs</span><span class="p">)</span> <span class="k">if</span> <span class="n">lcs_pairs</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">max_fields</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpp_fields</span><span class="p">))</span>
    <span class="n">field_match_score</span> <span class="o">=</span> <span class="n">lcs_length</span> <span class="o">/</span> <span class="n">max_fields</span> <span class="k">if</span> <span class="n">max_fields</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="c1"># Field order preservation score</span>
    <span class="n">order_score</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">if</span> <span class="n">lcs_pairs</span><span class="p">:</span>
        <span class="n">prev_hlsl</span><span class="p">,</span> <span class="n">prev_cpp</span> <span class="o">=</span> <span class="n">lcs_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">hlsl_idx</span><span class="p">,</span> <span class="n">cpp_idx</span> <span class="ow">in</span> <span class="n">lcs_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">hlsl_idx</span> <span class="o">&lt;</span> <span class="n">prev_hlsl</span> <span class="ow">or</span> <span class="n">cpp_idx</span> <span class="o">&lt;</span> <span class="n">prev_cpp</span><span class="p">:</span>
                <span class="n">order_score</span> <span class="o">*=</span> <span class="mf">0.9</span>  <span class="c1"># Penalize out-of-order matches</span>
            <span class="n">prev_hlsl</span><span class="p">,</span> <span class="n">prev_cpp</span> <span class="o">=</span> <span class="n">hlsl_idx</span><span class="p">,</span> <span class="n">cpp_idx</span>

    <span class="c1"># Combine scores</span>
    <span class="k">return</span> <span class="n">name_sim</span> <span class="o">*</span> <span class="n">struct_name_weight</span> <span class="o">+</span> <span class="n">field_match_score</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">struct_name_weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">order_score</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.compute_name_similarity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_name_similarity</span><span class="p">(</span><span class="n">hlsl_field_name</span><span class="p">,</span> <span class="n">cpp_field_name</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.compute_name_similarity" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute name similarity using difflib and handle array notation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>hlsl_field_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HLSL field name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpp_field_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>C++ field name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Similarity score between 0 and 1</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_name_similarity</span><span class="p">(</span><span class="n">hlsl_field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cpp_field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute name similarity using difflib and handle array notation.</span>

<span class="sd">    Args:</span>
<span class="sd">        hlsl_field_name: HLSL field name</span>
<span class="sd">        cpp_field_name: C++ field name</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Similarity score between 0 and 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize to lowercase for case-insensitive comparison</span>
    <span class="n">hlsl_name_lower</span> <span class="o">=</span> <span class="n">hlsl_field_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">cpp_name_lower</span> <span class="o">=</span> <span class="n">cpp_field_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Try direct sequence matching first</span>
    <span class="n">matcher</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">hlsl_name_lower</span><span class="p">,</span> <span class="n">cpp_name_lower</span><span class="p">)</span>
    <span class="n">normal_sim</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>

    <span class="c1"># Enhanced: Also get LCS-based similarity</span>
    <span class="n">matching_blocks</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
    <span class="n">lcs_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">size</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">matching_blocks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Exclude final dummy block</span>
    <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hlsl_name_lower</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpp_name_lower</span><span class="p">))</span>
    <span class="n">lcs_sim</span> <span class="o">=</span> <span class="n">lcs_length</span> <span class="o">/</span> <span class="n">max_length</span> <span class="k">if</span> <span class="n">max_length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="c1"># Try with array notation stripped (preserving existing logic)</span>
    <span class="n">hlsl_stripped</span> <span class="o">=</span> <span class="n">strip_array_notation</span><span class="p">(</span><span class="n">hlsl_name_lower</span><span class="p">)</span>
    <span class="n">cpp_stripped</span> <span class="o">=</span> <span class="n">strip_array_notation</span><span class="p">(</span><span class="n">cpp_name_lower</span><span class="p">)</span>
    <span class="n">stripped_matcher</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">hlsl_stripped</span><span class="p">,</span> <span class="n">cpp_stripped</span><span class="p">)</span>
    <span class="n">stripped_sim</span> <span class="o">=</span> <span class="n">stripped_matcher</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>

    <span class="c1"># Enhanced: LCS similarity for stripped names too</span>
    <span class="n">stripped_blocks</span> <span class="o">=</span> <span class="n">stripped_matcher</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
    <span class="n">stripped_lcs_length</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">size</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">stripped_blocks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">stripped_max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hlsl_stripped</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpp_stripped</span><span class="p">))</span>
    <span class="n">stripped_lcs_sim</span> <span class="o">=</span> <span class="n">stripped_lcs_length</span> <span class="o">/</span> <span class="n">stripped_max_length</span> <span class="k">if</span> <span class="n">stripped_max_length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="c1"># Look for substring relationships (preserving existing logic)</span>
    <span class="k">if</span> <span class="n">hlsl_stripped</span> <span class="ow">in</span> <span class="n">cpp_stripped</span> <span class="ow">or</span> <span class="n">cpp_stripped</span> <span class="ow">in</span> <span class="n">hlsl_stripped</span><span class="p">:</span>
        <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hlsl_stripped</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpp_stripped</span><span class="p">))</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hlsl_stripped</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpp_stripped</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">max_len</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span> <span class="o">&gt;=</span> <span class="mf">0.7</span><span class="p">:</span>  <span class="c1"># At least 70% coverage</span>
            <span class="n">substring_sim</span> <span class="o">=</span> <span class="mf">0.9</span>  <span class="c1"># Boost similarity for significant substring matches</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">normal_sim</span><span class="p">,</span> <span class="n">stripped_sim</span><span class="p">,</span> <span class="n">lcs_sim</span><span class="p">,</span> <span class="n">stripped_lcs_sim</span><span class="p">,</span> <span class="n">substring_sim</span><span class="p">)</span>

    <span class="c1"># Prefix/suffix boost</span>
    <span class="n">shorter</span><span class="p">,</span> <span class="n">longer</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">hlsl_stripped</span><span class="p">,</span> <span class="n">cpp_stripped</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hlsl_stripped</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpp_stripped</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">cpp_stripped</span><span class="p">,</span> <span class="n">hlsl_stripped</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">longer</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">shorter</span><span class="p">)</span> <span class="ow">or</span> <span class="n">longer</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">shorter</span><span class="p">)</span> <span class="ow">or</span> <span class="n">shorter</span> <span class="ow">in</span> <span class="n">longer</span><span class="p">:</span>
        <span class="c1"># Full shorter string matches as prefix/suffix/substring</span>
        <span class="n">prefix_sim</span> <span class="o">=</span> <span class="mf">0.85</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">normal_sim</span><span class="p">,</span> <span class="n">stripped_sim</span><span class="p">,</span> <span class="n">lcs_sim</span><span class="p">,</span> <span class="n">stripped_lcs_sim</span><span class="p">,</span> <span class="n">prefix_sim</span><span class="p">)</span>

    <span class="c1"># Return highest similarity score with small penalty for stripped matches</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">normal_sim</span><span class="p">,</span> <span class="n">lcs_sim</span><span class="p">,</span> <span class="n">stripped_sim</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">stripped_lcs_sim</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_score</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.compute_struct_alignment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_struct_alignment</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">struct_name_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.compute_struct_alignment" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute alignment between HLSL and C++ struct fields.</p>
<p>This function analyzes field alignment between C++ and HLSL structs, considering:
- Field name similarity using compute_name_similarity
- Field type compatibility using normalize_field_type
- Field size matching using calculate_struct_size
- Struct name similarity using compute_name_similarity</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cpp_data</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing C++ struct metadata and fields.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_data</code></td>
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing HLSL struct metadata and fields.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>struct_name_weight</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight given to struct name similarity (0.0 to 1.0).</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>list[tuple[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span> | None, <span title="hlslkit.buffer_scan.FieldDict">FieldDict</span> | None]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>score: Overall alignment score (0.0 to 1.0)</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>align_matches: List of field alignment tuples</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[float, list[tuple[<span title="hlslkit.buffer_scan.FieldDict">FieldDict</span> | None, <span title="hlslkit.buffer_scan.FieldDict">FieldDict</span> | None]], dict[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>report: Detailed alignment report dictionary</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_struct_alignment</span><span class="p">(</span>
    <span class="n">cpp_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">hlsl_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">struct_name_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute alignment between HLSL and C++ struct fields.</span>

<span class="sd">    This function analyzes field alignment between C++ and HLSL structs, considering:</span>
<span class="sd">    - Field name similarity using compute_name_similarity</span>
<span class="sd">    - Field type compatibility using normalize_field_type</span>
<span class="sd">    - Field size matching using calculate_struct_size</span>
<span class="sd">    - Struct name similarity using compute_name_similarity</span>

<span class="sd">    Args:</span>
<span class="sd">        cpp_data: Dictionary containing C++ struct metadata and fields.</span>
<span class="sd">        hlsl_data: Dictionary containing HLSL struct metadata and fields.</span>
<span class="sd">        struct_name_weight: Weight given to struct name similarity (0.0 to 1.0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - score: Overall alignment score (0.0 to 1.0)</span>
<span class="sd">        - align_matches: List of field alignment tuples</span>
<span class="sd">        - report: Detailed alignment report dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidStructDictType</span><span class="p">(</span><span class="n">cpp_data</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpp_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">hlsl_data</span><span class="p">)</span>

    <span class="n">cpp_fields</span> <span class="o">=</span> <span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">hlsl_fields</span> <span class="o">=</span> <span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="c1"># Use existing helper functions for field matching</span>
    <span class="n">align_matches</span><span class="p">,</span> <span class="n">report</span> <span class="o">=</span> <span class="n">_compute_alignment_report</span><span class="p">(</span><span class="n">cpp_fields</span><span class="p">,</span> <span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">cpp_data</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">struct_name_weight</span><span class="p">)</span>

    <span class="n">score</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">align_matches</span><span class="p">,</span> <span class="n">report</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.count_field_differences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_field_differences</span><span class="p">(</span><span class="n">align_matches</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.count_field_differences" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Count field differences, returning (total_diff, name_diff, type_diff).</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_field_differences</span><span class="p">(</span><span class="n">align_matches</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Count field differences, returning (total_diff, name_diff, type_diff).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_diff</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">name_diff</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">type_diff</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">hlsl_field</span><span class="p">,</span> <span class="n">cpp_field</span> <span class="ow">in</span> <span class="n">align_matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hlsl_field</span> <span class="ow">and</span> <span class="n">cpp_field</span><span class="p">:</span>
            <span class="n">name_sim</span> <span class="o">=</span> <span class="n">compute_name_similarity</span><span class="p">(</span><span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="n">type_sim</span> <span class="o">=</span> <span class="n">jellyfish</span><span class="o">.</span><span class="n">jaro_winkler_similarity</span><span class="p">(</span><span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">name_sim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name_diff</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total_diff</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">type_sim</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
                <span class="n">type_diff</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total_diff</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unmatched field counts as both a name and type diff</span>
            <span class="n">name_diff</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">type_diff</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">total_diff</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">total_diff</span><span class="p">,</span> <span class="n">name_diff</span><span class="p">,</span> <span class="n">type_diff</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.create_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_link</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.create_link" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate a GitHub link for a given file path and optional line number.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to convert to a GitHub URL.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>line</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Line number to link to.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A URL pointing to the file in the skyrim-community-shaders repository.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_link</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a GitHub link for a given file path and optional line number.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The file path to convert to a GitHub URL.</span>
<span class="sd">        line: Line number to link to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A URL pointing to the file in the skyrim-community-shaders repository.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://github.com/doodlum/skyrim-community-shaders/blob/dev/</span><span class="si">{</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">base_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;#L</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">base_url</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.create_struct_analysis_link" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_struct_analysis_link</span><span class="p">(</span><span class="n">struct_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.create_struct_analysis_link" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate a struct analysis link with proper formatting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>struct_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the struct</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename containing the struct</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>status</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Match status (Matched, Mismatched, or Unmatched)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Formatted markdown link for struct analysis</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_struct_analysis_link</span><span class="p">(</span><span class="n">struct_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a struct analysis link with proper formatting.</span>

<span class="sd">    Args:</span>
<span class="sd">        struct_name: Name of the struct</span>
<span class="sd">        filename: Filename containing the struct</span>
<span class="sd">        status: Match status (Matched, Mismatched, or Unmatched)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Formatted markdown link for struct analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">section_id</span> <span class="o">=</span> <span class="n">create_struct_section_id</span><span class="p">(</span><span class="n">struct_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;Unmatched&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[Unmatched](#</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">elif</span> <span class="n">status</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Mismatched&quot;</span><span class="p">):</span>
        <span class="c1"># Extract the matched struct name from status like &quot;Mismatched (StructName)&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">status</span> <span class="ow">and</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">matched_name</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="n">status</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)]</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[Mismatched (`</span><span class="si">{</span><span class="n">matched_name</span><span class="si">}</span><span class="s2">`)](#</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[Mismatched](#</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;Matched&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[`</span><span class="si">{</span><span class="n">struct_name</span><span class="si">}</span><span class="s2">`](#</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For any other status, use the struct name with backticks</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[`</span><span class="si">{</span><span class="n">struct_name</span><span class="si">}</span><span class="s2">`](#</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.create_struct_section_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_struct_section_id</span><span class="p">(</span><span class="n">struct_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.create_struct_section_id" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate a clean section ID for struct analysis cross-references.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>struct_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the struct</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filename</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename containing the struct</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Clean section ID suitable for markdown anchors</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_struct_section_id</span><span class="p">(</span><span class="n">struct_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a clean section ID for struct analysis cross-references.</span>

<span class="sd">    Args:</span>
<span class="sd">        struct_name: Name of the struct</span>
<span class="sd">        filename: Filename containing the struct</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Clean section ID suitable for markdown anchors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clean_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">clean_struct_name</span> <span class="o">=</span> <span class="n">struct_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;hlsl-</span><span class="si">{</span><span class="n">clean_struct_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">clean_filename</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.extract_cpp_structs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_cpp_structs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.extract_cpp_structs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Extract C++ structs, skipping any that contain pointers or only static members.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>content</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The C++ file content.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file for logging and linking.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, dict]: Dictionary of struct names to their metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_cpp_structs</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract C++ structs, skipping any that contain pointers or only static members.</span>

<span class="sd">    Args:</span>
<span class="sd">        content (str): The C++ file content.</span>
<span class="sd">        file_path (str): Path to the file for logging and linking.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, dict]: Dictionary of struct names to their metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">structs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">struct_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;struct\s+(?:alignas\(\d+\)\s+)?(?P&lt;name&gt;\w+)\s*{(?P&lt;body&gt;[^</span><span class="si">{}</span><span class="s2">]*?)}&quot;</span>

    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">finditer_with_line_numbers</span><span class="p">(</span><span class="n">struct_pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping struct/buffer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (built-in type) in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">body</span> <span class="o">=</span> <span class="n">clean_body</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c1"># Parse all fields, including static ones</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">non_static_fields</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">field_line</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
            <span class="n">field_line</span> <span class="o">=</span> <span class="n">field_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">field_line</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check if this is a static declaration</span>
            <span class="n">is_static</span> <span class="o">=</span> <span class="n">field_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;static &quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">is_static</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping static member in </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">field_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Parse non-static field</span>
            <span class="n">parsed_field</span> <span class="o">=</span> <span class="n">parse_field</span><span class="p">(</span><span class="n">field_line</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parsed_field</span><span class="p">:</span>
                <span class="n">all_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parsed_field</span><span class="p">)</span>
                <span class="n">non_static_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parsed_field</span><span class="p">)</span>

        <span class="c1"># Skip struct if it has no non-static fields</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">non_static_fields</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping C++ struct </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_number</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> (no non-static fields)&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Skip struct if any non-static field contains a pointer</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">non_static_fields</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping C++ struct </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_number</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> (contains pointers)&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">adjusted_line</span> <span class="o">=</span> <span class="n">line_number</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">structs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">non_static_fields</span><span class="p">,</span>  <span class="c1"># Only store non-static fields</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">adjusted_line</span><span class="p">,</span>
            <span class="s2">&quot;is_cbuffer&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;is_template&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">body</span><span class="p">,</span>  <span class="c1"># Store raw body for alignment check</span>
        <span class="p">}</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">non_static_fields</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found C++ struct </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">adjusted_line</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">non_static_fields</span><span class="p">)</span><span class="si">}</span><span class="s2"> non-static fields: </span><span class="si">{</span><span class="p">[(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">non_static_fields</span><span class="p">]</span><span class="si">}</span><span class="s2">, total size: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">structs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.extract_hlsl_structs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_hlsl_structs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.extract_hlsl_structs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Extract HLSL structs, cbuffers, ConstantBuffers, and template buffers.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_hlsl_structs</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract HLSL structs, cbuffers, ConstantBuffers, and template buffers.&quot;&quot;&quot;</span>
    <span class="n">structs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">struct_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(struct|cbuffer|ConstantBuffer&lt;(?P&lt;template&gt;\w+)&gt;)\s+(?P&lt;name&gt;\w+)\s*(?::\s*register\s*\(\w\d+\s*\))?\s*{(?P&lt;body&gt;[^</span><span class="si">{}</span><span class="s2">]*?)}&quot;</span>
    <span class="n">template_pattern</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;(?:RW)?(?:StructuredBuffer)&lt;(?P&lt;template&gt;\w+)&gt;\s+(?P&lt;name&gt;\w+)\s*:\s*register\s*\([a-z]\d+\s*\)&quot;</span>
    <span class="p">)</span>
    <span class="n">content_clean</span> <span class="o">=</span> <span class="n">preprocess_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">content_clean</span> <span class="o">=</span> <span class="n">clean_body</span><span class="p">(</span><span class="n">content_clean</span><span class="p">)</span>

    <span class="c1"># Extract structs, cbuffers, and ConstantBuffers</span>
    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">finditer_with_line_numbers</span><span class="p">(</span><span class="n">struct_pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping struct/buffer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (built-in type) in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">clean_body</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">is_cbuffer</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;cbuffer&quot;</span>
        <span class="n">is_constant_buffer</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ConstantBuffer&quot;</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">:=</span> <span class="n">parse_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">))]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">calculate_struct_size</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">align_to_16</span><span class="o">=</span><span class="n">is_cbuffer</span> <span class="ow">or</span> <span class="n">is_constant_buffer</span><span class="p">)</span>
        <span class="n">structs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">,</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_number</span><span class="p">,</span>
            <span class="s2">&quot;is_cbuffer&quot;</span><span class="p">:</span> <span class="n">is_cbuffer</span><span class="p">,</span>
            <span class="s2">&quot;is_constant_buffer&quot;</span><span class="p">:</span> <span class="n">is_constant_buffer</span><span class="p">,</span>
            <span class="s2">&quot;is_template&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found HLSL </span><span class="si">{</span><span class="s1">&#39;cbuffer&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_cbuffer</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;ConstantBuffer&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">is_constant_buffer</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;struct&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span><span class="si">}</span><span class="s2"> fields, total size: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> bytes&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Second pass: extract and process template buffers</span>
    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">finditer_with_line_numbers</span><span class="p">(</span><span class="n">template_pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">):</span>
        <span class="n">template_type</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>

        <span class="c1"># Skip if template type is a base type</span>
        <span class="k">if</span> <span class="n">template_type</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping base type template </span><span class="si">{</span><span class="n">template_type</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># Only add template type if we don&#39;t already have a real definition</span>
        <span class="k">if</span> <span class="n">template_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">:</span>
            <span class="n">structs</span><span class="p">[</span><span class="n">template_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_number</span><span class="p">,</span>
                <span class="s2">&quot;is_cbuffer&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;is_template&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found template struct </span><span class="si">{</span><span class="n">template_type</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check if existing definition has actual fields (real struct vs empty template)</span>
            <span class="n">existing_struct</span> <span class="o">=</span> <span class="n">structs</span><span class="p">[</span><span class="n">template_type</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">existing_struct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">existing_struct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_template&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Skipping template </span><span class="si">{</span><span class="n">template_type</span><span class="si">}</span><span class="s2"> - real struct definition already exists with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">existing_struct</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> fields&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template </span><span class="si">{</span><span class="n">template_type</span><span class="si">}</span><span class="s2"> found but existing definition is also a template or empty&quot;</span><span class="p">)</span>

        <span class="c1"># Also add the instance as its own entry (only if not already exists)</span>
        <span class="k">if</span> <span class="n">template_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">:</span>
            <span class="n">structs</span><span class="p">[</span><span class="n">template_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_number</span><span class="p">,</span>
                <span class="s2">&quot;is_cbuffer&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;is_template&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;template_type&quot;</span><span class="p">:</span> <span class="n">template_type</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">return</span> <span class="n">structs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.extract_matrix_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_matrix_size</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.extract_matrix_size" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Extract matrix dimensions from names like XMFLOAT3X4.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>field_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field type, potentially namespaced (e.g., REX::XMFLOAT3X4).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, int] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, int] | None: (rows, columns) if matched, else None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_matrix_size</span><span class="p">(</span><span class="n">field_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract matrix dimensions from names like XMFLOAT3X4.</span>

<span class="sd">    Args:</span>
<span class="sd">        field_type (str): The field type, potentially namespaced (e.g., REX::XMFLOAT3X4).</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, int] | None: (rows, columns) if matched, else None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;FLOAT(\d)X(\d)&quot;</span><span class="p">,</span> <span class="n">field_type</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.extract_structs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_structs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">is_hlsl</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.extract_structs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Extract structs from HLSL or C++ content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>content</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file content to parse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>is_hlsl</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the content is HLSL (True) or C++ (False).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the file for logging and linking.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, dict]: Dictionary of struct names to their metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_structs</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_hlsl</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract structs from HLSL or C++ content.</span>

<span class="sd">    Args:</span>
<span class="sd">        content (str): The file content to parse.</span>
<span class="sd">        is_hlsl (bool): Whether the content is HLSL (True) or C++ (False).</span>
<span class="sd">        file_path (str): Path to the file for logging and linking.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, dict]: Dictionary of struct names to their metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extracting structs from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">extract_hlsl_structs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_hlsl</span> <span class="k">else</span> <span class="n">extract_cpp_structs</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.finditer_with_line_numbers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finditer_with_line_numbers</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_map</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.finditer_with_line_numbers" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find matches of a pattern in a string, returning match objects with adjusted line numbers.</p>
<p>This function accounts for <code>#line</code> directives and a line map for preprocessed content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pattern</code></td>
            <td>
                  <code>str | <span title="re.Pattern">Pattern</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The regular expression pattern to match.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>string</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input string to search.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>flags</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regular expression flags. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>line_map</code></td>
            <td>
                  <code>dict[int, int] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of preprocessed to original line numbers.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[tuple[int, <span title="re.Match">Match</span>[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[tuple[int, Match[str]]]: A list of tuples containing the adjusted line number and match object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">finditer_with_line_numbers</span><span class="p">(</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">flags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">line_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find matches of a pattern in a string, returning match objects with adjusted line numbers.</span>

<span class="sd">    This function accounts for `#line` directives and a line map for preprocessed content.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern: The regular expression pattern to match.</span>
<span class="sd">        string: The input string to search.</span>
<span class="sd">        flags: Regular expression flags. Defaults to 0.</span>
<span class="sd">        line_map: Mapping of preprocessed to original line numbers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple[int, Match[str]]]: A list of tuples containing the adjusted line number and match object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Handle pcpp info on skipped lines</span>
    <span class="n">line_offsets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()):</span>
        <span class="n">line_adjust</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^#line (?P&lt;line&gt;[0-9]+) </span><span class="se">\&quot;</span><span class="s2">(?P&lt;filename&gt;.*)</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
        <span class="n">line_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line_adjust</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line_match</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">))</span> <span class="o">-</span> <span class="n">line_number</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">line_offsets</span><span class="p">[</span><span class="n">line_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>

    <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">flags</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">newline_table</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">newline_table</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">result</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">newline_offset</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
        <span class="n">line_number</span> <span class="o">=</span> <span class="n">newline_table</span><span class="p">[</span><span class="n">newline_offset</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Add 1 since line numbers are 1-based</span>
        <span class="c1"># Apply line_map if provided</span>
        <span class="k">if</span> <span class="n">line_map</span> <span class="ow">and</span> <span class="n">line_number</span> <span class="ow">in</span> <span class="n">line_map</span><span class="p">:</span>
            <span class="n">line_number</span> <span class="o">=</span> <span class="n">line_map</span><span class="p">[</span><span class="n">line_number</span><span class="p">]</span>
        <span class="c1"># Apply #line directive offset</span>
        <span class="n">found_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">line_offsets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">line_number</span><span class="p">:</span>
                <span class="n">found_offset</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">adjusted_line</span> <span class="o">=</span> <span class="n">line_number</span> <span class="o">+</span> <span class="n">found_offset</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">adjusted_line</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.fuzzy_lcs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fuzzy_lcs</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">,</span> <span class="n">cpp_fields</span><span class="p">,</span> <span class="n">name_sim_threshold</span><span class="o">=</span><span class="n">NAME_SIM_THRESHOLD</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.fuzzy_lcs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Fuzzy sequence matching using difflib for field alignment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>hlsl_fields</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of HLSL field dictionaries</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpp_fields</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of C++ field dictionaries</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name_sim_threshold</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity threshold</p>
              </div>
            </td>
            <td>
                  <code><span title="hlslkit.buffer_scan.NAME_SIM_THRESHOLD">NAME_SIM_THRESHOLD</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[tuple[int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[tuple[int, int]]: List of matching index pairs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fuzzy_lcs</span><span class="p">(</span>
    <span class="n">hlsl_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">cpp_fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">name_sim_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">NAME_SIM_THRESHOLD</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fuzzy sequence matching using difflib for field alignment.</span>

<span class="sd">    Args:</span>
<span class="sd">        hlsl_fields: List of HLSL field dictionaries</span>
<span class="sd">        cpp_fields: List of C++ field dictionaries</span>
<span class="sd">        name_sim_threshold: Minimum similarity threshold</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple[int, int]]: List of matching index pairs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">used_cpp_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># For each HLSL field, find its best C++ match</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">hlsl_field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hlsl_fields</span><span class="p">):</span>
        <span class="n">best_match_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">best_similarity</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">cpp_field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cpp_fields</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">used_cpp_indices</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">sim</span> <span class="o">=</span> <span class="n">compute_name_similarity</span><span class="p">(</span><span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">sim</span> <span class="o">&gt;=</span> <span class="n">name_sim_threshold</span> <span class="ow">and</span> <span class="n">sim</span> <span class="o">&gt;</span> <span class="n">best_similarity</span><span class="p">:</span>
                <span class="n">best_similarity</span> <span class="o">=</span> <span class="n">sim</span>
                <span class="n">best_match_idx</span> <span class="o">=</span> <span class="n">j</span>

        <span class="c1"># Add the best match if found</span>
        <span class="k">if</span> <span class="n">best_match_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">best_match_idx</span><span class="p">))</span>
            <span class="n">used_cpp_indices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">best_match_idx</span><span class="p">)</span>
            <span class="c1"># logging.debug(</span>
            <span class="c1">#     f&quot;  Match found ({i},{best_match_idx}): {hlsl_field[&#39;name&#39;]} &lt;-&gt; {cpp_fields[best_match_idx][&#39;name&#39;]} (sim: {best_similarity:.3f})&quot;</span>
            <span class="c1"># )</span>

    <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.generate_comparison_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_comparison_table</span><span class="p">(</span><span class="n">hlsl_name</span><span class="p">,</span> <span class="n">cpp_name</span><span class="p">,</span> <span class="n">hlsl_data</span><span class="p">,</span> <span class="n">cpp_data</span><span class="p">,</span> <span class="n">align_matches</span><span class="p">,</span> <span class="n">report</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">section_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_top_candidate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.generate_comparison_table" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate a comparison table for a pair of HLSL and C++ structs.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_comparison_table</span><span class="p">(</span>
    <span class="n">hlsl_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cpp_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">hlsl_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">,</span>
    <span class="n">cpp_data</span><span class="p">:</span> <span class="n">StructDict</span><span class="p">,</span>
    <span class="n">align_matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">FieldDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]],</span>
    <span class="n">report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StructDict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">section_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_top_candidate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a comparison table for a pair of HLSL and C++ structs.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid hlsl_data type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">)</span><span class="si">}</span><span class="s2">, expected dict&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: Invalid HLSL data for </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># Determine if we have a real match</span>
    <span class="n">has_cpp_match</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">cpp_name</span> <span class="ow">and</span> <span class="n">cpp_data</span> <span class="ow">and</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">is_rejected_candidate</span> <span class="o">=</span> <span class="s2">&quot;(top candidate - rejected)&quot;</span> <span class="ow">in</span> <span class="n">cpp_name</span> <span class="k">if</span> <span class="n">cpp_name</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="c1"># If showing top candidate and no accepted match, use the top candidate from candidates list</span>
    <span class="k">if</span> <span class="n">show_top_candidate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_cpp_match</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_rejected_candidate</span> <span class="ow">and</span> <span class="n">candidates</span><span class="p">:</span>
        <span class="n">top_candidate</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># candidates should be [(name, data, score, align_matches, report), ...]</span>
        <span class="n">cpp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">top_candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (top candidate - rejected)&quot;</span>
        <span class="n">cpp_data</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Use pre-computed alignment data if available (candidates with 5 elements)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_candidate</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">align_matches</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">report</span> <span class="o">=</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback: compute alignment for legacy candidate format</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">align_structs</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="n">cpp_data</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">align_matches</span><span class="p">,</span> <span class="n">report</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Ensure we have some basic data even if alignment fails</span>
                <span class="n">align_matches</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">report</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">top_candidate</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;field_diff_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">is_rejected_candidate</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">table</span> <span class="o">=</span> <span class="s2">&quot;---</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># Add a section anchor for cross-linking</span>
    <span class="k">if</span> <span class="n">section_id</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;a id=&quot;</span><span class="si">{</span><span class="n">section_id</span><span class="si">}</span><span class="s1">&quot;&gt;&lt;/a&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">depth</span><span class="si">}</span><span class="s2"> HLSL `</span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2">` (</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;**HLSL File:** [</span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">create_link</span><span class="p">(</span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># Handle unmatched case</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_cpp_match</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_rejected_candidate</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**No matching C++ struct found**</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Summary section for unmatched structs</span>
        <span class="n">hlsl_fields</span> <span class="o">=</span> <span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">hlsl_total_fields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">hlsl_fields</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_padding_field</span><span class="p">(</span><span class="n">f</span><span class="p">)])</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> Summary:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Total HLSL Fields: </span><span class="si">{</span><span class="n">hlsl_total_fields</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="s2">&quot;- Status: Unmatched</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Handle matched or rejected candidate case</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**C++**: `</span><span class="si">{</span><span class="n">cpp_name</span><span class="si">}</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;**C++ File:** [</span><span class="si">{</span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">create_link</span><span class="p">(</span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">cpp_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**Match Score:** </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Field comparison table (for both matched and rejected candidates)</span>
        <span class="c1"># Always try to show field comparison for matched/rejected candidates</span>
        <span class="k">if</span> <span class="n">has_cpp_match</span> <span class="ow">or</span> <span class="n">is_rejected_candidate</span><span class="p">:</span>
            <span class="c1"># If we don&#39;t have alignment data, compute it now</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">align_matches</span> <span class="ow">and</span> <span class="n">cpp_data</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">align_structs</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="n">cpp_data</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">align_matches</span><span class="p">,</span> <span class="n">computed_report</span> <span class="o">=</span> <span class="n">result</span>
                    <span class="c1"># Update report with computed data if we don&#39;t have good data</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span> <span class="ow">or</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">report</span> <span class="o">=</span> <span class="n">computed_report</span>

            <span class="k">if</span> <span class="n">align_matches</span><span class="p">:</span>
                <span class="n">field_rows</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">rows_with_differences</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_diff_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">hlsl_field</span><span class="p">,</span> <span class="n">cpp_field</span> <span class="ow">in</span> <span class="n">align_matches</span><span class="p">:</span>
                    <span class="n">hlsl_field_name</span> <span class="o">=</span> <span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">hlsl_field</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">hlsl_field_type</span> <span class="o">=</span> <span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">hlsl_field</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">cpp_field_name</span> <span class="o">=</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">cpp_field</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">cpp_field_type</span> <span class="o">=</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">cpp_field</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

                    <span class="c1"># Compute similarities and apply emphasis</span>
                    <span class="k">if</span> <span class="n">hlsl_field</span> <span class="ow">and</span> <span class="n">cpp_field</span><span class="p">:</span>
                        <span class="n">type_sim</span> <span class="o">=</span> <span class="n">jellyfish</span><span class="o">.</span><span class="n">jaro_winkler_similarity</span><span class="p">(</span><span class="n">hlsl_field_type</span><span class="p">,</span> <span class="n">cpp_field_type</span><span class="p">)</span>
                        <span class="c1"># For emphasis, use exact string comparison to catch array notation differences</span>
                        <span class="n">exact_name_match</span> <span class="o">=</span> <span class="n">hlsl_field_name</span> <span class="o">==</span> <span class="n">cpp_field_name</span>

                    <span class="c1"># Apply emphasis using helper</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">hlsl_field</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cpp_field</span><span class="p">:</span>
                        <span class="n">hlsl_field_type</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">hlsl_field_type</span><span class="p">)</span>
                        <span class="n">hlsl_field_name</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">hlsl_field_name</span><span class="p">)</span>
                        <span class="n">cpp_field_type</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">cpp_field_type</span><span class="p">)</span>
                        <span class="n">cpp_field_name</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">cpp_field_name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Use exact match for emphasis to catch array notation differences</span>
                        <span class="n">hlsl_field_name</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="ow">not</span> <span class="n">exact_name_match</span><span class="p">,</span> <span class="n">hlsl_field_name</span><span class="p">)</span>
                        <span class="n">cpp_field_name</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="ow">not</span> <span class="n">exact_name_match</span><span class="p">,</span> <span class="n">cpp_field_name</span><span class="p">)</span>
                        <span class="n">hlsl_field_type</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="n">type_sim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hlsl_field_type</span><span class="p">)</span>
                        <span class="n">cpp_field_type</span> <span class="o">=</span> <span class="n">emphasize_if</span><span class="p">(</span><span class="n">type_sim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cpp_field_type</span><span class="p">)</span>

                    <span class="n">field_rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;HLSL Type&quot;</span><span class="p">:</span> <span class="n">hlsl_field_type</span><span class="p">,</span>
                        <span class="s2">&quot;HLSL Field&quot;</span><span class="p">:</span> <span class="n">hlsl_field_name</span><span class="p">,</span>
                        <span class="s2">&quot;C++ Type&quot;</span><span class="p">:</span> <span class="n">cpp_field_type</span><span class="p">,</span>
                        <span class="s2">&quot;C++ Field&quot;</span><span class="p">:</span> <span class="n">cpp_field_name</span><span class="p">,</span>
                    <span class="p">})</span>

                <span class="c1"># Determine if we should default to closed</span>
                <span class="n">should_close</span> <span class="o">=</span> <span class="n">rows_with_differences</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;details</span><span class="si">{</span><span class="s1">&#39;&gt;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">should_close</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39; open&gt;&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;summary&gt;</span><span class="si">{</span><span class="n">rows_with_differences</span><span class="si">}</span><span class="s2"> Field Differences&lt;/summary&gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

                <span class="c1"># Generate table using py_markdown_table</span>
                <span class="k">if</span> <span class="n">field_rows</span><span class="p">:</span>
                    <span class="n">table</span> <span class="o">+=</span> <span class="n">markdown_table</span><span class="p">(</span><span class="n">field_rows</span><span class="p">)</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">row_sep</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">get_markdown</span><span class="p">()</span>

                <span class="n">table</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;/details&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Summary section for matched structs</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> Summary:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Exact Field Matches: </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exact_matches&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- High Similarity Field Matches: </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;high_sim_matches&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">hlsl_total_fields</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;total_fields&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">cpp_total_fields</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpp_total_fields&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Total HLSL Fields: </span><span class="si">{</span><span class="n">hlsl_total_fields</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Total C++ Fields: </span><span class="si">{</span><span class="n">cpp_total_fields</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Field Name Differences: </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field_name_diff_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- Field Type Differences: </span><span class="si">{</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field_type_diff_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># Always show candidates in a details section</span>
    <span class="k">if</span> <span class="n">candidates</span><span class="p">:</span>
        <span class="n">total_candidates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;details&gt;</span><span class="se">\n</span><span class="s2">&lt;summary&gt;Top 5 of </span><span class="si">{</span><span class="n">total_candidates</span><span class="si">}</span><span class="s2"> Candidates Reviewed&lt;/summary&gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">candidate_rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
            <span class="c1"># Handle both old and new candidate formats</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">cand_name</span><span class="p">,</span> <span class="n">cand_data</span><span class="p">,</span> <span class="n">cand_score</span> <span class="o">=</span> <span class="n">candidate</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cand_name</span><span class="p">,</span> <span class="n">cand_data</span><span class="p">,</span> <span class="n">cand_score</span> <span class="o">=</span> <span class="n">candidate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">candidate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Count fields in candidate</span>
            <span class="n">cand_fields</span> <span class="o">=</span> <span class="n">cand_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">field_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cand_fields</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_padding_field</span><span class="p">(</span><span class="n">f</span><span class="p">)])</span>

            <span class="n">candidate_rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;Candidate Name&quot;</span><span class="p">:</span> <span class="n">cand_name</span><span class="p">,</span>
                <span class="s2">&quot;File&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">cand_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">cand_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">create_link</span><span class="p">(</span><span class="n">cand_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">cand_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Fields&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_count</span><span class="p">),</span>
                <span class="s2">&quot;Similarity&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cand_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="n">table</span> <span class="o">+=</span> <span class="n">markdown_table</span><span class="p">(</span><span class="n">candidate_rows</span><span class="p">)</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">row_sep</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">get_markdown</span><span class="p">()</span>
        <span class="n">table</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;/details&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.get_defines_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_defines_list</span><span class="p">()</span></code>

<a href="#hlslkit.buffer_scan.get_defines_list" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Return a list of preprocessor define combinations for HLSL compilation.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[dict[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, str]]: A list of dictionaries containing preprocessor defines.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_defines_list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of preprocessor define combinations for HLSL compilation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, str]]: A list of dictionaries containing preprocessor defines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;VR&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;VR&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.get_excluded_dirs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_excluded_dirs</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.get_excluded_dirs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get directories to exclude based on .gitignore and default exclusions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cwd</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current working directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>set[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>set[str]: Set of directory names to exclude.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_excluded_dirs</span><span class="p">(</span><span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get directories to exclude based on .gitignore and default exclusions.</span>

<span class="sd">    Args:</span>
<span class="sd">        cwd: Current working directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        set[str]: Set of directory names to exclude.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_exclusions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;build&quot;</span><span class="p">,</span> <span class="s2">&quot;extern&quot;</span><span class="p">,</span> <span class="s2">&quot;tools&quot;</span><span class="p">,</span> <span class="s2">&quot;include&quot;</span><span class="p">}</span>
    <span class="n">excluded_dirs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">default_exclusions</span><span class="p">)</span>

    <span class="n">gitignore_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;.gitignore&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">gitignore_path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pathspec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.gitignore not found or pathspec not available, using default exclusions: </span><span class="si">{</span><span class="n">excluded_dirs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">excluded_dirs</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gitignore_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">pathspec</span><span class="o">.</span><span class="n">PathSpec</span><span class="o">.</span><span class="n">from_lines</span><span class="p">(</span><span class="s2">&quot;gitwildmatch&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
            <span class="c1"># Extract directory names from patterns</span>
            <span class="n">pattern_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pattern_str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
                <span class="n">dir_name</span> <span class="o">=</span> <span class="n">pattern_str</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dir_name</span><span class="p">:</span>
                    <span class="n">excluded_dirs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse .gitignore: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Using default exclusions: </span><span class="si">{</span><span class="n">excluded_dirs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">excluded_dirs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.get_field_similarity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_field_similarity</span><span class="p">(</span><span class="n">cpp_field</span><span class="p">,</span> <span class="n">hlsl_field</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.get_field_similarity" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Enhanced field similarity that handles array type equivalence.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cpp_field</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>C++ field metadata containing name, type and size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_field</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HLSL field metadata containing name, type and size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[float, float, bool]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[float, float, bool]: A tuple containing:
- type_sim: Type similarity (0.0 to 1.0)
- name_sim: Name similarity score (0.0 to 1.0)
- size_match: Whether field sizes match exactly</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_field_similarity</span><span class="p">(</span><span class="n">cpp_field</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">hlsl_field</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhanced field similarity that handles array type equivalence.</span>

<span class="sd">    Args:</span>
<span class="sd">        cpp_field: C++ field metadata containing name, type and size.</span>
<span class="sd">        hlsl_field: HLSL field metadata containing name, type and size.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[float, float, bool]: A tuple containing:</span>
<span class="sd">            - type_sim: Type similarity (0.0 to 1.0)</span>
<span class="sd">            - name_sim: Name similarity score (0.0 to 1.0)</span>
<span class="sd">            - size_match: Whether field sizes match exactly</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use compute_name_similarity which handles array notation internally</span>
    <span class="n">name_sim</span> <span class="o">=</span> <span class="n">compute_name_similarity</span><span class="p">(</span><span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

    <span class="c1"># Normalize types for comparison</span>
    <span class="n">hlsl_norm</span><span class="p">,</span> <span class="n">cpp_norm</span> <span class="o">=</span> <span class="n">normalize_array_types</span><span class="p">(</span><span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>

    <span class="c1"># Check for exact type match after normalization</span>
    <span class="k">if</span> <span class="n">hlsl_norm</span> <span class="o">==</span> <span class="n">cpp_norm</span><span class="p">:</span>
        <span class="n">type_sim</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fall back to string similarity for types that don&#39;t normalize</span>
        <span class="n">type_sim</span> <span class="o">=</span> <span class="n">jellyfish</span><span class="o">.</span><span class="n">jaro_winkler_similarity</span><span class="p">(</span><span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">type_sim</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
            <span class="n">type_sim</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Direct size comparison</span>
    <span class="n">size_match</span> <span class="o">=</span> <span class="n">cpp_field</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hlsl_field</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">type_sim</span><span class="p">,</span> <span class="n">name_sim</span><span class="p">,</span> <span class="n">size_match</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.get_field_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_field_size</span><span class="p">(</span><span class="n">field_type</span><span class="p">,</span> <span class="n">array_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.get_field_size" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate the size in bytes of a field based on its type and array size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>field_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type name (e.g., 'float4', 'XMFLOAT4X4[3]', or pointer types).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>array_size</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional array multiplier (default: 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>The size in bytes</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, bool]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>A flag indicating if the type is unknown (True) or recognized (False)</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_field_size</span><span class="p">(</span><span class="n">field_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">array_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the size in bytes of a field based on its type and array size.</span>

<span class="sd">    Args:</span>
<span class="sd">        field_type: The type name (e.g., &#39;float4&#39;, &#39;XMFLOAT4X4[3]&#39;, or pointer types).</span>
<span class="sd">        array_size: Optional additional array multiplier (default: 1).</span>

<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - The size in bytes</span>
<span class="sd">        - A flag indicating if the type is unknown (True) or recognized (False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_type</span><span class="p">,</span> <span class="n">parsed_array_size</span> <span class="o">=</span> <span class="n">parse_type_with_array</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>
    <span class="n">array_size</span> <span class="o">*=</span> <span class="n">parsed_array_size</span>

    <span class="k">if</span> <span class="n">base_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">POINTER_SIZE</span> <span class="o">*</span> <span class="n">array_size</span><span class="p">,</span> <span class="kc">False</span>  <span class="c1"># Assume 64-bit pointer</span>

    <span class="n">norm_type</span> <span class="o">=</span> <span class="n">normalize_field_type</span><span class="p">(</span><span class="n">base_type</span><span class="p">)</span>

    <span class="c1"># Handle floatNxM matrix</span>
    <span class="k">if</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;float(\d)x(\d)&quot;</span><span class="p">,</span> <span class="n">norm_type</span><span class="p">):</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span> <span class="o">*</span> <span class="n">array_size</span><span class="p">,</span> <span class="kc">False</span>  <span class="c1"># 4 bytes per float</span>

    <span class="n">size</span> <span class="o">=</span> <span class="n">BASE_TYPE_SIZES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">norm_type</span><span class="p">,</span> <span class="n">DEFAULT_TYPE_SIZE</span><span class="p">)</span>
    <span class="n">is_unknown</span> <span class="o">=</span> <span class="n">size</span> <span class="o">==</span> <span class="n">DEFAULT_TYPE_SIZE</span> <span class="ow">and</span> <span class="n">norm_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span>
    <span class="k">return</span> <span class="n">size</span> <span class="o">*</span> <span class="n">array_size</span><span class="p">,</span> <span class="n">is_unknown</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.get_hlsl_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_hlsl_types</span><span class="p">()</span></code>

<a href="#hlslkit.buffer_scan.get_hlsl_types" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Return a mapping of HLSL register types to their descriptions.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, str]: A dictionary mapping register types to their descriptions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_hlsl_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a mapping of HLSL register types to their descriptions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str]: A dictionary mapping register types to their descriptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># https://learn.microsoft.com/en-us/windows/win32/direct3d12/resource-binding-in-hlsl</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;SRV&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="s2">&quot;UAV&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="s2">&quot;Sampler&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;CBV&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.get_struct_signature" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_struct_signature</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.get_struct_signature" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate a signature for a struct based on field names, types, and sizes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fields</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of field dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Struct signature string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_struct_signature</span><span class="p">(</span><span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a signature for a struct based on field names, types, and sizes.</span>

<span class="sd">    Args:</span>
<span class="sd">        fields (list[dict]): List of field dictionaries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Struct signature string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">norm_type</span> <span class="o">=</span> <span class="n">normalize_field_type</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
        <span class="n">signature</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">norm_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">field</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sig_str</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sig_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.is_padding_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_padding_field</span><span class="p">(</span><span class="n">field</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.is_padding_field" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Check if a field is a padding field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>field</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field dictionary containing name and type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the field is a padding field.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_padding_field</span><span class="p">(</span><span class="n">field</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a field is a padding field.</span>

<span class="sd">    Args:</span>
<span class="sd">        field: Field dictionary containing name and type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the field is a padding field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># Remove array size from name for comparison</span>
    <span class="n">base_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="k">else</span> <span class="n">name</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">base_name</span> <span class="o">==</span> <span class="s2">&quot;pad&quot;</span>
        <span class="ow">or</span> <span class="n">base_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_pad&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">base_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pad&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">base_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;pad&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">base_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;padding&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">base_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;padding&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">base_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_padding&quot;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">base_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_padding&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

<a href="#hlslkit.buffer_scan.main" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Main entry point for scanning HLSL shaders and generating a buffer table.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for scanning HLSL shaders and generating a buffer table.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Scan HLSL/C++ buffers and print struct analysis.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--only-matched&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Only print buffers with matched or mismatched struct analysis (default: print all discovered buffers)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--show-top-candidate&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show fields of the top candidate struct even if the match was rejected&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--show-conflicts&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show register conflicts analysis (default: disabled)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">FileScanner</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    <span class="n">defines_list</span> <span class="o">=</span> <span class="n">get_defines_list</span><span class="p">()</span>
    <span class="n">shader_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;(?P&lt;type&gt;</span>
<span class="sd">                (?:cbuffer|ConstantBuffer&lt;(?P&lt;template_type&gt;\w+)&gt;) |</span>
<span class="sd">                (?:(?:RW)?(?:StructuredBuffer|Buffer|Texture1D|Texture2D|Texture3D|TextureCube|RWBuffer|RWTexture1D|RWTexture2D|RWTexture3D|RWTextureCube|SamplerState|SamplerComparisonState))</span>
<span class="sd">                (?:&lt;(?P&lt;template_name&gt;\w+)&gt;)?</span>
<span class="sd">            )</span>
<span class="sd">            \s+</span>
<span class="sd">            (?P&lt;name&gt;\w+)</span>
<span class="sd">            \s*:\s*register\s*\(</span>
<span class="sd">                (?P&lt;buffer_type&gt;[a-z])</span>
<span class="sd">                (?P&lt;buffer_number&gt;\d+)</span>
<span class="sd">            \)</span>
<span class="sd">            (?:\s*;\s*|$)</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">hlsl_types</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;CBV&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;SRV&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="s2">&quot;UAV&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="s2">&quot;Sampler&quot;</span><span class="p">}</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.*\.(hlsl|hlsli)$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">feature_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;features[/</span><span class="se">\\</span><span class="s2">](?P&lt;feature&gt;[^/</span><span class="se">\\</span><span class="s2">]+)&quot;</span><span class="p">)</span>

    <span class="n">results</span><span class="p">,</span> <span class="n">compilation_units</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">scan_for_buffers</span><span class="p">(</span>
        <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span>
        <span class="n">feature_pattern</span><span class="o">=</span><span class="n">feature_pattern</span><span class="p">,</span>
        <span class="n">shader_pattern</span><span class="o">=</span><span class="n">shader_pattern</span><span class="p">,</span>
        <span class="n">hlsl_types</span><span class="o">=</span><span class="n">hlsl_types</span><span class="p">,</span>
        <span class="n">defines_list</span><span class="o">=</span><span class="n">defines_list</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">result_map</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;File Path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">results</span><span class="p">}</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result map contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result_map</span><span class="p">)</span><span class="si">}</span><span class="s2"> entries: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">result_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">hlsl_structs</span><span class="p">,</span> <span class="n">cpp_structs</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">scan_for_structs</span><span class="p">()</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">StructAnalyzer</span><span class="p">(</span><span class="n">hlsl_structs</span><span class="p">,</span> <span class="n">cpp_structs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">)</span>
        <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Original Line&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">buffer_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analyzer</span><span class="o">.</span><span class="n">add_buffer_location</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">buffer_name</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

    <span class="n">analyzer</span><span class="o">.</span><span class="n">compare_all_structs</span><span class="p">(</span><span class="n">result_map</span><span class="p">)</span>
    <span class="n">analyzer</span><span class="o">.</span><span class="n">update_result_map</span><span class="p">(</span><span class="n">result_map</span><span class="p">)</span>

    <span class="c1"># Add all struct definitions to buffer_locations for printing</span>
    <span class="k">for</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">hlsl_struct_list</span> <span class="ow">in</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">hlsl_structs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">hlsl_data</span> <span class="ow">in</span> <span class="n">hlsl_struct_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hlsl_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">hlsl_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">analyzer</span><span class="o">.</span><span class="n">add_buffer_location</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">hlsl_name</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added struct definition to buffer_locations: </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping struct </span><span class="si">{</span><span class="n">hlsl_name</span><span class="si">}</span><span class="s2"> - no file information&quot;</span><span class="p">)</span>
    <span class="n">print_buffers_and_conflicts</span><span class="p">(</span><span class="n">result_map</span><span class="p">,</span> <span class="n">compilation_units</span><span class="p">,</span> <span class="n">show_conflicts</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">show_conflicts</span><span class="p">)</span>
    <span class="n">analyzer</span><span class="o">.</span><span class="n">print_comparison_tables</span><span class="p">(</span><span class="n">only_matched</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">only_matched</span><span class="p">,</span> <span class="n">show_top_candidate</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">show_top_candidate</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.normalize_array_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_array_types</span><span class="p">(</span><span class="n">hlsl_type</span><span class="p">,</span> <span class="n">cpp_type</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.normalize_array_types" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Normalize HLSL vector types and C++ array types for comparison.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_array_types</span><span class="p">(</span><span class="n">hlsl_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cpp_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize HLSL vector types and C++ array types for comparison.&quot;&quot;&quot;</span>
    <span class="c1"># HLSL vector to C++ array mapping</span>
    <span class="n">hlsl_to_cpp</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;float2&quot;</span><span class="p">:</span> <span class="s2">&quot;float[2]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;float3&quot;</span><span class="p">:</span> <span class="s2">&quot;float[3]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;float4&quot;</span><span class="p">:</span> <span class="s2">&quot;float[4]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int2&quot;</span><span class="p">:</span> <span class="s2">&quot;int[2]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int3&quot;</span><span class="p">:</span> <span class="s2">&quot;int[3]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int4&quot;</span><span class="p">:</span> <span class="s2">&quot;int[4]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uint2&quot;</span><span class="p">:</span> <span class="s2">&quot;uint[2]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uint3&quot;</span><span class="p">:</span> <span class="s2">&quot;uint[3]&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uint4&quot;</span><span class="p">:</span> <span class="s2">&quot;uint[4]&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Normalize HLSL type to equivalent C++ array</span>
    <span class="n">normalized_hlsl</span> <span class="o">=</span> <span class="n">hlsl_to_cpp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hlsl_type</span><span class="p">,</span> <span class="n">hlsl_type</span><span class="p">)</span>

    <span class="c1"># Extract base type and size from C++ array notation</span>
    <span class="n">cpp_array_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w+)\[(\d+)\]&quot;</span><span class="p">,</span> <span class="n">cpp_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpp_array_match</span><span class="p">:</span>
        <span class="n">base_type</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">cpp_array_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">normalized_cpp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_type</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normalized_cpp</span> <span class="o">=</span> <span class="n">cpp_type</span>

    <span class="k">return</span> <span class="n">normalized_hlsl</span><span class="p">,</span> <span class="n">normalized_cpp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.normalize_field_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_field_type</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.normalize_field_type" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Normalize a field type string to a canonical HLSL-like form (e.g., float4x4).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>field_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original field type (e.g., 'REX::W32::XMFLOAT4X4', 'float3').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized type, e.g., 'float4x4' or 'float3'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_field_type</span><span class="p">(</span><span class="n">field_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize a field type string to a canonical HLSL-like form (e.g., float4x4).</span>

<span class="sd">    Args:</span>
<span class="sd">        field_type (str): Original field type (e.g., &#39;REX::W32::XMFLOAT4X4&#39;, &#39;float3&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Normalized type, e.g., &#39;float4x4&#39; or &#39;float3&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parse_type_with_array</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span>

    <span class="c1"># Handle XMFLOAT matrix types</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">:=</span> <span class="n">extract_matrix_size</span><span class="p">(</span><span class="n">base_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;XM&quot;</span> <span class="ow">in</span> <span class="n">base_type</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;xmfloat</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;float</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Strip namespaces and return last component</span>
    <span class="k">return</span> <span class="n">base_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.parse_type_with_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_type_with_array</span><span class="p">(</span><span class="n">field_type</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.parse_type_with_array" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Parse field type and extract array size if present.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>field_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type name, e.g., 'float4[4]'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[str, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[str, int]: A tuple containing the base type and array size (default 1).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_type_with_array</span><span class="p">(</span><span class="n">field_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse field type and extract array size if present.</span>

<span class="sd">    Args:</span>
<span class="sd">        field_type (str): The type name, e.g., &#39;float4[4]&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, int]: A tuple containing the base type and array size (default 1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.+?)\[(\d+)\]$&quot;</span><span class="p">,</span> <span class="n">field_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">field_type</span><span class="p">,</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.preprocess_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">defines</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.preprocess_content" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Preprocess HLSL content to include/exclude code based on defines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>content</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The HLSL content to preprocess.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>defines</code></td>
            <td>
                  <code>dict[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessor defines to apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessed content with applied defines.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">preprocess_content</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">defines</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess HLSL content to include/exclude code based on defines.</span>

<span class="sd">    Args:</span>
<span class="sd">        content (str): The HLSL content to preprocess.</span>
<span class="sd">        defines (dict[str, str]): Preprocessor defines to apply.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Preprocessed content with applied defines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">skip_depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#ifdef&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#ifndef&quot;</span><span class="p">):</span>
            <span class="n">macro</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">is_ifdef</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#ifdef&quot;</span><span class="p">)</span>
            <span class="n">should_include</span> <span class="o">=</span> <span class="p">(</span><span class="n">macro</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_ifdef</span> <span class="k">else</span> <span class="p">(</span><span class="n">macro</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">include</span><span class="p">:</span>
                <span class="n">skip_depth</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">should_include</span><span class="p">:</span>
                <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">skip_depth</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#else&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">skip_depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">include</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">include</span>
        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#endif&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">skip_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">skip_depth</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">skip_depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">include</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.print_buffers_and_conflicts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_buffers_and_conflicts</span><span class="p">(</span><span class="n">result_map</span><span class="p">,</span> <span class="n">compilation_units</span><span class="p">,</span> <span class="n">show_conflicts</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.print_buffers_and_conflicts" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Print the buffers and any conflicts as a markdown table and report.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>result_map</code></td>
            <td>
                  <code>dict[str, dict[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of unique buffer entries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>compilation_units</code></td>
            <td>
                  <code>dict[tuple[str, frozenset[str]], dict[str, set[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of register usage per compilation unit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>show_conflicts</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print conflict analysis sections.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">print_buffers_and_conflicts</span><span class="p">(</span>
    <span class="n">result_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">compilation_units</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
    <span class="n">show_conflicts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print the buffers and any conflicts as a markdown table and report.</span>

<span class="sd">    Args:</span>
<span class="sd">        result_map: Dictionary of unique buffer entries.</span>
<span class="sd">        compilation_units: Dictionary of register usage per compilation unit.</span>
<span class="sd">        show_conflicts: Whether to print conflict analysis sections.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result_map</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results found.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">sorted_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Register&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))),</span>
    <span class="p">)</span>
    <span class="n">rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;Register&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Register&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="s2">&quot;Feature&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Feature&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="s2">&quot;File&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
            <span class="s2">&quot;Shaders&quot;</span><span class="p">:</span> <span class="n">_format_shader_usage</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span>
            <span class="s2">&quot;Struct Analysis&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)),</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">sorted_results</span>
    <span class="p">]</span>

    <span class="c1"># Filter out entries with blank Type, Name, or File</span>
    <span class="n">filtered_results</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">entry</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">rows</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;!--&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEBUG INFORMATION (hidden):&quot;</span><span class="p">)</span>
    <span class="c1"># Print any debug information that was collected during analysis</span>
    <span class="k">for</span> <span class="n">debug_msg</span> <span class="ow">in</span> <span class="n">DEBUG_INFO</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">debug_msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Buffer Table (generated on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">markdown_table</span><span class="p">(</span><span class="n">filtered_results</span><span class="p">)</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">quote</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">row_sep</span><span class="o">=</span><span class="s2">&quot;markdown&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_markdown</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_conflicts</span><span class="p">:</span>
        <span class="n">conflicts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">defines</span><span class="p">),</span> <span class="n">registers</span> <span class="ow">in</span> <span class="n">compilation_units</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">reg</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">registers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">reg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
                        <span class="n">conflicts</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">conflicts</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;defines&quot;</span><span class="p">:</span> <span class="n">defines</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">conflicts</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Conflicts&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">reg</span><span class="p">,</span> <span class="n">conflict_list</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">conflicts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## </span><span class="si">{</span><span class="n">reg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">conflict</span> <span class="ow">in</span> <span class="n">conflict_list</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- **Path**: </span><span class="si">{</span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  **Defines**: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;defines&#39;</span><span class="p">]))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  **Features**: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Additional analysis: Check for register conflicts within same define context</span>
        <span class="n">register_conflicts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">sorted_results</span><span class="p">:</span>
            <span class="n">reg</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Register&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reg</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Group by register and define combination</span>
            <span class="n">define_combos</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Define Combinations&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">define_combos</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reg</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">combo</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">register_conflicts</span><span class="p">:</span>
                    <span class="n">register_conflicts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">register_conflicts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;File Path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Feature&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="p">})</span>

        <span class="c1"># Report register conflicts</span>
        <span class="n">true_conflicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">register_conflicts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">true_conflicts</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Register Conflicts (Same Register + Define Combination)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">conflicts</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">true_conflicts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">reg</span><span class="p">,</span> <span class="n">combo</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Register </span><span class="si">{</span><span class="n">reg</span><span class="si">}</span><span class="s2"> with defines: </span><span class="si">{</span><span class="n">combo</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">conflict</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;- **</span><span class="si">{</span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">** (</span><span class="si">{</span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) in `</span><span class="si">{</span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">` - Feature: </span><span class="si">{</span><span class="n">conflict</span><span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"># Register Conflicts&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;No register conflicts detected - all buffers use unique register slots within their define contexts.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.process_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">shader_pattern</span><span class="p">,</span> <span class="n">hlsl_types</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">short_path</span><span class="p">,</span> <span class="n">result_map</span><span class="p">,</span> <span class="n">compilation_units</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.process_file" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Process a shader file to extract buffers and update result maps.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_file</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">defines</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">shader_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">hlsl_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">short_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">result_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">compilation_units</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a shader file to extract buffers and update result maps.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_should_skip_buffer</span><span class="p">(</span><span class="n">buffer_name</span><span class="p">,</span> <span class="n">mapped_line</span><span class="p">,</span> <span class="n">original_lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">buffer_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">BASE_TYPE_SIZES</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping buffer </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> (built-in type) in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mapped_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">is_shader_io_struct</span><span class="p">(</span><span class="n">buffer_name</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping shader IO buffer: </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mapped_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mapped_line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping buffer </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> from include at preprocessed line </span><span class="si">{</span><span class="n">mapped_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mapped_line</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_lines</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">context_window</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mapped_line</span> <span class="o">-</span> <span class="n">context_window</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">original_lines</span><span class="p">),</span> <span class="n">mapped_line</span> <span class="o">+</span> <span class="n">context_window</span><span class="p">)</span>
        <span class="n">buffer_decl_filter</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">rf</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">(?:\s*</span>
<span class="s2">    (?:cbuffer|struct)\s+</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">buffer_name</span><span class="p">)</span><span class="si">}</span><span class="s2">\s*:\s*register\s*\([butsg]\d+\)</span>
<span class="s2">    |</span>
<span class="s2">    (?:[\w&lt;&gt;]+\s+)?</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">buffer_name</span><span class="p">)</span><span class="si">}</span><span class="s2">\s*:\s*register\s*\([butsg]\d+\)</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">original_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">buffer_decl_filter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping buffer </span><span class="si">{</span><span class="n">buffer_name</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mapped_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping invalid or missing file: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">original_contents</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c1"># Preprocess with pcpp, adding include paths</span>
        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">pcpp</span><span class="o">.</span><span class="n">Preprocessor</span><span class="p">()</span>
        <span class="n">include_dirs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;package&quot;</span><span class="p">,</span> <span class="s2">&quot;Shaders&quot;</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">common_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;package&quot;</span><span class="p">,</span> <span class="s2">&quot;Shaders&quot;</span><span class="p">,</span> <span class="s2">&quot;Common&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">common_dir</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">common_dir</span><span class="p">):</span>
                <span class="n">include_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

        <span class="n">features_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">features_dir</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">feature_dir</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">features_dir</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*/Shaders&quot;</span><span class="p">):</span>
                <span class="n">include_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">feature_dir</span><span class="p">))</span>

        <span class="n">aio_shaders_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;Shaders&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">aio_shaders_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;aio&quot;</span> <span class="ow">in</span> <span class="n">cwd</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">include_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aio_shaders_dir</span><span class="p">)</span>
        <span class="n">include_dirs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">include_dirs</span><span class="p">))</span>  <span class="c1"># remove duplicates</span>

        <span class="k">for</span> <span class="n">inc_dir</span> <span class="ow">in</span> <span class="n">include_dirs</span><span class="p">:</span>
            <span class="n">preprocessor</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">inc_dir</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defines</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">preprocessor</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">preprocessor</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">original_contents</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">io_buffer</span><span class="p">:</span>
            <span class="n">preprocessor</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">io_buffer</span><span class="p">)</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">io_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="c1"># Build line map: preprocessed line -&gt; original line</span>
        <span class="n">line_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">preprocessed_line</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_file</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">current_line</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">original_lines</span> <span class="o">=</span> <span class="n">original_contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">orig_line_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">line_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^#line\s+(\d+)\s+&quot;([^&quot;]*)&quot;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_match</span><span class="p">:</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">current_file</span> <span class="o">=</span> <span class="n">line_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="n">orig_line_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">current_line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">current_file</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">line_map</span><span class="p">[</span><span class="n">preprocessed_line</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_line</span>
                <span class="n">preprocessed_line</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">current_file</span> <span class="o">==</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">orig_line_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">original_lines</span><span class="p">[</span><span class="n">orig_line_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="n">orig_line_idx</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">orig_line_idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">current_line</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">line_map</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empty line map for </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">, assuming identity mapping&quot;</span><span class="p">)</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">original_contents</span>
            <span class="n">line_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))}</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> with defines: </span><span class="si">{</span><span class="n">defines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Process buffers</span>
        <span class="n">capture_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">finditer_with_line_numbers</span><span class="p">(</span>
            <span class="n">shader_pattern</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">line_map</span><span class="o">=</span><span class="n">line_map</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">capture_list</span><span class="p">:</span>
            <span class="n">mapped_line</span> <span class="o">=</span> <span class="n">line_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line_number</span><span class="p">)</span>
            <span class="n">buffer_name</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_should_skip_buffer</span><span class="p">(</span><span class="n">buffer_name</span><span class="p">,</span> <span class="n">mapped_line</span><span class="p">,</span> <span class="n">original_lines</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">path_with_line_no</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">short_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mapped_line</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_with_line_no</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Consistent key format</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">result_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">:</span>
                <span class="c1"># Extract template information from the full type match</span>
                <span class="n">full_type</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
                <span class="n">template_type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="c1"># Check for ConstantBuffer&lt;Type&gt; pattern</span>
                <span class="n">const_buffer_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;ConstantBuffer&lt;(\w+)&gt;&quot;</span><span class="p">,</span> <span class="n">full_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">const_buffer_match</span><span class="p">:</span>
                    <span class="n">template_type</span> <span class="o">=</span> <span class="n">const_buffer_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># Check for other template patterns like Texture2D&lt;half2&gt;</span>
                <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;template_name&quot;</span><span class="p">):</span>
                    <span class="n">template_type</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;template_name&quot;</span><span class="p">)</span>

                <span class="c1"># Create a key for this define combination</span>
                <span class="n">define_key</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">defines</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">if</span> <span class="n">defines</span> <span class="k">else</span> <span class="s2">&quot;no_defines&quot;</span>

                <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;Register&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;buffer_type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}{</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;buffer_number&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Feature&quot;</span><span class="p">:</span> <span class="n">feature</span><span class="p">,</span>
                    <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">full_type</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">buffer_name</span><span class="p">,</span>  <span class="c1"># This should be the actual buffer variable name</span>
                    <span class="s2">&quot;File&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">path_with_line_no</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">create_link</span><span class="p">(</span><span class="n">short_path</span><span class="p">,</span><span class="w"> </span><span class="n">mapped_line</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;File Path&quot;</span><span class="p">:</span> <span class="n">short_path</span><span class="p">,</span>  <span class="c1"># Store the file path separately</span>
                    <span class="s2">&quot;Register Type&quot;</span><span class="p">:</span> <span class="n">hlsl_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;buffer_type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;Buffer Type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;buffer_type&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;Number&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;buffer_number&quot;</span><span class="p">)),</span>
                    <span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;VR&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;Matching Struct Analysis&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Original Line&quot;</span><span class="p">:</span> <span class="n">mapped_line</span><span class="p">,</span>  <span class="c1"># Store original line number,</span>
                    <span class="s2">&quot;Template Type&quot;</span><span class="p">:</span> <span class="n">template_type</span><span class="p">,</span>
                    <span class="s2">&quot;Define Combinations&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>  <span class="c1"># Track define combinations</span>
                <span class="p">}</span>
                <span class="n">result_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="c1"># Record this define combination with consistent ordering</span>
            <span class="k">if</span> <span class="n">defines</span><span class="p">:</span>
                <span class="c1"># Create consistent define key with standard ordering</span>
                <span class="n">define_parts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s2">&quot;PSHADER&quot;</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                    <span class="n">define_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PSHADER&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;VSHADER&quot;</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                    <span class="n">define_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;VSHADER&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;VR&quot;</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                    <span class="n">define_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;VR&quot;</span><span class="p">)</span>
                <span class="n">define_key</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">define_parts</span><span class="p">)</span> <span class="k">if</span> <span class="n">define_parts</span> <span class="k">else</span> <span class="s2">&quot;no_defines&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">define_key</span> <span class="o">=</span> <span class="s2">&quot;no_defines&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;Define Combinations&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Define Combinations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;Define Combinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">define_key</span><span class="p">)</span>

            <span class="c1"># Update boolean flags</span>
            <span class="k">for</span> <span class="n">define</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="n">define</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="s2">&quot;PSHADER&quot;</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;PSHADER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="s2">&quot;VSHADER&quot;</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;VSHADER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="s2">&quot;VR&quot;</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;VR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">compilation_unit_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">short_path</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">defines</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">compilation_unit_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compilation_units</span><span class="p">:</span>
                <span class="n">compilation_units</span><span class="p">[</span><span class="n">compilation_unit_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">reg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;buffer_type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}{</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;buffer_number&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">reg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compilation_units</span><span class="p">[</span><span class="n">compilation_unit_key</span><span class="p">]:</span>
                <span class="n">compilation_units</span><span class="p">[</span><span class="n">compilation_unit_key</span><span class="p">][</span><span class="n">reg</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">compilation_units</span><span class="p">[</span><span class="n">compilation_unit_key</span><span class="p">][</span><span class="n">reg</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to process file </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.scan_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan_files</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">feature_pattern</span><span class="p">,</span> <span class="n">shader_pattern</span><span class="p">,</span> <span class="n">hlsl_types</span><span class="p">,</span> <span class="n">defines_list</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.scan_files" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Scan HLSL files for buffer definitions and track compilation units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cwd</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current working directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pattern</code></td>
            <td>
                  <code><span title="re.Pattern">Pattern</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compiled regex pattern to match HLSL files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>feature_pattern</code></td>
            <td>
                  <code><span title="re.Pattern">Pattern</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compiled regex pattern to extract feature names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_pattern</code></td>
            <td>
                  <code><span title="re.Pattern">Pattern</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compiled regex pattern for buffer definitions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>hlsl_types</code></td>
            <td>
                  <code>dict[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of HLSL register types to descriptions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>defines_list</code></td>
            <td>
                  <code>list[dict[str, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of preprocessor define dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[list[dict[str, <span title="typing.Any">Any</span>]], <span title="hlslkit.buffer_scan.CompilationUnits">CompilationUnits</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[list[dict[str, Any]], CompilationUnits]: A tuple containing the list of buffer entries and compilation units.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">scan_files</span><span class="p">(</span>
    <span class="n">cwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">feature_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">shader_pattern</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">hlsl_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">defines_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">CompilationUnits</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan HLSL files for buffer definitions and track compilation units.</span>

<span class="sd">    Args:</span>
<span class="sd">        cwd: The current working directory.</span>
<span class="sd">        pattern: Compiled regex pattern to match HLSL files.</span>
<span class="sd">        feature_pattern: Compiled regex pattern to extract feature names.</span>
<span class="sd">        shader_pattern: Compiled regex pattern for buffer definitions.</span>
<span class="sd">        hlsl_types: Mapping of HLSL register types to descriptions.</span>
<span class="sd">        defines_list: List of preprocessor define dictionaries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[list[dict[str, Any]], CompilationUnits]: A tuple containing the list of buffer entries and compilation units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">compilation_units</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">excluded_dirs</span> <span class="o">=</span> <span class="n">get_excluded_dirs</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">cwd</span><span class="p">):</span>
        <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_dirs</span><span class="p">]</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">root_normalized</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">feature_match</span> <span class="o">=</span> <span class="n">feature_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">root_normalized</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">feature_match</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">feature_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;feature&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">)):</span>
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="n">short_path_start</span> <span class="o">=</span> <span class="n">full_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;skyrim-community-shaders&quot;</span><span class="p">)</span>
                <span class="n">short_path</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">full_path</span><span class="p">[</span><span class="n">short_path_start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;skyrim-community-shaders&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
                    <span class="k">if</span> <span class="n">short_path_start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">cwd</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file: </span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">defines</span> <span class="ow">in</span> <span class="n">defines_list</span><span class="p">:</span>
                    <span class="n">process_file</span><span class="p">(</span>
                        <span class="n">full_path</span><span class="p">,</span>
                        <span class="n">cwd</span><span class="p">,</span>
                        <span class="n">defines</span><span class="p">,</span>
                        <span class="n">shader_pattern</span><span class="p">,</span>
                        <span class="n">hlsl_types</span><span class="p">,</span>
                        <span class="n">feature</span><span class="p">,</span>
                        <span class="n">short_path</span><span class="p">,</span>
                        <span class="n">result_map</span><span class="p">,</span>
                        <span class="n">compilation_units</span><span class="p">,</span>
                    <span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scan found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> buffers&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">compilation_units</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.buffer_scan.strip_array_notation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">strip_array_notation</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#hlslkit.buffer_scan.strip_array_notation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Remove any array notation from a field name, e.g., 'pad[3]' -&gt; 'pad'.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/buffer_scan.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">strip_array_notation</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove any array notation from a field name, e.g., &#39;pad[3]&#39; -&gt; &#39;pad&#39;.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[.*?\]$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_source: true
</p>


<div class="doc doc-object doc-module">



<a id="hlslkit.compile_shaders"></a>
    <div class="doc doc-contents first">

        <p>Compile HLSL shaders using fxc.exe and generate a warning/error report.</p>
<p>This script compiles HLSL shaders specified in a YAML configuration file using Microsoft's <code>fxc.exe</code> compiler.
It supports parallel compilation, system-adaptive job management, and detailed logging of warnings and errors.
The output includes compiled shader objects and a <code>new_issues.log</code> file summarizing new warnings and errors.</p>


<details class="example" open>
  <summary>Example</summary>
  <pre><code class="language-bash">python compile_shaders.py --config shader_defines.yaml --shader-dir src --output-dir build
</code></pre>
</details>

<details class="dependencies" open>
  <summary>Dependencies</summary>
  <ul>
<li><code>yaml</code>: For parsing configuration files.</li>
<li><code>tqdm</code>: For progress bars.</li>
<li><code>psutil</code> (optional): For system resource monitoring.</li>
<li><code>gooey</code> (optional): For GUI support.</li>
</ul>
</details>


  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="hlslkit.compile_shaders.ErrorHandler" class="doc doc-heading">
            <code>ErrorHandler</code>


<a href="#hlslkit.compile_shaders.ErrorHandler" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="hlslkit.compile_shaders.IssueHandler" href="#hlslkit.compile_shaders.IssueHandler">IssueHandler</a></code></p>


        <p>Handler for compilation errors.</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ErrorHandler</span><span class="p">(</span><span class="n">IssueHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler for compilation errors.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process an error line.&quot;&quot;&quot;</span>
        <span class="n">error_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ERROR_REGEX</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">error_match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">errors</span>

        <span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">error_msg</span> <span class="o">=</span> <span class="n">error_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_location</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;shader_type&quot;</span><span class="p">]}</span>

        <span class="n">error_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_issue_data</span><span class="p">(</span><span class="n">error_code</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_to_instances</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">],</span> <span class="n">location</span><span class="p">,</span> <span class="n">error_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
            <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="hlslkit.compile_shaders.ErrorHandler.process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.ErrorHandler.process" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Process an error line.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process an error line.&quot;&quot;&quot;</span>
    <span class="n">error_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ERROR_REGEX</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">error_match</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">errors</span>

    <span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">error_msg</span> <span class="o">=</span> <span class="n">error_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_location</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;shader_type&quot;</span><span class="p">]}</span>

    <span class="n">error_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_issue_data</span><span class="p">(</span><span class="n">error_code</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_to_instances</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">],</span> <span class="n">location</span><span class="p">,</span> <span class="n">error_data</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
        <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hlslkit.compile_shaders.IssueHandler" class="doc doc-heading">
            <code>IssueHandler</code>


<a href="#hlslkit.compile_shaders.IssueHandler" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Base class for handling compilation issues (warnings and errors).</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">IssueHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for handling compilation issues (warnings and errors).&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shader_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Store both original and lowercase versions for lookups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shader_key_lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shader_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shader_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="s2">&quot;entry_point&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">]}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line_info</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize file path and create location string.&quot;&quot;&quot;</span>
        <span class="n">norm_file_path</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">norm_file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_info</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_issue_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a standardized issue data structure.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">copy</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_to_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instances</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">issue_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an issue to the instances dictionary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instances</span><span class="p">[</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">i</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">issue_data</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">issue_data</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">[</span><span class="n">location</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">instances</span><span class="p">[</span><span class="n">location</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">issue_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="hlslkit.compile_shaders.IssueHandler.add_to_instances" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_to_instances</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">issue_data</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.IssueHandler.add_to_instances" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add an issue to the instances dictionary.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_to_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instances</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">issue_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an issue to the instances dictionary.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
        <span class="n">instances</span><span class="p">[</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
        <span class="n">i</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">issue_data</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">issue_data</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">[</span><span class="n">location</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">instances</span><span class="p">[</span><span class="n">location</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">issue_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.compile_shaders.IssueHandler.create_issue_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_issue_data</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.IssueHandler.create_issue_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a standardized issue data structure.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_issue_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a standardized issue data structure.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">copy</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="hlslkit.compile_shaders.IssueHandler.normalize_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_location</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.IssueHandler.normalize_location" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Normalize file path and create location string.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line_info</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize file path and create location string.&quot;&quot;&quot;</span>
    <span class="n">norm_file_path</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">norm_file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_info</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hlslkit.compile_shaders.WarningHandler" class="doc doc-heading">
            <code>WarningHandler</code>


<a href="#hlslkit.compile_shaders.WarningHandler" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="hlslkit.compile_shaders.IssueHandler" href="#hlslkit.compile_shaders.IssueHandler">IssueHandler</a></code></p>


        <p>Handler for compilation warnings.</p>

              <details class="quote">
                <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WarningHandler</span><span class="p">(</span><span class="n">IssueHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler for compilation warnings.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">baseline_warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">all_warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">new_warnings_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">suppressed_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">warning_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">WARNING_REGEX</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">warning_match</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">all_warnings</span><span class="p">,</span> <span class="n">new_warnings_dict</span><span class="p">,</span> <span class="n">suppressed_count</span>

        <span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">,</span> <span class="n">warning_code</span><span class="p">,</span> <span class="n">warning_msg</span> <span class="o">=</span> <span class="n">warning_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_location</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">)</span>
        <span class="n">warning_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">warning_code</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">warning_msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">warning_code</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">suppress_warnings</span><span class="p">:</span>
            <span class="n">suppressed_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Suppressed warning: </span><span class="si">{</span><span class="n">warning_code</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">all_warnings</span><span class="p">,</span> <span class="n">new_warnings_dict</span><span class="p">,</span> <span class="n">suppressed_count</span>

        <span class="c1"># Always use dict format for all_warnings</span>
        <span class="k">if</span> <span class="n">warning_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_warnings</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">warning_code</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">warning_msg</span><span class="p">,</span> <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">]:</span>
            <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
            <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">])</span>

        <span class="c1"># Check if this is a new warning</span>
        <span class="n">is_new_warning</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">warning_key</span> <span class="ow">in</span> <span class="n">baseline_warnings</span><span class="p">:</span>
            <span class="n">baseline_data</span> <span class="o">=</span> <span class="n">baseline_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">]</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="n">baseline_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instances&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">baseline_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">_loc</span><span class="p">,</span> <span class="n">_inst</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">_inst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="p">[])]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># legacy list format - count every occurrence</span>
                <span class="n">baseline_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
                <span class="c1"># Convert all_warnings to dict format if needed</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">warning_code</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">warning_msg</span><span class="p">,</span> <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">{}}</span>
                <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">loc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">]:</span>
                        <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">loc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[]}</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">loc</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
                        <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">loc</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">])</span>
            <span class="n">current_instances</span> <span class="o">=</span> <span class="n">all_warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span>
            <span class="n">current_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="mi">1</span>
                <span class="k">for</span> <span class="n">_loc</span><span class="p">,</span> <span class="n">_inst</span> <span class="ow">in</span> <span class="n">current_instances</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">_inst</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="p">)</span>
            <span class="n">is_new_warning</span> <span class="o">=</span> <span class="n">current_count</span> <span class="o">&gt;</span> <span class="n">baseline_count</span>

        <span class="k">if</span> <span class="n">is_new_warning</span><span class="p">:</span>
            <span class="n">warning_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_key</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">warning_code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">warning_msg</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">context_warning_key</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">warning_key</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;shader_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;entry_point&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">context_warning_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_warnings_dict</span><span class="p">:</span>
                <span class="n">new_warnings_dict</span><span class="p">[</span><span class="n">context_warning_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;warning_key&quot;</span><span class="p">:</span> <span class="n">warning_key</span><span class="p">,</span>
                    <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span>
                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">warning_code</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">warning_msg</span><span class="p">,</span>
                    <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="n">warning_str</span><span class="p">,</span>
                    <span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_warnings_dict</span><span class="p">[</span><span class="n">context_warning_key</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
                <span class="n">new_warnings_dict</span><span class="p">[</span><span class="n">context_warning_key</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_warnings_dict</span><span class="p">[</span><span class="n">context_warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">]:</span>
                <span class="n">new_warnings_dict</span><span class="p">[</span><span class="n">context_warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_warnings_dict</span><span class="p">[</span><span class="n">context_warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">new_warnings_dict</span><span class="p">[</span><span class="n">context_warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;entry_point&quot;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">all_warnings</span><span class="p">,</span> <span class="n">new_warnings_dict</span><span class="p">,</span> <span class="n">suppressed_count</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.adjust_target_jobs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">adjust_target_jobs</span><span class="p">(</span><span class="n">target_jobs</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">,</span> <span class="n">cpu_usages</span><span class="p">,</span> <span class="n">completed_tasks</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.adjust_target_jobs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Adjust the number of parallel jobs based on system resource usage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>target_jobs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current number of jobs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpu_count</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>physical_cores</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Physical CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>is_ci</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether running in a CI environment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpu_usages</code></td>
            <td>
                  <code><span title="collections.deque">deque</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Recent CPU usage measurements.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>completed_tasks</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of completed tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, str]: Adjusted number of jobs and reason.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">adjust_target_jobs</span><span class="p">(</span>
    <span class="n">target_jobs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">cpu_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">physical_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">is_ci</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">cpu_usages</span><span class="p">:</span> <span class="n">deque</span><span class="p">,</span>
    <span class="n">completed_tasks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust the number of parallel jobs based on system resource usage.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_jobs (int): Current number of jobs.</span>
<span class="sd">        cpu_count (int): Total CPU cores.</span>
<span class="sd">        physical_cores (int | None): Physical CPU cores.</span>
<span class="sd">        is_ci (bool): Whether running in a CI environment.</span>
<span class="sd">        cpu_usages (deque): Recent CPU usage measurements.</span>
<span class="sd">        completed_tasks (int): Number of completed tasks.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, str]: Adjusted number of jobs and reason.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">completed_tasks</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="n">max_jobs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">physical_cores</span> <span class="ow">or</span> <span class="mi">24</span><span class="p">,</span> <span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">physical_cores</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_jobs</span><span class="p">,</span> <span class="s2">&quot;initial max jobs for first 20 tasks&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cpu_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">mem_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">percent</span>
        <span class="n">cpu_usages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cpu_usage</span><span class="p">)</span>
        <span class="n">avg_cpu</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">cpu_usages</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpu_usages</span><span class="p">)</span> <span class="k">if</span> <span class="n">cpu_usages</span> <span class="k">else</span> <span class="n">cpu_usage</span>
        <span class="n">new_jobs</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">get_system_adaptive_jobs</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">,</span> <span class="n">avg_cpu</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">new_jobs</span> <span class="o">-</span> <span class="n">target_jobs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fxc_count</span> <span class="o">=</span> <span class="n">count_fxc_processes</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Adjusting active jobs to </span><span class="si">{</span><span class="n">new_jobs</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">, avg CPU </span><span class="si">{</span><span class="n">avg_cpu</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, memory </span><span class="si">{</span><span class="n">mem_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, fxc_processes=</span><span class="si">{</span><span class="n">fxc_count</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">new_jobs</span><span class="p">,</span> <span class="n">reason</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check system usage: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="s2">&quot;no adjustment&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.analyze_and_report_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyze_and_report_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">config_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">,</span> <span class="n">max_warnings</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.analyze_and_report_results" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Analyze compilation results and report warnings and errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>results</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compilation results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>config_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the YAML configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_dir</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output directory for logs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>suppress_warnings</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Warning codes to suppress.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_warnings</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowed new warnings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, int, int]: Exit code, total new warnings, and error count.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_and_report_results</span><span class="p">(</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">max_warnings</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze compilation results and report warnings and errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (list[dict]): Compilation results.</span>
<span class="sd">        config_file (str): Path to the YAML configuration file.</span>
<span class="sd">        output_dir (str): Output directory for logs.</span>
<span class="sd">        suppress_warnings (list[str]): Warning codes to suppress.</span>
<span class="sd">        max_warnings (int): Maximum allowed new warnings.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, int, int]: Exit code, total new warnings, and error count.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">baseline_warnings</span> <span class="o">=</span> <span class="n">load_baseline_warnings</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="n">defines_lookup</span> <span class="o">=</span> <span class="n">build_defines_lookup</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="n">new_warnings</span><span class="p">,</span> <span class="n">all_warnings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">suppressed_warnings_count</span> <span class="o">=</span> <span class="n">process_warnings_and_errors</span><span class="p">(</span>
        <span class="n">results</span><span class="p">,</span> <span class="n">baseline_warnings</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">,</span> <span class="n">defines_lookup</span>
    <span class="p">)</span>
    <span class="n">log_new_issues</span><span class="p">(</span><span class="n">new_warnings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">defines_lookup</span><span class="p">)</span>

    <span class="n">total_new_warnings</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">get_instance_count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">new_warnings</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Compilation complete: </span><span class="si">{</span><span class="n">total_new_warnings</span><span class="si">}</span><span class="s2"> new warnings, </span><span class="si">{</span><span class="n">suppressed_warnings_count</span><span class="si">}</span><span class="s2"> suppressed warnings, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> errors&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Generate and log file-level summary</span>
    <span class="n">file_summary</span> <span class="o">=</span> <span class="n">get_file_issue_summary</span><span class="p">(</span><span class="n">baseline_warnings</span><span class="p">,</span> <span class="n">new_warnings</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_summary</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** FILE-LEVEL ISSUE SUMMARY:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_summary</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;new&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> new issues &quot;</span> <span class="sa">f</span><span class="s2">&quot;(baseline: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, total: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">new_warnings</span><span class="p">:</span>
        <span class="n">unique_warnings</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new_warnings</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_instance_count</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">max_to_show</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_warnings</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*** NEW WARNINGS DETECTED (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_warnings</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique, </span><span class="si">{</span><span class="n">total_new_warnings</span><span class="si">}</span><span class="s2"> total):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">warning</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_warnings</span><span class="p">[:</span><span class="n">max_to_show</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">get_instance_count</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>
            <span class="n">affected_variants</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">total_new_warnings</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_new_warnings</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;   Impact: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> occurrences across </span><span class="si">{</span><span class="n">affected_variants</span><span class="si">}</span><span class="s2"> shader variants (</span><span class="si">{</span><span class="n">percentage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span>
            <span class="p">)</span>
            <span class="n">locations_shown</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">max_locations</span> <span class="o">=</span> <span class="mi">3</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">location_data</span> <span class="ow">in</span> <span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">locations_shown</span> <span class="o">&gt;=</span> <span class="n">max_locations</span><span class="p">:</span>
                        <span class="n">remaining_locations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">locations_shown</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;   Location: ...and </span><span class="si">{</span><span class="n">remaining_locations</span><span class="si">}</span><span class="s2"> more locations (see new_issues.log)&quot;</span>
                        <span class="p">)</span>
                        <span class="k">break</span>

                    <span class="n">file_part</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">location</span> <span class="k">else</span> <span class="n">location</span>
                    <span class="n">line_part</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">location</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>

                    <span class="n">entries_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">location_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">entries_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entries_list</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">location_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">entries_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (+</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">location_data</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2"> more)&quot;</span>

                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Location: </span><span class="si">{</span><span class="n">file_part</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_part</span><span class="si">}</span><span class="s2"> (entries: </span><span class="si">{</span><span class="n">entries_str</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="n">locations_shown</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">][:</span><span class="n">max_locations</span><span class="p">]:</span>
                    <span class="n">file_part</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">location</span> <span class="k">else</span> <span class="n">location</span>
                    <span class="n">line_part</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">location</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Location: </span><span class="si">{</span><span class="n">file_part</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_part</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">locations_shown</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">max_locations</span><span class="p">:</span>
                    <span class="n">remaining_locations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">max_locations</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Location: ...and </span><span class="si">{</span><span class="n">remaining_locations</span><span class="si">}</span><span class="s2"> more locations (see new_issues.log)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_to_show</span><span class="p">:</span>
            <span class="n">remaining_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">get_instance_count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">unique_warnings</span><span class="p">[</span><span class="n">max_to_show</span><span class="p">:])</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_warnings</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">max_to_show</span><span class="si">}</span><span class="s2"> more unique warnings (</span><span class="si">{</span><span class="n">remaining_count</span><span class="si">}</span><span class="s2"> occurrences)&quot;</span>
            <span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;See &#39;new_issues.log&#39; for complete details and compilation context&quot;</span><span class="p">)</span>

    <span class="n">error_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*** COMPILATION ERRORS DETECTED (</span><span class="si">{</span><span class="n">error_count</span><span class="si">}</span><span class="s2"> total errors):&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">shader_key</span><span class="p">,</span> <span class="n">error_data</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">shader_file</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">shader_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">entry_point</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shader_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">shader_key</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>
            <span class="n">shader_type</span> <span class="o">=</span> <span class="n">error_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File: </span><span class="si">{</span><span class="n">shader_file</span><span class="si">}</span><span class="s2"> (entry: </span><span class="si">{</span><span class="n">entry_point</span><span class="si">}</span><span class="s2">, type: </span><span class="si">{</span><span class="n">shader_type</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">error_list</span> <span class="ow">in</span> <span class="n">error_data</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_list</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ERROR </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">):</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      Location: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;context&quot;</span><span class="p">):</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;      Context: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;shader_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;entry_point&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ACTION REQUIRED: Fix all compilation errors above before proceeding.&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Check the full compilation log for additional context and details.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_new_warnings</span><span class="p">,</span> <span class="n">error_count</span>  <span class="c1"># Enhanced warning threshold logic to support negative values</span>
    <span class="k">if</span> <span class="n">max_warnings</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Negative max_warnings means user must eliminate existing warnings</span>
        <span class="n">baseline_warning_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">warning_data</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">warning_data</span> <span class="ow">in</span> <span class="n">baseline_warnings</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">current_total_warnings</span> <span class="o">=</span> <span class="n">baseline_warning_count</span> <span class="o">+</span> <span class="n">total_new_warnings</span>
        <span class="n">required_reduction</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_warnings</span><span class="p">)</span>
        <span class="c1"># If required reduction exceeds baseline, target is 0 warnings (eliminate all)</span>
        <span class="n">target_warning_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">baseline_warning_count</span> <span class="o">-</span> <span class="n">required_reduction</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_total_warnings</span> <span class="o">&gt;</span> <span class="n">target_warning_count</span><span class="p">:</span>
            <span class="n">eliminated_warnings</span> <span class="o">=</span> <span class="n">baseline_warning_count</span> <span class="o">-</span> <span class="p">(</span><span class="n">current_total_warnings</span> <span class="o">-</span> <span class="n">total_new_warnings</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_warning_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;*** MUST ELIMINATE ALL WARNINGS: Required reduction </span><span class="si">{</span><span class="n">required_reduction</span><span class="si">}</span><span class="s2"> exceeds &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;baseline count </span><span class="si">{</span><span class="n">baseline_warning_count</span><span class="si">}</span><span class="s2">. Current total: </span><span class="si">{</span><span class="n">current_total_warnings</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;target: </span><span class="si">{</span><span class="n">target_warning_count</span><span class="si">}</span><span class="s2"> warnings.&quot;</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ACTION REQUIRED: Eliminate ALL remaining warnings to pass this check.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">needed_elimination</span> <span class="o">=</span> <span class="n">required_reduction</span> <span class="o">-</span> <span class="n">eliminated_warnings</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;*** INSUFFICIENT WARNING REDUCTION: Need to eliminate </span><span class="si">{</span><span class="n">required_reduction</span><span class="si">}</span><span class="s2"> warnings, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but only eliminated </span><span class="si">{</span><span class="n">eliminated_warnings</span><span class="si">}</span><span class="s2">. Need </span><span class="si">{</span><span class="n">needed_elimination</span><span class="si">}</span><span class="s2"> more eliminations.&quot;</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ACTION REQUIRED: Eliminate </span><span class="si">{</span><span class="n">needed_elimination</span><span class="si">}</span><span class="s2"> more warnings to pass this check.&quot;</span><span class="p">)</span>

            <span class="c1"># Provide actionable guidance</span>
            <span class="k">if</span> <span class="n">new_warnings</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;TIP: Focus on eliminating existing warnings rather than adding </span><span class="si">{</span><span class="n">total_new_warnings</span><span class="si">}</span><span class="s2"> new ones.&quot;</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Check &#39;new_issues.log&#39; for detailed locations and suggested fixes.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;TIP: Eliminate more existing baseline warnings to meet the reduction requirement.&quot;</span><span class="p">)</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SUMMARY: Baseline: </span><span class="si">{</span><span class="n">baseline_warning_count</span><span class="si">}</span><span class="s2"> | New: </span><span class="si">{</span><span class="n">total_new_warnings</span><span class="si">}</span><span class="s2"> | &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Target: </span><span class="si">{</span><span class="n">target_warning_count</span><span class="si">}</span><span class="s2"> | Current: </span><span class="si">{</span><span class="n">current_total_warnings</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Show top existing warnings to help user prioritize elimination efforts</span>
            <span class="k">if</span> <span class="n">baseline_warnings</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** TOP EXISTING WARNINGS TO ELIMINATE (by impact):&quot;</span><span class="p">)</span>

                <span class="c1"># Calculate entry counts for baseline warnings and sort by impact</span>
                <span class="n">baseline_with_counts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_warning_key</span><span class="p">,</span> <span class="n">warning_data</span> <span class="ow">in</span> <span class="n">baseline_warnings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">total_entries</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">location_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="p">[]))</span> <span class="k">for</span> <span class="n">location_data</span> <span class="ow">in</span> <span class="n">warning_data</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">baseline_with_counts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">warning_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">warning_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown message&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;total_entries&quot;</span><span class="p">:</span> <span class="n">total_entries</span><span class="p">,</span>
                        <span class="s2">&quot;instance_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">warning_data</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;locations&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">warning_data</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">3</span><span class="p">],</span>  <span class="c1"># Show first 3 locations</span>
                    <span class="p">})</span>

                <span class="c1"># Sort by total entries (impact) descending</span>
                <span class="n">top_existing</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">baseline_with_counts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;total_entries&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>

                <span class="c1"># Calculate total entries across all baseline warnings for percentage calculation</span>
                <span class="n">total_baseline_entries</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s2">&quot;total_entries&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">baseline_with_counts</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">warning</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_existing</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">impact_percentage</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s2">&quot;total_entries&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_baseline_entries</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_baseline_entries</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;   Impact: </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;total_entries&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> shader combinations across </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;instance_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> locations (</span><span class="si">{</span><span class="n">impact_percentage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of baseline)&quot;</span>
                    <span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sample locations: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;locations&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Eliminating these top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">top_existing</span><span class="p">)</span><span class="si">}</span><span class="s2"> warning types would reduce </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="s1">&#39;total_entries&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">top_existing</span><span class="p">)</span><span class="si">}</span><span class="s2"> shader combinations.&quot;</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Focus on the highest impact warnings first for maximum progress toward the target.&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_new_warnings</span><span class="p">,</span> <span class="n">error_count</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">eliminated_warnings</span> <span class="o">=</span> <span class="n">baseline_warning_count</span> <span class="o">-</span> <span class="p">(</span><span class="n">current_total_warnings</span> <span class="o">-</span> <span class="n">total_new_warnings</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_warning_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;All warnings eliminated: required reduction </span><span class="si">{</span><span class="n">required_reduction</span><span class="si">}</span><span class="s2"> exceeded &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;baseline count </span><span class="si">{</span><span class="n">baseline_warning_count</span><span class="si">}</span><span class="s2">. Achieved zero warnings goal.&quot;</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning reduction goal met: eliminated </span><span class="si">{</span><span class="n">eliminated_warnings</span><span class="si">}</span><span class="s2"> warnings &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(required: </span><span class="si">{</span><span class="n">required_reduction</span><span class="si">}</span><span class="s2">), </span><span class="si">{</span><span class="n">total_new_warnings</span><span class="si">}</span><span class="s2"> new warnings&quot;</span>
                <span class="p">)</span>
    <span class="k">elif</span> <span class="n">total_new_warnings</span> <span class="o">&gt;</span> <span class="n">max_warnings</span><span class="p">:</span>
        <span class="c1"># Positive max_warnings means limit on new warnings (original behavior)</span>
        <span class="n">excess_warnings</span> <span class="o">=</span> <span class="n">total_new_warnings</span> <span class="o">-</span> <span class="n">max_warnings</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*** TOO MANY NEW WARNINGS: </span><span class="si">{</span><span class="n">total_new_warnings</span><span class="si">}</span><span class="s2"> new warnings exceed limit of </span><span class="si">{</span><span class="n">max_warnings</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ACTION REQUIRED: Eliminate </span><span class="si">{</span><span class="n">excess_warnings</span><span class="si">}</span><span class="s2"> new warnings to pass this check.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_warnings</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Check &#39;new_issues.log&#39; for detailed locations and suggested fixes.&quot;</span><span class="p">)</span>
            <span class="c1"># Show the most common warnings first for prioritization</span>
            <span class="n">unique_warnings</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new_warnings</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TIP: Focus on the top </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">unique_warnings</span><span class="p">))</span><span class="si">}</span><span class="s2"> most frequent warning types:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">warning</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_warnings</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">])</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> occurrences)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_new_warnings</span><span class="p">,</span> <span class="n">error_count</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">total_new_warnings</span><span class="p">,</span> <span class="n">error_count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.build_defines_lookup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_defines_lookup</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.build_defines_lookup" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Build a lookup table for shader defines from a YAML configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>config_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the YAML configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lookup table mapping shader keys to (shader_type, defines).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>build_defines_lookup("shader_defines.yaml")
{'test.hlsl:main:1234': ('PSHADER', ['A=1'])}</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_defines_lookup</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a lookup table for shader defines from a YAML configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file (str): Path to the YAML configuration file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Lookup table mapping shader keys to (shader_type, defines).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; build_defines_lookup(&quot;shader_defines.yaml&quot;)</span>
<span class="sd">        {&#39;test.hlsl:main:1234&#39;: (&#39;PSHADER&#39;, [&#39;A=1&#39;])}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">defines_lookup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">config_file</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">config_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">config_data</span> <span class="ow">and</span> <span class="s2">&quot;shaders&quot;</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">shader</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">[</span><span class="s2">&quot;shaders&quot;</span><span class="p">]:</span>
                        <span class="n">file_name</span> <span class="o">=</span> <span class="n">shader</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">shader</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configs&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                                <span class="n">entry_name</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">]</span>
                                <span class="n">defines</span> <span class="o">=</span> <span class="n">flatten_defines</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;common_defines&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defines&quot;</span><span class="p">,</span> <span class="p">[]))</span>
                                <span class="n">defines_lookup</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entry_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">shader_type</span><span class="p">,</span>
                                    <span class="n">defines</span><span class="p">,</span>
                                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load shader configs from </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">defines_lookup</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.compile_shader" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compile_shader</span><span class="p">(</span><span class="n">fxc_path</span><span class="p">,</span> <span class="n">shader_file</span><span class="p">,</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">shader_dir</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strip_debug_defines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">force_partial_precision</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug_defines</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_includes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.compile_shader" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compile a shader using fxc.exe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fxc_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to fxc.exe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the shader file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of shader (VSHADER, PSHADER, CSHADER).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>entry</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entry point for the shader.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>defines</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessor defines.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_dir</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output directory for compiled shaders.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_dir</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing shader files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>debug</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enable debug logging.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>strip_debug_defines</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strip debug-related defines.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>optimization_level</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimization level (0-3).</p>
              </div>
            </td>
            <td>
                  <code>&#39;1&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>force_partial_precision</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Force 16-bit precision.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>debug_defines</code></td>
            <td>
                  <code>set[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of debug defines to strip.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extra_includes</code></td>
            <td>
                  <code>list[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of additional include directories.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, object]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, any]: Compilation result with file, entry, type, log, success, and command.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>compile_shader("fxc.exe", "test.hlsl", "PSHADER", "main:1234", [], "build", "src")
{'file': 'test.hlsl', 'entry': 'main:1234', 'type': 'PSHADER', 'log': '...', 'success': True, 'cmd': [...]}</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compile_shader</span><span class="p">(</span>
    <span class="n">fxc_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">shader_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">shader_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">entry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">defines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">shader_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">strip_debug_defines</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">optimization_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="n">force_partial_precision</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug_defines</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">extra_includes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compile a shader using fxc.exe.</span>

<span class="sd">    Args:</span>
<span class="sd">        fxc_path (str): Path to fxc.exe.</span>
<span class="sd">        shader_file (str): Path to the shader file.</span>
<span class="sd">        shader_type (str): Type of shader (VSHADER, PSHADER, CSHADER).</span>
<span class="sd">        entry (str): Entry point for the shader.</span>
<span class="sd">        defines (list[str]): Preprocessor defines.</span>
<span class="sd">        output_dir (str): Output directory for compiled shaders.</span>
<span class="sd">        shader_dir (str): Directory containing shader files.</span>
<span class="sd">        debug (bool): Enable debug logging.</span>
<span class="sd">        strip_debug_defines (bool): Strip debug-related defines.</span>
<span class="sd">        optimization_level (str): Optimization level (0-3).</span>
<span class="sd">        force_partial_precision (bool): Force 16-bit precision.</span>
<span class="sd">        debug_defines (set[str] | None): Set of debug defines to strip.</span>
<span class="sd">        extra_includes (list[str] | None): List of additional include directories.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, any]: Compilation result with file, entry, type, log, success, and command.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; compile_shader(&quot;fxc.exe&quot;, &quot;test.hlsl&quot;, &quot;PSHADER&quot;, &quot;main:1234&quot;, [], &quot;build&quot;, &quot;src&quot;)</span>
<span class="sd">        {&#39;file&#39;: &#39;test.hlsl&#39;, &#39;entry&#39;: &#39;main:1234&#39;, &#39;type&#39;: &#39;PSHADER&#39;, &#39;log&#39;: &#39;...&#39;, &#39;success&#39;: True, &#39;cmd&#39;: [...]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">shader_file</span><span class="p">,</span>
            <span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">shader_type</span><span class="p">,</span>
            <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="s2">&quot;Compilation aborted.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

    <span class="n">validation_error</span> <span class="o">=</span> <span class="n">validate_shader_inputs</span><span class="p">(</span><span class="n">fxc_path</span><span class="p">,</span> <span class="n">shader_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">shader_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">validation_error</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">validation_error</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">shader_file</span><span class="p">,</span>
            <span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">shader_type</span><span class="p">,</span>
            <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">validation_error</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

    <span class="n">entry_name</span> <span class="o">=</span> <span class="s2">&quot;main&quot;</span>
    <span class="n">shader_id</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">shader_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">shader_file</span><span class="p">)</span>
    <span class="n">shader_name_no_ext</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">shader_basename</span><span class="p">)</span>
    <span class="n">output_subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">shader_name_no_ext</span><span class="p">)</span>

    <span class="n">ext_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;.vso&quot;</span><span class="p">,</span> <span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;.pso&quot;</span><span class="p">,</span> <span class="s2">&quot;CSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;.cso&quot;</span><span class="p">}</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">ext_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shader_type</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">shader_file</span><span class="p">,</span>
            <span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">shader_type</span><span class="p">,</span>
            <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unsupported shader type: </span><span class="si">{</span><span class="n">shader_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_subdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_subdir</span><span class="p">,</span> <span class="n">shader_id</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>

    <span class="n">shader_model_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;vs_5_0&quot;</span><span class="p">,</span> <span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;ps_5_0&quot;</span><span class="p">,</span> <span class="s2">&quot;CSHADER&quot;</span><span class="p">:</span> <span class="s2">&quot;cs_5_0&quot;</span><span class="p">}</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">shader_model_map</span><span class="p">[</span><span class="n">shader_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

    <span class="c1"># Determine if shader_dir is a file or directory</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">shader_dir</span><span class="p">):</span>
        <span class="n">shader_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">shader_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shader_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shader_dir</span><span class="p">,</span> <span class="n">shader_basename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">shader_file_path</span><span class="p">):</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Shader file not found in </span><span class="si">{</span><span class="n">shader_dir</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">shader_basename</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">shader_file</span><span class="p">,</span>
            <span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">shader_type</span><span class="p">,</span>
            <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">debug_defines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">debug_defines</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;_DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;D3D_DEBUG_INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;D3DCOMPILE_DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;D3DCOMPILE_SKIP_OPTIMIZATION&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">strip_debug_defines</span><span class="p">:</span>
        <span class="c1"># Work on a copy to avoid mutating the shared task definition</span>
        <span class="n">filtered_defines</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defines</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">debug_defines</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;D3DCOMPILE_AVOID_FLOW_CONTROL&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filtered_defines</span><span class="p">:</span>
            <span class="n">filtered_defines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;D3DCOMPILE_AVOID_FLOW_CONTROL&quot;</span><span class="p">)</span>
        <span class="n">defines</span> <span class="o">=</span> <span class="n">filtered_defines</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Stripped debug defines and added D3DCOMPILE_AVOID_FLOW_CONTROL for </span><span class="si">{</span><span class="n">shader_file</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s2">. Defines: </span><span class="si">{</span><span class="n">defines</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">fxc_path</span><span class="p">,</span>
        <span class="s2">&quot;/T&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="s2">&quot;/E&quot;</span><span class="p">,</span>
        <span class="n">entry_name</span><span class="p">,</span>
        <span class="s2">&quot;/Fo&quot;</span><span class="p">,</span>
        <span class="n">output_path</span><span class="p">,</span>
        <span class="s2">&quot;/O&quot;</span> <span class="o">+</span> <span class="n">optimization_level</span><span class="p">,</span>
        <span class="n">shader_basename</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">force_partial_precision</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/Gfp&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;/D&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>
    <span class="c1"># Always include shader_dir (if directory), or the file&#39;s parent (if file)</span>
    <span class="n">include_dirs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">shader_dir</span><span class="p">):</span>
        <span class="n">include_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">shader_dir</span><span class="p">))</span>
    <span class="c1"># Always include the parent directory of the shader file</span>
    <span class="n">shader_parent</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">shader_file</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">shader_parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_dirs</span><span class="p">:</span>
        <span class="n">include_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shader_parent</span><span class="p">)</span>
    <span class="c1"># Add extra includes if provided</span>
    <span class="k">if</span> <span class="n">extra_includes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">inc</span> <span class="ow">in</span> <span class="n">extra_includes</span><span class="p">:</span>
            <span class="n">inc_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inc_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_dirs</span><span class="p">:</span>
                <span class="n">include_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inc_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">inc</span> <span class="ow">in</span> <span class="n">include_dirs</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;/I&quot;</span><span class="p">,</span> <span class="n">inc</span><span class="p">])</span>

    <span class="n">log</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">process</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing command: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Defines are sanitized in validate_shader_inputs to prevent injection</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>  <span class="c1"># noqa: S603</span>
            <span class="n">cmd</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">shader_dir</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">running_processes_lock</span><span class="p">:</span>
            <span class="n">running_processes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
        <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">stdout</span> <span class="o">+</span> <span class="n">stderr</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">running_processes_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">running_processes</span><span class="p">:</span>
                <span class="n">running_processes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command </span><span class="si">{</span><span class="s1">&#39;failed&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;succeeded&#39;</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output:</span><span class="se">\n</span><span class="si">{</span><span class="n">log</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">shader_file</span><span class="p">,</span>
        <span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">shader_type</span><span class="p">,</span>
        <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">log</span><span class="p">,</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
        <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="n">cmd</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.count_fxc_processes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_fxc_processes</span><span class="p">()</span></code>

<a href="#hlslkit.compile_shaders.count_fxc_processes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Count the number of running fxc.exe processes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of fxc.exe processes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_fxc_processes</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the number of running fxc.exe processes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Number of fxc.exe processes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">HAS_PSUTIL</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">psutil</span><span class="o">.</span><span class="n">process_iter</span><span class="p">([</span><span class="s2">&quot;name&quot;</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;fxc.exe&quot;</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">NoSuchProcess</span><span class="p">,</span> <span class="n">psutil</span><span class="o">.</span><span class="n">AccessDenied</span><span class="p">):</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.flatten_defines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flatten_defines</span><span class="p">(</span><span class="n">defines</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.flatten_defines" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Flatten a list of defines, removing duplicates while preserving order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>defines</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of defines, possibly nested.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[str]: Flattened list of unique defines, sorted for deterministic output.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>flatten_defines([["A=1", "B"], "C"])
['A=1', 'B', 'C']</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flatten_defines</span><span class="p">(</span><span class="n">defines</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flatten a list of defines, removing duplicates while preserving order.</span>

<span class="sd">    Args:</span>
<span class="sd">        defines (list): List of defines, possibly nested.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: Flattened list of unique defines, sorted for deterministic output.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; flatten_defines([[&quot;A=1&quot;, &quot;B&quot;], &quot;C&quot;])</span>
<span class="sd">        [&#39;A=1&#39;, &#39;B&#39;, &#39;C&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defines</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">flat</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flatten_defines</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">flat</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">d</span> <span class="ow">in</span> <span class="n">seen</span> <span class="ow">or</span> <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">d</span><span class="p">))]</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.get_file_issue_summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_issue_summary</span><span class="p">(</span><span class="n">baseline_warnings</span><span class="p">,</span> <span class="n">new_warnings</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.get_file_issue_summary" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate a summary of issue changes per file, only counting truly new issues. Handles both dict and list formats for 'instances'.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_file_issue_summary</span><span class="p">(</span><span class="n">baseline_warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">new_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a summary of issue changes per file, only counting truly new issues. Handles both dict and list formats for &#39;instances&#39;.&quot;&quot;&quot;</span>
    <span class="n">file_summary</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Build a set of (file_path, location, entry) for baseline</span>
    <span class="n">baseline_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">warning_data</span> <span class="ow">in</span> <span class="n">baseline_warnings</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="n">warning_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instances&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_location</span><span class="p">,</span> <span class="n">loc_data</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">_entry</span> <span class="ow">in</span> <span class="n">loc_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">baseline_set</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">_location</span><span class="p">,</span> <span class="n">_entry</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_location</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">baseline_set</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">_location</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="c1"># Build a set of (file_path, location, entry) for new_warnings</span>
    <span class="n">new_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">new_warnings</span><span class="p">:</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="n">warning</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instances&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_location</span><span class="p">,</span> <span class="n">loc_data</span> <span class="ow">in</span> <span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">_entry</span> <span class="ow">in</span> <span class="n">loc_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">new_set</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">_location</span><span class="p">,</span> <span class="n">_entry</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_location</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">_location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Use entries from warning[&#39;entries&#39;] if available, else None</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="n">warning</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entries&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">_entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                    <span class="n">new_set</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">file_path</span><span class="p">,</span> <span class="n">_location</span><span class="p">,</span> <span class="n">_entry</span><span class="p">))</span>

    <span class="c1"># Only count as new if not in baseline</span>
    <span class="n">truly_new</span> <span class="o">=</span> <span class="n">new_set</span> <span class="o">-</span> <span class="n">baseline_set</span>

    <span class="c1"># Count baseline and new per file</span>
    <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">_location</span><span class="p">,</span> <span class="n">_entry</span> <span class="ow">in</span> <span class="n">baseline_set</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_summary</span><span class="p">:</span>
            <span class="n">file_summary</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;baseline&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">file_summary</span><span class="p">[</span><span class="n">file_path</span><span class="p">][</span><span class="s2">&quot;baseline&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">file_summary</span><span class="p">[</span><span class="n">file_path</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">_location</span><span class="p">,</span> <span class="n">_entry</span> <span class="ow">in</span> <span class="n">new_set</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_summary</span><span class="p">:</span>
            <span class="n">file_summary</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;baseline&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">file_summary</span><span class="p">[</span><span class="n">file_path</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">_location</span><span class="p">,</span> <span class="n">_entry</span> <span class="ow">in</span> <span class="n">truly_new</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_summary</span><span class="p">:</span>
            <span class="n">file_summary</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;baseline&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">file_summary</span><span class="p">[</span><span class="n">file_path</span><span class="p">][</span><span class="s2">&quot;new&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Only report files with truly new issues</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">file_summary</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.get_instance_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_instance_count</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.get_instance_count" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get the count of instances, handling both list and dict formats.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_instance_count</span><span class="p">(</span><span class="n">warning</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the count of instances, handling both list and dict formats.&quot;&quot;&quot;</span>
    <span class="n">instances</span> <span class="o">=</span> <span class="n">warning</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instances&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.get_system_adaptive_jobs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_system_adaptive_jobs</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">,</span> <span class="n">avg_cpu</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.get_system_adaptive_jobs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Determine the optimal number of parallel jobs based on system resources.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cpu_count</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>physical_cores</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Physical CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>is_ci</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether running in a CI environment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>avg_cpu</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average CPU usage.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, str]: Number of jobs and reason for selection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_system_adaptive_jobs</span><span class="p">(</span>
    <span class="n">cpu_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">avg_cpu</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the optimal number of parallel jobs based on system resources.</span>

<span class="sd">    Args:</span>
<span class="sd">        cpu_count (int): Total CPU cores.</span>
<span class="sd">        physical_cores (int | None): Physical CPU cores.</span>
<span class="sd">        is_ci (bool): Whether running in a CI environment.</span>
<span class="sd">        avg_cpu (float): Average CPU usage.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, str]: Number of jobs and reason for selection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_ci</span><span class="p">:</span>
        <span class="c1"># In CI environments, be more aggressive with job allocation since runners are dedicated</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;auto-detected for CI environment (aggressive)&quot;</span>
        <span class="k">if</span> <span class="n">HAS_PSUTIL</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cpu_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">mem_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">percent</span>
                <span class="k">if</span> <span class="n">cpu_usage</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">mem_usage</span> <span class="o">&gt;</span> <span class="mi">95</span><span class="p">:</span>
                    <span class="n">jobs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">cpu_count</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;auto-detected for CI, high CPU (</span><span class="si">{</span><span class="n">cpu_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%) or memory (</span><span class="si">{</span><span class="n">mem_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%) - conservative&quot;</span>
                    <span class="p">)</span>
                <span class="c1"># For low load, keep the aggressive setting</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check system usage in CI: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jobs</span><span class="p">,</span> <span class="n">reason</span>

    <span class="n">max_jobs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">physical_cores</span> <span class="ow">or</span> <span class="mi">24</span><span class="p">,</span> <span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">physical_cores</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">HAS_PSUTIL</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cpu_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">mem_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">percent</span>
            <span class="k">if</span> <span class="n">cpu_usage</span> <span class="o">&lt;</span> <span class="mi">70</span> <span class="ow">and</span> <span class="n">mem_usage</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="n">max_jobs</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;auto-detected, low CPU (</span><span class="si">{</span><span class="n">cpu_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%), low memory (</span><span class="si">{</span><span class="n">mem_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span>
            <span class="k">elif</span> <span class="n">cpu_usage</span> <span class="o">&lt;</span> <span class="mi">90</span> <span class="ow">and</span> <span class="n">mem_usage</span> <span class="o">&lt;</span> <span class="mi">95</span><span class="p">:</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">max_jobs</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;auto-detected, moderate CPU (</span><span class="si">{</span><span class="n">cpu_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%), moderate memory (</span><span class="si">{</span><span class="n">mem_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">max_jobs</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;auto-detected, high CPU (</span><span class="si">{</span><span class="n">cpu_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%) or memory (</span><span class="si">{</span><span class="n">mem_usage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span>
            <span class="n">job_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">job_levels</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">jobs</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to check system usage: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="n">max_jobs</span>
            <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;auto-detected, system usage check failed&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="n">max_jobs</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;auto-detected, no psutil available&quot;</span>

    <span class="k">return</span> <span class="n">jobs</span><span class="p">,</span> <span class="n">reason</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.handle_termination" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">handle_termination</span><span class="p">(</span><span class="n">signum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.handle_termination" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Handle termination signals by gracefully shutting down subprocesses.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>signum</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Signal number (e.g., SIGINT).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>frame</code></td>
            <td>
                  <code><span title="types.FrameType">FrameType</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current stack frame.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_termination</span><span class="p">(</span><span class="n">signum</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">FrameType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle termination signals by gracefully shutting down subprocesses.</span>

<span class="sd">    Args:</span>
<span class="sd">        signum (int | None): Signal number (e.g., SIGINT).</span>
<span class="sd">        frame (FrameType | None): Current stack frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Termination signal received. Shutting down gracefully...&quot;</span><span class="p">)</span>
    <span class="n">stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">running_processes_lock</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">running_processes</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Terminating subprocess: </span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to terminate process </span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Exiting...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.initialize_compilation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_compilation</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.initialize_compilation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Initialize compilation settings and tasks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>args</code></td>
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Command-line arguments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpu_count</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>physical_cores</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Physical CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>is_ci</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether running in a CI environment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, int, str, list[tuple]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, int, str, list[tuple]]: Max workers, target jobs, jobs reason, and tasks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_compilation</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize compilation settings and tasks.</span>

<span class="sd">    Args:</span>
<span class="sd">        args (argparse.Namespace): Command-line arguments.</span>
<span class="sd">        cpu_count (int): Total CPU cores.</span>
<span class="sd">        physical_cores (int | None): Physical CPU cores.</span>
<span class="sd">        is_ci (bool): Whether running in a CI environment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, int, str, list[tuple]]: Max workers, target jobs, jobs reason, and tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_workers</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">physical_cores</span> <span class="ow">or</span> <span class="mi">24</span><span class="p">,</span> <span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">physical_cores</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">cpu_count</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">default_jobs</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">jobs</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">jobs</span> <span class="o">!=</span> <span class="n">default_jobs</span><span class="p">:</span>
        <span class="n">target_jobs</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">jobs</span>
        <span class="n">jobs_reason</span> <span class="o">=</span> <span class="s2">&quot;user-specified&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span> <span class="o">=</span> <span class="n">get_system_adaptive_jobs</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">,</span> <span class="n">avg_cpu</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">fxc</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">fxc</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;fxc.exe&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">fxc</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;fxc.exe not found in PATH. Please specify with --fxc.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">max_workers</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">shader_dir</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shader directory or file not found: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">shader_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_workers</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration file not found: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_workers</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="p">[]</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">config_tasks</span> <span class="o">=</span> <span class="n">parse_shader_configs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
    <span class="c1"># If shader_dir is a file, only compile that file (with all its variants from config)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">shader_dir</span><span class="p">):</span>
        <span class="n">shader_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">shader_dir</span><span class="p">)</span>
        <span class="n">shader_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">shader_file_path</span><span class="p">)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span> <span class="n">defines</span> <span class="ow">in</span> <span class="n">config_tasks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="o">==</span> <span class="n">shader_file_name</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">shader_file_path</span><span class="p">,</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span> <span class="n">defines</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shader file </span><span class="si">{</span><span class="n">shader_file_name</span><span class="si">}</span><span class="s2"> not found in config </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">max_workers</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Directory mode (existing logic)</span>
        <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span> <span class="n">defines</span> <span class="ow">in</span> <span class="n">config_tasks</span><span class="p">:</span>
            <span class="n">shader_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">shader_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">shader_file</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shader file not found: </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">shader_file</span><span class="p">,</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span> <span class="n">defines</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No valid shader compilation tasks found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_workers</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="p">[]</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">max_workers</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="n">tasks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.load_baseline_warnings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_baseline_warnings</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.load_baseline_warnings" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Load baseline warnings from a YAML configuration file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>config_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the YAML configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of baseline warnings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>load_baseline_warnings("shader_defines.yaml")
{'x3206:implicit truncation': {'code': 'X3206', 'message': 'implicit truncation', 'instances': {...}}}</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_baseline_warnings</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load baseline warnings from a YAML configuration file.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file (str): Path to the YAML configuration file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of baseline warnings.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; load_baseline_warnings(&quot;shader_defines.yaml&quot;)</span>
<span class="sd">        {&#39;x3206:implicit truncation&#39;: {&#39;code&#39;: &#39;X3206&#39;, &#39;message&#39;: &#39;implicit truncation&#39;, &#39;instances&#39;: {...}}}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">baseline_warnings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">config_file</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config_file</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">config_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">config_data</span> <span class="ow">and</span> <span class="s2">&quot;warnings&quot;</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">:</span>
                    <span class="n">baseline_warnings</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">[</span><span class="s2">&quot;warnings&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load baseline warnings from </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">baseline_warnings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.log_new_issues" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">log_new_issues</span><span class="p">(</span><span class="n">new_warnings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">defines_lookup</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.log_new_issues" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Log new warnings and errors to a unified file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>new_warnings</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of new warnings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errors</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of compilation errors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>results</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compilation results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_dir</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the log file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>defines_lookup</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lookup table for shader defines.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">log_new_issues</span><span class="p">(</span>
    <span class="n">new_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">defines_lookup</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log new warnings and errors to a unified file.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_warnings (list[dict]): List of new warnings.</span>
<span class="sd">        errors (dict): Dictionary of compilation errors.</span>
<span class="sd">        results (list[dict]): Compilation results.</span>
<span class="sd">        output_dir (str): Directory to save the log file.</span>
<span class="sd">        defines_lookup (dict): Lookup table for shader defines.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">issue_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;new_issues&quot;</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">issue_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;new_issues.log&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">issue_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">issue_handler</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Calculate totals</span>
    <span class="n">total_warnings</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">get_instance_count</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">new_warnings</span><span class="p">)</span>
    <span class="n">total_warning_entries</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">loc_data</span> <span class="ow">in</span> <span class="n">w</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">new_warnings</span>
    <span class="p">)</span>
    <span class="n">total_errors</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Header with summary</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;NEW SHADER COMPILATION ISSUES DETECTED&quot;</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report generated: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;New warnings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_warnings</span><span class="p">)</span><span class="si">}</span><span class="s2"> types, </span><span class="si">{</span><span class="n">total_warnings</span><span class="si">}</span><span class="s2"> instances, </span><span class="si">{</span><span class="n">total_warning_entries</span><span class="si">}</span><span class="s2"> shader combinations&quot;</span>
    <span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compilation errors: </span><span class="si">{</span><span class="n">total_errors</span><span class="si">}</span><span class="s2"> total errors&quot;</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Log compilation errors first (they&#39;re more critical)</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;COMPILATION ERRORS&quot;</span><span class="p">)</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">shader_key</span><span class="p">,</span> <span class="n">error_data</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">shader_file</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">shader_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">entry_point</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shader_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">shader_key</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>
            <span class="n">shader_type</span> <span class="o">=</span> <span class="n">error_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>

            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR in </span><span class="si">{</span><span class="n">shader_file</span><span class="si">}</span><span class="s2"> (entry: </span><span class="si">{</span><span class="n">entry_point</span><span class="si">}</span><span class="s2">, type: </span><span class="si">{</span><span class="n">shader_type</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

            <span class="c1"># Group errors by location for better context</span>
            <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">error_instances</span> <span class="ow">in</span> <span class="n">error_data</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Location: </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">error_instances</span><span class="p">:</span>
                    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Error Code: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Message: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;context&quot;</span><span class="p">):</span>
                        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;    Context: </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;shader_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;entry_point&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Log new warnings</span>
    <span class="k">if</span> <span class="n">new_warnings</span><span class="p">:</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;NEW WARNINGS&quot;</span><span class="p">)</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Sort warnings by total entry count (impact) - highest first</span>
        <span class="n">sorted_warnings</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">new_warnings</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">loc_data</span> <span class="ow">in</span> <span class="n">w</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">warning</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_warnings</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Calculate total entries for this warning</span>
            <span class="n">warning_entry_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">loc_data</span> <span class="ow">in</span> <span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Affected shader combinations: </span><span class="si">{</span><span class="n">warning_entry_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

            <span class="c1"># Show each location where this warning occurs</span>
            <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">location_data</span> <span class="ow">in</span> <span class="n">warning</span><span class="p">[</span><span class="s2">&quot;instances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">entry_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">location_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])</span>
                <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Location: </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">entry_count</span><span class="si">}</span><span class="s2"> combinations)&quot;</span><span class="p">)</span>

                <span class="c1"># Show the actual compilation output for this location</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">shader_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">normalize_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]))</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="n">shader_key</span> <span class="ow">in</span> <span class="n">location_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">):</span>
                            <span class="n">log_lines</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                            <span class="n">warning_lines</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_lines</span> <span class="k">if</span> <span class="n">warning</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">line</span>
                            <span class="p">]</span>
                            <span class="k">if</span> <span class="n">warning_lines</span><span class="p">:</span>
                                <span class="n">warning_line_index</span> <span class="o">=</span> <span class="n">log_lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">warning_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">context_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">warning_line_index</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
                                <span class="n">context_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_lines</span><span class="p">),</span> <span class="n">warning_line_index</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                                <span class="n">context</span> <span class="o">=</span> <span class="n">log_lines</span><span class="p">[</span><span class="n">context_start</span><span class="p">:</span><span class="n">context_end</span><span class="p">]</span>
                                <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Compiler output context:&quot;</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">ctx_line</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
                                    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">ctx_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">break</span>

                <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Summary section</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;SUMMARY&quot;</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ACTION REQUIRED: Fix </span><span class="si">{</span><span class="n">total_errors</span><span class="si">}</span><span class="s2"> compilation errors before proceeding.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_warnings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;RECOMMENDED: Address </span><span class="si">{</span><span class="n">total_warnings</span><span class="si">}</span><span class="s2"> new warnings across </span><span class="si">{</span><span class="n">total_warning_entries</span><span class="si">}</span><span class="s2"> shader combinations.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">total_errors</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">total_warnings</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No new issues detected - compilation is clean!&quot;</span><span class="p">)</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

    <span class="n">issue_handler</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">issue_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">issue_handler</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

<a href="#hlslkit.compile_shaders.main" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Main entry point for the shader compilation script.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exit code (0 for success, 1 for errors or excessive warnings).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for the shader compilation script.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Exit code (0 for success, 1 for errors or excessive warnings).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_jobs</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_arguments</span><span class="p">(</span><span class="n">default_jobs</span><span class="p">)</span>
    <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span> <span class="o">=</span> <span class="n">setup_environment</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">run_compilation</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Keyboard interrupt received&quot;</span><span class="p">)</span>
        <span class="n">handle_termination</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span> <span class="ow">and</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">suppress_warnings</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">suppress_warnings</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
        <span class="n">exit_code</span><span class="p">,</span> <span class="n">total_new_warnings</span><span class="p">,</span> <span class="n">error_count</span> <span class="o">=</span> <span class="n">analyze_and_report_results</span><span class="p">(</span>
            <span class="n">results</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">max_warnings</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Compilation was interrupted&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exit_code</span>

    <span class="n">suppress_warnings</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">suppress_warnings</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">code</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    <span class="n">exit_code</span><span class="p">,</span> <span class="n">total_new_warnings</span><span class="p">,</span> <span class="n">error_count</span> <span class="o">=</span> <span class="n">analyze_and_report_results</span><span class="p">(</span>
        <span class="n">results</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">max_warnings</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">exit_code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.manage_jobs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">manage_jobs</span><span class="p">(</span><span class="n">target_jobs</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">,</span> <span class="n">cpu_usages</span><span class="p">,</span> <span class="n">completed_tasks</span><span class="p">,</span> <span class="n">last_check</span><span class="p">,</span> <span class="n">check_interval</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.manage_jobs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Adjust the number of parallel jobs based on system resources.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>target_jobs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current number of jobs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpu_count</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>physical_cores</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Physical CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>is_ci</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether running in a CI environment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpu_usages</code></td>
            <td>
                  <code><span title="collections.deque">deque</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Recent CPU usage measurements.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>completed_tasks</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of completed tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>last_check</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time of last job adjustment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>check_interval</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interval between adjustments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>jobs_reason</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reason for current job count.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, str, float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, str, float]: Adjusted jobs, reason, and last check time.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">manage_jobs</span><span class="p">(</span>
    <span class="n">target_jobs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">cpu_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">physical_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">is_ci</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">cpu_usages</span><span class="p">:</span> <span class="n">deque</span><span class="p">,</span>
    <span class="n">completed_tasks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">last_check</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">check_interval</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">jobs_reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust the number of parallel jobs based on system resources.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_jobs (int): Current number of jobs.</span>
<span class="sd">        cpu_count (int): Total CPU cores.</span>
<span class="sd">        physical_cores (int | None): Physical CPU cores.</span>
<span class="sd">        is_ci (bool): Whether running in a CI environment.</span>
<span class="sd">        cpu_usages (deque): Recent CPU usage measurements.</span>
<span class="sd">        completed_tasks (int): Number of completed tasks.</span>
<span class="sd">        last_check (float): Time of last job adjustment.</span>
<span class="sd">        check_interval (float): Interval between adjustments.</span>
<span class="sd">        jobs_reason (str): Reason for current job count.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, str, float]: Adjusted jobs, reason, and last check time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">HAS_PSUTIL</span> <span class="ow">and</span> <span class="n">jobs_reason</span> <span class="o">!=</span> <span class="s2">&quot;user-specified&quot;</span> <span class="ow">and</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">last_check</span> <span class="o">&gt;=</span> <span class="n">check_interval</span><span class="p">:</span>
        <span class="n">new_jobs</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">adjust_target_jobs</span><span class="p">(</span>
            <span class="n">target_jobs</span><span class="p">,</span>
            <span class="n">cpu_count</span><span class="p">,</span>
            <span class="n">physical_cores</span><span class="p">,</span>
            <span class="n">is_ci</span><span class="p">,</span>
            <span class="n">cpu_usages</span><span class="p">,</span>
            <span class="n">completed_tasks</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">new_jobs</span> <span class="o">!=</span> <span class="n">target_jobs</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adjusted jobs to </span><span class="si">{</span><span class="n">new_jobs</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_jobs</span><span class="p">,</span> <span class="n">reason</span><span class="p">,</span> <span class="n">current_time</span>
    <span class="k">return</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="n">last_check</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.normalize_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.normalize_path" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Normalize a file path by removing the 'Shaders' prefix and standardizing path separators.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to normalize</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized file path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize a file path by removing the &#39;Shaders&#39; prefix and standardizing path separators.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path: The file path to normalize</span>

<span class="sd">    Returns:</span>
<span class="sd">        The normalized file path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># Always normalize slashes first</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="c1"># Split on &#39;Shaders&#39; (case-insensitive) followed by a slash or end of string</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?i)Shaders(?:/|$)&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">normalized</span>
    <span class="c1"># If no &#39;Shaders&#39; found, return the path with normalized slashes</span>
    <span class="k">return</span> <span class="n">file_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.parse_args_for_defaults" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_args_for_defaults</span><span class="p">()</span></code>

<a href="#hlslkit.compile_shaders.parse_args_for_defaults" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Parse command-line arguments to extract default values.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict[str, object]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, any]: Dictionary of default argument values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_args_for_defaults</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command-line arguments to extract default values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, any]: Dictionary of default argument values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arg_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">arg</span> <span class="o">!=</span> <span class="s2">&quot;--ignore-gooey&quot;</span><span class="p">]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;--fxc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--shader-dir&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--suppress-warnings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--optimization-level&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
                <span class="n">arg_dict</span><span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;--jobs&quot;</span><span class="p">,</span> <span class="s2">&quot;--max-warnings&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">arg_dict</span><span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--debug&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-g&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--gui&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--strip-debug-defines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--force-partial-precision&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">arg_dict</span><span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">arg_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.parse_arguments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_arguments</span><span class="p">(</span><span class="n">default_jobs</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.parse_arguments" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Parse command-line arguments for the shader compiler.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>default_jobs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default number of parallel jobs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>argparse.Namespace: Parsed command-line arguments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_arguments</span><span class="p">(</span><span class="n">default_jobs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command-line arguments for the shader compiler.</span>

<span class="sd">    Args:</span>
<span class="sd">        default_jobs (int): Default number of parallel jobs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        argparse.Namespace: Parsed command-line arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="n">parse_args_for_defaults</span><span class="p">()</span>
    <span class="n">is_gui_mode</span> <span class="o">=</span> <span class="n">HAS_GOOEY</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;--gui&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s2">&quot;-g&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">parser_class</span> <span class="o">=</span> <span class="n">GooeyParser</span> <span class="k">if</span> <span class="n">is_gui_mode</span> <span class="k">else</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_class</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Compile shaders using fxc.exe.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--fxc&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fxc&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to fxc.exe (optional if it&#39;s in PATH)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--shader-dir&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shader-dir&quot;</span><span class="p">,</span> <span class="s2">&quot;build/aio/Shaders&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory containing shader files&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--output-dir&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output-dir&quot;</span><span class="p">,</span> <span class="s2">&quot;build/ShaderCache&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory for compiled shaders&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Shader defines YAML file&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--jobs&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;jobs&quot;</span><span class="p">,</span> <span class="n">default_jobs</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of parallel jobs (default: dynamic, based on system usage)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--max-warnings&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max-warnings&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Warning control: positive=max new warnings, negative=must eliminate N baseline warnings, 0=no new warnings&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--suppress-warnings&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;suppress-warnings&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Comma-separated list of warning codes to suppress (e.g., X1519,X3206)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--strip-debug-defines&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;strip-debug-defines&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Strip debug defines for release shaders&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--optimization-level&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;optimization-level&quot;</span><span class="p">,</span>
            <span class="s2">&quot;3&quot;</span> <span class="k">if</span> <span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;strip-debug-defines&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Optimization level (0=none, 1=default, 2=aggressive, 3=max)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--force-partial-precision&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;force-partial-precision&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Force partial precision (16-bit floats) for performance&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--debug&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable debug output&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--debug-defines&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;debug-defines&quot;</span><span class="p">,</span> <span class="s2">&quot;DEBUG,_DEBUG,D3D_DEBUG_INFO,D3DCOMPILE_DEBUG,D3DCOMPILE_SKIP_OPTIMIZATION&quot;</span>
        <span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Comma-separated list of defines to treat as debug (default: common debug defines)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--extra-includes&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extra-includes&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Comma-separated list of additional include directories for fxc.exe&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_gui_mode</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="s2">&quot;--gui&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run with GUI&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Validate jobs argument</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">jobs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;--jobs must be a positive integer&quot;</span><span class="p">)</span>

    <span class="c1"># Pre-compute debug defines set to avoid repeated parsing</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_defines</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_defines</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">args</span><span class="o">.</span><span class="n">debug_defines_set</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">debug_defines</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">strip</span><span class="p">()}</span> <span class="ow">or</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">debug_defines_set</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">args</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.parse_shader_configs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_shader_configs</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.parse_shader_configs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Parse shader configurations from a YAML file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>config_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the YAML configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[tuple]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[tuple]: List of tuples containing (file_name, shader_type, entry_name, defines).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>parse_shader_configs("shader_defines.yaml")
[('test.hlsl', 'PSHADER', 'main:1234', ['A=1'])]</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_shader_configs</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse shader configurations from a YAML file.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file (str): Path to the YAML configuration file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple]: List of tuples containing (file_name, shader_type, entry_name, defines).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; parse_shader_configs(&quot;shader_defines.yaml&quot;)</span>
<span class="sd">        [(&#39;test.hlsl&#39;, &#39;PSHADER&#39;, &#39;main:1234&#39;, [&#39;A=1&#39;])]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&quot;shaders&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid shader configuration: missing &#39;shaders&#39; section&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shader</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shaders&quot;</span><span class="p">]:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">shader</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;configs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shader</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping shader </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">: missing &#39;configs&#39; section&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">shader</span><span class="p">[</span><span class="s2">&quot;configs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;entries&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">shader_type</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">: missing &#39;entries&#39;&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">common_defines</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;common_defines&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">common_defines</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;common_defines is not a list in shader config: </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">common_defines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
                <span class="n">entry_name</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">]</span>
                <span class="n">entry_defines</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defines&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry_defines</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;entry defines is not a list in shader config: </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">entry_defines</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">defines</span> <span class="o">=</span> <span class="n">flatten_defines</span><span class="p">(</span><span class="n">common_defines</span> <span class="o">+</span> <span class="n">entry_defines</span><span class="p">)</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">file_name</span><span class="p">,</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">entry_name</span><span class="p">,</span> <span class="n">defines</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">tasks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.process_completed_futures" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_completed_futures</span><span class="p">(</span><span class="n">completed_futures</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">completion_times</span><span class="p">,</span> <span class="n">pbar</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="n">window_seconds</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.process_completed_futures" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Process completed compilation tasks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>completed_futures</code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of completed futures.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>futures</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of futures to tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>results</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of compilation results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>completion_times</code></td>
            <td>
                  <code><span title="collections.deque">deque</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Recent completion times.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pbar</code></td>
            <td>
                  <code><span title="tqdm.tqdm">tqdm</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Progress bar.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_jobs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target number of jobs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>jobs_reason</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reason for current job count.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>window_seconds</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time window for rate calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, int]: Updated active tasks and completed tasks count.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_completed_futures</span><span class="p">(</span>
    <span class="n">completed_futures</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">futures</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">completion_times</span><span class="p">:</span> <span class="n">deque</span><span class="p">,</span>
    <span class="n">pbar</span><span class="p">:</span> <span class="n">tqdm</span><span class="p">,</span>
    <span class="n">target_jobs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">jobs_reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">window_seconds</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process completed compilation tasks.</span>

<span class="sd">    Args:</span>
<span class="sd">        completed_futures (list): List of completed futures.</span>
<span class="sd">        futures (dict): Mapping of futures to tasks.</span>
<span class="sd">        results (list[dict]): List of compilation results.</span>
<span class="sd">        completion_times (deque): Recent completion times.</span>
<span class="sd">        pbar (tqdm): Progress bar.</span>
<span class="sd">        target_jobs (int): Target number of jobs.</span>
<span class="sd">        jobs_reason (str): Reason for current job count.</span>
<span class="sd">        window_seconds (float): Time window for rate calculation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, int]: Updated active tasks and completed tasks count.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active_tasks</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">completed_tasks</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">completed_futures</span><span class="p">:</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
        <span class="n">active_tasks</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">completed_tasks</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error compiling </span><span class="si">{</span><span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">task</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">completion_times</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">completion_times</span> <span class="ow">and</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">completion_times</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">window_seconds</span><span class="p">:</span>
            <span class="n">completion_times</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>

        <span class="n">total_in_window</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">count</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">completion_times</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">completion_times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">window_duration</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">completion_times</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">total_in_window</span> <span class="o">/</span> <span class="n">window_duration</span> <span class="k">if</span> <span class="n">window_duration</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">postfix</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rate</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> shaders/s&quot;</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">jobs_reason</span> <span class="o">!=</span> <span class="s2">&quot;user-specified&quot;</span><span class="p">:</span>
                <span class="n">postfix</span><span class="p">[</span><span class="s2">&quot;jobs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_jobs</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span><span class="n">postfix</span><span class="p">)</span>

        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Completed task: active_tasks=</span><span class="si">{</span><span class="n">active_tasks</span><span class="si">}</span><span class="s2">, futures=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span><span class="si">}</span><span class="s2">, fxc_processes=</span><span class="si">{</span><span class="n">count_fxc_processes</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">active_tasks</span><span class="p">,</span> <span class="n">completed_tasks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.process_single_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_single_error</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.process_single_error" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Process a single error line from compilation output.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_single_error</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a single error line from compilation output.&quot;&quot;&quot;</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">ErrorHandler</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">handler</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.process_single_warning" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_single_warning</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">baseline_warnings</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">,</span> <span class="n">all_warnings</span><span class="p">,</span> <span class="n">new_warnings_dict</span><span class="p">,</span> <span class="n">suppressed_warnings_count</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.process_single_warning" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Process a single warning line from compilation output.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_single_warning</span><span class="p">(</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">baseline_warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">all_warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">new_warnings_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">suppressed_warnings_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process a single warning line from compilation output.&quot;&quot;&quot;</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">WarningHandler</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">handler</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">baseline_warnings</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">,</span> <span class="n">all_warnings</span><span class="p">,</span> <span class="n">new_warnings_dict</span><span class="p">,</span> <span class="n">suppressed_warnings_count</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.process_warnings_and_errors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_warnings_and_errors</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">baseline_warnings</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="p">,</span> <span class="n">defines_lookup</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.process_warnings_and_errors" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Process warnings and errors from shader compilation results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>results</code></td>
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of compilation results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>baseline_warnings</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Baseline warnings for comparison.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>suppress_warnings</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Warning codes to suppress.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>defines_lookup</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lookup table for shader defines.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[list[dict], dict, dict, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[list[dict], dict, dict, int]: New warnings, all warnings, errors, and suppressed warning count.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_warnings_and_errors</span><span class="p">(</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">baseline_warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">defines_lookup</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process warnings and errors from shader compilation results.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (list[dict]): List of compilation results.</span>
<span class="sd">        baseline_warnings (dict): Baseline warnings for comparison.</span>
<span class="sd">        suppress_warnings (list[str]): Warning codes to suppress.</span>
<span class="sd">        defines_lookup (dict): Lookup table for shader defines.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[list[dict], dict, dict, int]: New warnings, all warnings, errors, and suppressed warning count.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_warnings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">new_warnings_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">suppressed_warnings_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">suppress_warnings</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="n">suppress_warnings</span> <span class="ow">or</span> <span class="p">[])]</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">log_lines</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log_lines</span><span class="p">:</span>
            <span class="n">all_warnings</span><span class="p">,</span> <span class="n">new_warnings_dict</span><span class="p">,</span> <span class="n">suppressed_warnings_count</span> <span class="o">=</span> <span class="n">process_single_warning</span><span class="p">(</span>
                <span class="n">line</span><span class="p">,</span>
                <span class="n">result</span><span class="p">,</span>
                <span class="n">baseline_warnings</span><span class="p">,</span>
                <span class="n">suppress_warnings</span><span class="p">,</span>
                <span class="n">all_warnings</span><span class="p">,</span>
                <span class="n">new_warnings_dict</span><span class="p">,</span>
                <span class="n">suppressed_warnings_count</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">process_single_error</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">new_warnings_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
        <span class="n">all_warnings</span><span class="p">,</span>
        <span class="n">errors</span><span class="p">,</span>
        <span class="n">suppressed_warnings_count</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.run_compilation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_compilation</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.run_compilation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Run parallel shader compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>args</code></td>
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Command-line arguments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cpu_count</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>physical_cores</code></td>
            <td>
                  <code>int | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Physical CPU cores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>is_ci</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether running in a CI environment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict]: List of compilation results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_compilation</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run parallel shader compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        args (argparse.Namespace): Command-line arguments.</span>
<span class="sd">        cpu_count (int): Total CPU cores.</span>
<span class="sd">        physical_cores (int | None): Physical CPU cores.</span>
<span class="sd">        is_ci (bool): Whether running in a CI environment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict]: List of compilation results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_workers</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="n">tasks</span> <span class="o">=</span> <span class="n">initialize_compilation</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Starting compilation of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span><span class="si">}</span><span class="s2"> shader variants with </span><span class="si">{</span><span class="n">max_workers</span><span class="si">}</span><span class="s2"> max workers, </span><span class="si">{</span><span class="n">target_jobs</span><span class="si">}</span><span class="s2"> active jobs (</span><span class="si">{</span><span class="n">jobs_reason</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">completion_times</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
    <span class="n">window_seconds</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">active_tasks</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">futures</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">task_iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
    <span class="n">last_check</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">check_interval</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">cpu_usages</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">completed_tasks</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">with</span> <span class="p">(</span>
        <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">,</span>
        <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Compiling shaders&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;shader&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">while</span> <span class="n">futures</span> <span class="ow">or</span> <span class="n">task_iterator</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="k">break</span>

            <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="n">last_check</span> <span class="o">=</span> <span class="n">manage_jobs</span><span class="p">(</span>
                <span class="n">target_jobs</span><span class="p">,</span>
                <span class="n">cpu_count</span><span class="p">,</span>
                <span class="n">physical_cores</span><span class="p">,</span>
                <span class="n">is_ci</span><span class="p">,</span>
                <span class="n">cpu_usages</span><span class="p">,</span>
                <span class="n">completed_tasks</span><span class="p">,</span>
                <span class="n">last_check</span><span class="p">,</span>
                <span class="n">check_interval</span><span class="p">,</span>
                <span class="n">jobs_reason</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">active_tasks</span><span class="p">,</span> <span class="n">task_iterator</span> <span class="o">=</span> <span class="n">submit_tasks</span><span class="p">(</span>
                <span class="n">executor</span><span class="p">,</span> <span class="n">task_iterator</span><span class="p">,</span> <span class="n">active_tasks</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">shader_dir</span>
            <span class="p">)</span>

            <span class="n">completed_futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">futures</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">()]</span>
            <span class="n">active_tasks</span><span class="p">,</span> <span class="n">new_completed</span> <span class="o">=</span> <span class="n">process_completed_futures</span><span class="p">(</span>
                <span class="n">completed_futures</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">completion_times</span><span class="p">,</span> <span class="n">pbar</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">jobs_reason</span><span class="p">,</span> <span class="n">window_seconds</span>
            <span class="p">)</span>
            <span class="n">completed_tasks</span> <span class="o">+=</span> <span class="n">new_completed</span>

            <span class="k">if</span> <span class="n">futures</span> <span class="ow">and</span> <span class="n">active_tasks</span> <span class="o">&gt;=</span> <span class="n">target_jobs</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.setup_environment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_environment</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.setup_environment" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Set up the environment for shader compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>args</code></td>
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Command-line arguments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, int | None, bool]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, int | None, bool]: CPU count, physical cores, and CI environment flag.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_environment</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the environment for shader compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        args (argparse.Namespace): Command-line arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, int | None, bool]: CPU count, physical cores, and CI environment flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)],</span>
    <span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">handle_termination</span><span class="p">)</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">handle_termination</span><span class="p">)</span>
    <span class="n">is_ci</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;GITHUB_ACTIONS&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
    <span class="n">cpu_count</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">4</span>
    <span class="n">physical_cores</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">HAS_PSUTIL</span> <span class="ow">and</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(</span><span class="n">logical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">cpu_count</span><span class="p">,</span> <span class="n">physical_cores</span><span class="p">,</span> <span class="n">is_ci</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.submit_tasks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">submit_tasks</span><span class="p">(</span><span class="n">executor</span><span class="p">,</span> <span class="n">task_iterator</span><span class="p">,</span> <span class="n">active_tasks</span><span class="p">,</span> <span class="n">target_jobs</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">futures</span><span class="p">,</span> <span class="n">shader_dir</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.submit_tasks" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Submit compilation tasks to the executor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>executor</code></td>
            <td>
                  <code><span title="concurrent.futures.ThreadPoolExecutor">ThreadPoolExecutor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Thread pool executor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>task_iterator</code></td>
            <td>
                  <code>any</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Iterator over tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>active_tasks</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of active tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_jobs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target number of jobs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>args</code></td>
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Command-line arguments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>futures</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping of futures to tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_dir</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing shader files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[int, object]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, any]: Updated active tasks and task iterator.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">submit_tasks</span><span class="p">(</span>
    <span class="n">executor</span><span class="p">:</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">,</span>
    <span class="n">task_iterator</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>  <span class="c1"># Iterator cannot be typed precisely without collections.abc</span>
    <span class="n">active_tasks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">target_jobs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">futures</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">shader_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Submit compilation tasks to the executor.</span>

<span class="sd">    Args:</span>
<span class="sd">        executor (concurrent.futures.ThreadPoolExecutor): Thread pool executor.</span>
<span class="sd">        task_iterator (any): Iterator over tasks.</span>
<span class="sd">        active_tasks (int): Number of active tasks.</span>
<span class="sd">        target_jobs (int): Target number of jobs.</span>
<span class="sd">        args (argparse.Namespace): Command-line arguments.</span>
<span class="sd">        futures (dict): Mapping of futures to tasks.</span>
<span class="sd">        shader_dir (str): Directory containing shader files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, any]: Updated active tasks and task iterator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="n">active_tasks</span> <span class="o">&lt;</span> <span class="n">target_jobs</span> <span class="ow">and</span> <span class="n">task_iterator</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">task_iterator</span><span class="p">)</span>
            <span class="c1"># Parse extra includes from args</span>
            <span class="n">extra_includes</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">extra_includes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">extra_includes</span> <span class="k">else</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                <span class="n">compile_shader</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">fxc</span><span class="p">,</span>
                <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">task</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">task</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">task</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">),</span>
                <span class="n">shader_dir</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">strip_debug_defines</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">optimization_level</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">force_partial_precision</span><span class="p">,</span>
                <span class="n">args</span><span class="o">.</span><span class="n">debug_defines_set</span><span class="p">,</span>
                <span class="n">extra_includes</span><span class="p">,</span>  <span class="c1"># Pass extra includes</span>
            <span class="p">)</span>
            <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span>
            <span class="n">active_tasks</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Submitted task: active_tasks=</span><span class="si">{</span><span class="n">active_tasks</span><span class="si">}</span><span class="s2">, futures=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="n">task_iterator</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">active_tasks</span><span class="p">,</span> <span class="n">task_iterator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.compile_shaders.validate_shader_inputs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_shader_inputs</span><span class="p">(</span><span class="n">fxc_path</span><span class="p">,</span> <span class="n">shader_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">defines</span><span class="p">,</span> <span class="n">shader_dir</span><span class="p">)</span></code>

<a href="#hlslkit.compile_shaders.validate_shader_inputs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Validate inputs for shader compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fxc_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to fxc.exe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the shader file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_dir</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output directory for compiled shaders.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>defines</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of preprocessor defines.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_dir</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing shader files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str | None: Error message if validation fails, else None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>validate_shader_inputs("fxc.exe", "test.hlsl", "build", [], "src")        None</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>hlslkit/compile_shaders.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_shader_inputs</span><span class="p">(</span>
    <span class="n">fxc_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">shader_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">defines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">shader_dir</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate inputs for shader compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        fxc_path (str): Path to fxc.exe.</span>
<span class="sd">        shader_file (str): Path to the shader file.</span>
<span class="sd">        output_dir (str): Output directory for compiled shaders.</span>
<span class="sd">        defines (list[str]): List of preprocessor defines.</span>
<span class="sd">        shader_dir (str): Directory containing shader files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str | None: Error message if validation fails, else None.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; validate_shader_inputs(&quot;fxc.exe&quot;, &quot;test.hlsl&quot;, &quot;build&quot;, [], &quot;src&quot;)        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fxc_executable</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">fxc_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fxc_executable</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;fxc.exe not found in PATH or specified path&quot;</span>
    <span class="c1"># Determine if shader_dir is a file or directory</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">shader_dir</span><span class="p">):</span>
        <span class="n">shader_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">shader_file</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shader_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shader_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">shader_file</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">shader_file_path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">shader_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.hlsl&quot;</span><span class="p">,</span> <span class="s2">&quot;.hlsli&quot;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Invalid shader file: </span><span class="si">{</span><span class="n">shader_file</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">abs_output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">abs_output_dir</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Invalid output directory: </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">valid_define_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[a-zA-Z_][a-zA-Z0-9_]*(?:=[\w\d]+)?$&quot;</span><span class="p">)</span>
    <span class="n">invalid_defines</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defines</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_define_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">d</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">invalid_defines</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Invalid defines: </span><span class="si">{</span><span class="n">invalid_defines</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_source: true
</p>


<div class="doc doc-object doc-module">



<a id="hlslkit.generate_shader_defines"></a>
    <div class="doc doc-contents first">

        <p>Generate shader defines YAML from CommunityShaders log.</p>
<p>This script parses a <code>CommunityShaders.log</code> file to extract shader configurations, warnings, and errors.
It generates a <code>shader_defines.yaml</code> file summarizing shader entry points, preprocessor defines, and compilation issues.
The output is structured for use with <code>compile_shaders.py</code>.</p>


<details class="example" open>
  <summary>Example</summary>
  <pre><code class="language-bash">python generate_shader_defines.py --log CommunityShaders.log --output shader_defines.yaml
</code></pre>
</details>

<details class="dependencies" open>
  <summary>Dependencies</summary>
  <ul>
<li><code>yaml</code>: For generating YAML output.</li>
<li><code>tqdm</code>: For progress bars.</li>
<li><code>gooey</code> (optional): For GUI support.</li>
</ul>
</details>


  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="hlslkit.generate_shader_defines.CompilationTask" class="doc doc-heading">
            <code>CompilationTask</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#hlslkit.generate_shader_defines.CompilationTask" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>A shader compilation task extracted from the log.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="hlslkit.generate_shader_defines.CompilationTask.process_id">process_id</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Process ID of the compilation task.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="hlslkit.generate_shader_defines.CompilationTask.entry_point">entry_point</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shader entry point (e.g., 'main:vertex:1234').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="hlslkit.generate_shader_defines.CompilationTask.file_path">file_path</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the shader file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="hlslkit.generate_shader_defines.CompilationTask.defines">defines</span></code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preprocessor defines used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="hlslkit.generate_shader_defines.CompilationTask.start_time">start_time</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time of the compilation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="hlslkit.generate_shader_defines.CompilationTask.end_time">end_time</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time of the compilation, if completed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CompilationTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A shader compilation task extracted from the log.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        process_id (str): Process ID of the compilation task.</span>
<span class="sd">        entry_point (str): Shader entry point (e.g., &#39;main:vertex:1234&#39;).</span>
<span class="sd">        file_path (str): Path to the shader file.</span>
<span class="sd">        defines (list[str]): Preprocessor defines used.</span>
<span class="sd">        start_time (datetime): Start time of the compilation.</span>
<span class="sd">        end_time (datetime | None): End time of the compilation, if completed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">process_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">entry_point</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">defines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.collect_tasks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_tasks</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.collect_tasks" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Collect compilation tasks from log lines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lines</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of log lines to parse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[<a class="autorefs autorefs-internal" title="hlslkit.generate_shader_defines.CompilationTask" href="#hlslkit.generate_shader_defines.CompilationTask">CompilationTask</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[CompilationTask]: List of extracted compilation tasks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">collect_tasks</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CompilationTask</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect compilation tasks from log lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        lines (list[str]): List of log lines to parse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[CompilationTask]: List of extracted compilation tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">compile_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;\[(\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">\.\d</span><span class="si">{3}</span><span class="s2">)\] \[(\d+)\] \[D\] Compiling (.*?)\s+([^:]+:[^:]+:[0-9a-fA-F]+)\s+to\s+(.*)$&quot;</span>
    <span class="p">)</span>
    <span class="n">compiled_shader_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;\[(\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">\.\d</span><span class="si">{3}</span><span class="s2">)\] \[(\d+)\] \[D\] Compiled shader ([^:]+:[^:]+:[0-9a-fA-F]+)&quot;</span>
    <span class="p">)</span>
    <span class="n">completed_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;\[(\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">\.\d</span><span class="si">{3}</span><span class="s2">)\] \[(\d+)\] \[D\] Adding Completed shader to map: ([^:]+:[^:]+:[0-9a-fA-F]+)(?::.*)?$&quot;</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">compile_match</span> <span class="o">=</span> <span class="n">compile_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compile_match</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">process_id</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">entry_point</span><span class="p">,</span> <span class="n">compile_args</span> <span class="o">=</span> <span class="n">compile_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">defines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\S+=[\w\d]+|\S+&quot;</span><span class="p">,</span> <span class="n">compile_args</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">CompilationTask</span><span class="p">(</span>
                    <span class="n">process_id</span><span class="o">=</span><span class="n">process_id</span><span class="p">,</span>
                    <span class="n">entry_point</span><span class="o">=</span><span class="n">entry_point</span><span class="p">,</span>
                    <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
                    <span class="n">defines</span><span class="o">=</span><span class="n">defines</span><span class="p">,</span>
                    <span class="n">start_time</span><span class="o">=</span><span class="n">parse_timestamp</span><span class="p">(</span><span class="n">line</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">compiled_match</span> <span class="o">=</span> <span class="n">compiled_shader_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compiled_match</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">process_id</span><span class="p">,</span> <span class="n">entry_point</span> <span class="o">=</span> <span class="n">compiled_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">process_id</span> <span class="o">==</span> <span class="n">process_id</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">entry_point</span> <span class="o">==</span> <span class="n">entry_point</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">task</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">parse_timestamp</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">continue</span>

        <span class="n">completed_match</span> <span class="o">=</span> <span class="n">completed_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">completed_match</span><span class="p">:</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">process_id</span><span class="p">,</span> <span class="n">entry_point</span> <span class="o">=</span> <span class="n">completed_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">process_id</span> <span class="o">==</span> <span class="n">process_id</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">entry_point</span> <span class="o">==</span> <span class="n">entry_point</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">task</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">parse_timestamp</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">tasks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.collect_warnings_and_errors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_warnings_and_errors</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">tasks</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">total_logs</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.collect_warnings_and_errors" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Collect warnings and errors from log lines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>lines</code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of log lines.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>tasks</code></td>
            <td>
                  <code>list[<a class="autorefs autorefs-internal" title="hlslkit.generate_shader_defines.CompilationTask" href="#hlslkit.generate_shader_defines.CompilationTask">CompilationTask</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of compilation tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>warnings</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store warnings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errors</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store errors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>total_logs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of log blocks to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[dict, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[dict, dict]: Updated warnings and errors dictionaries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">collect_warnings_and_errors</span><span class="p">(</span>
    <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">tasks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CompilationTask</span><span class="p">],</span>
    <span class="n">warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">total_logs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect warnings and errors from log lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        lines (list[str]): List of log lines.</span>
<span class="sd">        tasks (list[CompilationTask]): List of compilation tasks.</span>
<span class="sd">        warnings (dict): Dictionary to store warnings.</span>
<span class="sd">        errors (dict): Dictionary to store errors.</span>
<span class="sd">        total_logs (int): Total number of log blocks to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[dict, dict]: Updated warnings and errors dictionaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warning_entry_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(.*?)\((\d+(?:,\d+(?:-\d+)?|\:\d+)?)\): warning (\w+): (.+)$&quot;</span><span class="p">)</span>
    <span class="n">error_e_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;\[\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">\.\d</span><span class="si">{3}</span><span class="s2">\] \[(\d+)\] \[E\] Failed to compile Pixel shader ([^:]+::[0-9a-fA-F]+):\n(.*?)\((\d+(?:,\d+(?:-\d+)?))\): error (\w+): (.+)$&quot;</span><span class="p">,</span>
        <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">error_w_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;\[\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">\.\d</span><span class="si">{3}</span><span class="s2">\] \[(\d+)\] \[W\] Shader compilation failed:\n(.*?):(\d+(?::\d+))\: (\w+): (.+)$&quot;</span><span class="p">,</span>
        <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">completed_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;\[(\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">\.\d</span><span class="si">{3}</span><span class="s2">)\] \[(\d+)\] \[D\] Adding Completed shader to map: ([^:]+:[^:]+:[0-9a-fA-F]+)(?::.*)?$&quot;</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total_logs</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Parsing logs (warnings/errors)&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;block&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">shader_log_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[(\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">:\d</span><span class="si">{2}</span><span class="s2">\.\d</span><span class="si">{3}</span><span class="s2">)\] \[(\d+)\] \[D\] Shader logs:&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shader_log_match</span><span class="p">:</span>
                <span class="n">timestamp</span><span class="p">,</span> <span class="n">current_process_id</span> <span class="o">=</span> <span class="n">shader_log_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                <span class="n">current_time</span> <span class="o">=</span> <span class="n">parse_timestamp</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">current_warnings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                    <span class="n">next_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">next_line</span> <span class="ow">or</span> <span class="n">next_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="n">warning_match</span> <span class="o">=</span> <span class="n">warning_entry_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">next_line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">warning_match</span><span class="p">:</span>
                        <span class="n">file_path</span><span class="p">,</span> <span class="n">line_info</span><span class="p">,</span> <span class="n">warning_code</span><span class="p">,</span> <span class="n">warning_msg</span> <span class="o">=</span> <span class="n">warning_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                        <span class="n">norm_file_path</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="n">location</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">norm_file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_info</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">current_warnings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">warning_code</span><span class="p">,</span> <span class="n">warning_msg</span><span class="p">,</span> <span class="n">location</span><span class="p">))</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">task</span><span class="o">.</span><span class="n">process_id</span> <span class="o">==</span> <span class="n">current_process_id</span>
                        <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&lt;=</span> <span class="n">current_time</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">task</span><span class="o">.</span><span class="n">end_time</span> <span class="o">&gt;=</span> <span class="n">current_time</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">entry_point</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">entry_point</span>
                        <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">current_warnings</span><span class="p">:</span>
                            <span class="n">warning_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">warning_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
                                <span class="n">warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                    <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
                                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                                    <span class="s2">&quot;instances&quot;</span><span class="p">:</span> <span class="p">{},</span>
                                <span class="p">}</span>
                            <span class="n">location_lower</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">location_lower</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">]:</span>
                                <span class="n">warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location_lower</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[]}</span>
                            <span class="k">if</span> <span class="n">entry_point</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location_lower</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
                                <span class="n">warnings</span><span class="p">[</span><span class="n">warning_key</span><span class="p">][</span><span class="s2">&quot;instances&quot;</span><span class="p">][</span><span class="n">location_lower</span><span class="p">][</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry_point</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">continue</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">error_e_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">process_id</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">entry_point</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">line_info</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">error_code</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">process_id</span> <span class="o">==</span> <span class="n">process_id</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">entry_point</span> <span class="o">==</span> <span class="n">entry_point</span><span class="p">:</span>
                        <span class="n">file_name</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entry_point</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                            <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">norm_file_path</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="n">error_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">norm_file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_info</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="k">if</span> <span class="n">error_text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_text</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">error_w_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">process_id</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">line_info</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">error_code</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">process_id</span> <span class="o">==</span> <span class="n">process_id</span><span class="p">:</span>
                        <span class="n">file_name</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="n">entry_point</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">entry_point</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">entry_point</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                            <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">norm_file_path</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="n">error_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">norm_file_path</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">line_info</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="k">if</span> <span class="n">error_text</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">errors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_text</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">match</span> <span class="o">=</span> <span class="n">completed_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.compute_common_defines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_common_defines</span><span class="p">(</span><span class="n">shader_configs</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.compute_common_defines" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute common defines across shaders, types, and files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>shader_configs</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shader configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    tuple[list, dict, dict]: Global common defines, type-specific common defines, and file-type-specific common defines.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_common_defines</span><span class="p">(</span><span class="n">shader_configs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute common defines across shaders, types, and files.</span>

<span class="sd">    Args:</span>
<span class="sd">        shader_configs (dict): Shader configurations.</span>
<span class="sd">    Returns:</span>
<span class="sd">        tuple[list, dict, dict]: Global common defines, type-specific common defines, and file-type-specific common defines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_defines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">file_configs</span> <span class="ow">in</span> <span class="n">shader_configs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">configs</span> <span class="ow">in</span> <span class="n">file_configs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">configs</span>
    <span class="p">]</span>
    <span class="n">global_common</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">all_defines</span><span class="p">]))</span> <span class="k">if</span> <span class="n">all_defines</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">defines_by_type</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;CSHADER&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="k">for</span> <span class="n">file_configs</span> <span class="ow">in</span> <span class="n">shader_configs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">configs</span> <span class="ow">in</span> <span class="n">file_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
                <span class="n">defines_by_type</span><span class="p">[</span><span class="n">shader_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">])</span>
    <span class="n">type_common</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">defines_list</span> <span class="ow">in</span> <span class="n">defines_by_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">type_common</span><span class="p">[</span><span class="n">shader_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defines_list</span><span class="p">]))</span> <span class="k">if</span> <span class="n">defines_list</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">type_common</span><span class="p">[</span><span class="n">shader_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">type_common</span><span class="p">[</span><span class="n">shader_type</span><span class="p">]</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">global_common</span><span class="p">])</span>
    <span class="n">file_type_common</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_configs</span> <span class="ow">in</span> <span class="n">shader_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">file_type_common</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;CSHADER&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">configs</span> <span class="ow">in</span> <span class="n">file_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">file_type_common</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="n">shader_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">])</span> <span class="k">if</span> <span class="n">configs</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">file_type_common</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="n">shader_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span>
                <span class="n">d</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">file_type_common</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="n">shader_type</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">global_common</span> <span class="ow">and</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_common</span><span class="p">[</span><span class="n">shader_type</span><span class="p">]</span>
            <span class="p">])</span>
    <span class="k">return</span> <span class="n">global_common</span><span class="p">,</span> <span class="n">type_common</span><span class="p">,</span> <span class="n">file_type_common</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.count_compiling_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_compiling_lines</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.count_compiling_lines" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Count the number of compilation log lines in a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>log_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the log file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of lines containing '[D] Compiling'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_compiling_lines</span><span class="p">(</span><span class="n">log_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the number of compilation log lines in a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        log_file (str): Path to the log file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Number of lines containing &#39;[D] Compiling&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">if</span> <span class="s2">&quot;[D] Compiling&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.count_log_blocks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_log_blocks</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.count_log_blocks" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Count the number of log blocks (warnings, errors, completions) in a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>log_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the log file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of log blocks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_log_blocks</span><span class="p">(</span><span class="n">log_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the number of log blocks (warnings, errors, completions) in a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        log_file (str): Path to the log file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Number of log blocks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="mi">1</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">keyword</span> <span class="ow">in</span> <span class="n">line</span>
                <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s2">&quot;[D] Shader logs:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;[E] Failed to compile&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;[W] Shader compilation failed&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;[D] Adding Completed shader&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.generate_yaml_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_yaml_data</span><span class="p">(</span><span class="n">shader_configs</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.generate_yaml_data" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate YAML data structure from shader configurations, warnings, and errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>shader_configs</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shader configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>warnings</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compilation warnings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>errors</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compilation errors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    dict: YAML-compatible data structure.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_yaml_data</span><span class="p">(</span><span class="n">shader_configs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">warnings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate YAML data structure from shader configurations, warnings, and errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        shader_configs (dict): Shader configurations.</span>
<span class="sd">        warnings (dict): Compilation warnings.</span>
<span class="sd">        errors (dict): Compilation errors.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: YAML-compatible data structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">global_common</span><span class="p">,</span> <span class="n">type_common</span><span class="p">,</span> <span class="n">file_type_common</span> <span class="o">=</span> <span class="n">compute_common_defines</span><span class="p">(</span><span class="n">shader_configs</span><span class="p">)</span>
    <span class="n">yaml_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;common_defines&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">global_common</span><span class="p">),</span>
        <span class="s2">&quot;common_pshader_defines&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">type_common</span><span class="p">[</span><span class="s2">&quot;PSHADER&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;common_vshader_defines&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">type_common</span><span class="p">[</span><span class="s2">&quot;VSHADER&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;common_cshader_defines&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">type_common</span><span class="p">[</span><span class="s2">&quot;CSHADER&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;file_common_defines&quot;</span><span class="p">:</span> <span class="n">file_type_common</span><span class="p">,</span>
        <span class="s2">&quot;warnings&quot;</span><span class="p">:</span> <span class="n">warnings</span><span class="p">,</span>
        <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">errors</span><span class="p">,</span>
        <span class="s2">&quot;shaders&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_configs</span> <span class="ow">in</span> <span class="n">shader_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">shader_entry</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;configs&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">for</span> <span class="n">shader_type</span><span class="p">,</span> <span class="n">configs</span> <span class="ow">in</span> <span class="n">file_configs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">configs</span><span class="p">:</span>
                <span class="n">common_defines</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">defines</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">global_common</span><span class="p">,</span>
                    <span class="n">type_common</span><span class="p">[</span><span class="n">shader_type</span><span class="p">],</span>
                    <span class="n">file_type_common</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="n">shader_type</span><span class="p">],</span>
                <span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">defines</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">common_defines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">defines</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">defines</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                        <span class="n">common_defines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">defines</span><span class="p">))</span>
                <span class="n">shader_entry</span><span class="p">[</span><span class="s2">&quot;configs&quot;</span><span class="p">][</span><span class="n">shader_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;common_defines&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">common_defines</span><span class="p">),</span>
                    <span class="s2">&quot;entries&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;defines&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">([</span>
                                <span class="n">d</span>
                                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">global_common</span>
                                <span class="ow">and</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_common</span><span class="p">[</span><span class="n">shader_type</span><span class="p">]</span>
                                <span class="ow">and</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_type_common</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="n">shader_type</span><span class="p">]</span>
                            <span class="p">]),</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">configs</span>
                    <span class="p">],</span>
                <span class="p">}</span>
        <span class="k">if</span> <span class="n">shader_entry</span><span class="p">[</span><span class="s2">&quot;configs&quot;</span><span class="p">]:</span>
            <span class="n">yaml_data</span><span class="p">[</span><span class="s2">&quot;shaders&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shader_entry</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yaml_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.get_shader_type_from_entry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_shader_type_from_entry</span><span class="p">(</span><span class="n">entry_point</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.get_shader_type_from_entry" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Determine the shader type from an entry point string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>entry_point</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The entry point string (e.g., 'main:vertex:1234').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shader type (VSHADER, PSHADER, CSHADER, or UNKNOWN).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_shader_type_from_entry</span><span class="p">(</span><span class="n">entry_point</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the shader type from an entry point string.</span>

<span class="sd">    Args:</span>
<span class="sd">        entry_point (str): The entry point string (e.g., &#39;main:vertex:1234&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The shader type (VSHADER, PSHADER, CSHADER, or UNKNOWN).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">shader_type</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">shader_types</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vertex&quot;</span><span class="p">:</span> <span class="s2">&quot;VSHADER&quot;</span><span class="p">,</span> <span class="s2">&quot;pixel&quot;</span><span class="p">:</span> <span class="s2">&quot;PSHADER&quot;</span><span class="p">,</span> <span class="s2">&quot;compute&quot;</span><span class="p">:</span> <span class="s2">&quot;CSHADER&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">shader_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shader_type</span><span class="p">,</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;UNKNOWN&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

<a href="#hlslkit.generate_shader_defines.main" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Main entry point for generating shader defines from a log file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exit code (0 for success, 1 for errors).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for generating shader defines from a log file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Exit code (0 for success, 1 for errors).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_arguments</span><span class="p">()</span>
    <span class="n">log_level</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s2">&quot;log_level&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
        <span class="n">level</span><span class="o">=</span><span class="n">log_level</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)],</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">log</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log file not found: </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">log</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">shader_configs</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">parse_log</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
    <span class="n">yaml_data</span> <span class="o">=</span> <span class="n">generate_yaml_data</span><span class="p">(</span><span class="n">shader_configs</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
    <span class="n">save_yaml</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="n">total_variants</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span> <span class="k">for</span> <span class="n">file_configs</span> <span class="ow">in</span> <span class="n">shader_configs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">configs</span> <span class="ow">in</span> <span class="n">file_configs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">[</span><span class="s1">&#39;shaders&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> shaders, </span><span class="si">{</span><span class="n">total_variants</span><span class="si">}</span><span class="s2"> variants, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique warnings, and </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">errors</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2"> errors&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.normalize_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.normalize_path" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Normalize a file path by standardizing separators and extracting relative path.    This function ensures paths are consistent across platforms, converting backslashes to forward slashes
and attempting to extract the relative path from the <code>Shaders</code> directory (case-insensitive). If the
<code>Shaders</code> directory is not found, the path is returned as-is with normalized separators.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to normalize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized file path, relative to the Shaders directory if present.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize a file path by standardizing separators and extracting relative path.    This function ensures paths are consistent across platforms, converting backslashes to forward slashes</span>
<span class="sd">    and attempting to extract the relative path from the `Shaders` directory (case-insensitive). If the</span>
<span class="sd">    `Shaders` directory is not found, the path is returned as-is with normalized separators.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The file path to normalize.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The normalized file path, relative to the Shaders directory if present.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/+&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?i).*?\bShaders[/](.*)&quot;</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">norm_path</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normalized path (Shaders found): </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">norm_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm_path</span>
    <span class="n">norm_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normalized path (no Shaders, using as-is): </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">norm_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">norm_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.optimize_anchor_deduplication" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">optimize_anchor_deduplication</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.optimize_anchor_deduplication" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Pre-process data to maximize anchor reuse with O(n log n) complexity.
Returns (optimized_data, stats_dict)</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">optimize_anchor_deduplication</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pre-process data to maximize anchor reuse with O(n log n) complexity.</span>
<span class="sd">    Returns (optimized_data, stats_dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">list_counts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">list_instances</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">make_hashable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">make_hashable</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">collect_lists</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_counts</span><span class="p">:</span>
                    <span class="n">list_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">list_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">list_instances</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> -&gt; key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">RecursionError</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping unhashable list at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="n">collect_lists</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">[</span><span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">idx</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">collect_lists</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>

    <span class="n">collect_lists</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_counts</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique lists&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">list_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> appears </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> times&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_list</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">reconstruct_list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="n">sorted_lists</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">list_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">shared_objects</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">anchor_ref_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">_size</span> <span class="ow">in</span> <span class="n">sorted_lists</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shared_objects</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">reconstruct_list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating shared object for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> (used </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> times)&quot;</span><span class="p">)</span>
            <span class="n">anchor_ref_count</span> <span class="o">+=</span> <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Each additional use is an alias</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">shared_objects</span><span class="p">)</span><span class="si">}</span><span class="s2"> shared objects&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">replace_with_shared</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">make_hashable</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">shared_objects</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Replacing list at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> with shared object&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">shared_objects</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">RecursionError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">replace_with_shared</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">replace_with_shared</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="n">optimized</span> <span class="o">=</span> <span class="n">replace_with_shared</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;total_lists&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_instances</span><span class="p">),</span>
        <span class="s2">&quot;unique_lists&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_counts</span><span class="p">),</span>
        <span class="s2">&quot;anchored_lists&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">shared_objects</span><span class="p">),</span>
        <span class="s2">&quot;anchor_references&quot;</span><span class="p">:</span> <span class="n">anchor_ref_count</span><span class="p">,</span>
        <span class="s2">&quot;max_anchor_usage&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="n">count</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">list_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">optimized</span><span class="p">,</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.parse_arguments" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_arguments</span><span class="p">()</span></code>

<a href="#hlslkit.generate_shader_defines.parse_arguments" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Parse command-line arguments for the shader defines generator.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="argparse.Namespace">Namespace</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>argparse.Namespace: Parsed command-line arguments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_arguments</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command-line arguments for the shader defines generator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        argparse.Namespace: Parsed command-line arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_gui_mode</span> <span class="o">=</span> <span class="n">HAS_GOOEY</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;--gui&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s2">&quot;-g&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">parser_class</span> <span class="o">=</span> <span class="n">GooeyParser</span> <span class="k">if</span> <span class="n">is_gui_mode</span> <span class="k">else</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_class</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Generate shader defines from CommunityShaders log.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--log&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;CommunityShaders.log&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to CommunityShaders log file&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--output&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;shader_defines.yaml&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output YAML file for shader defines&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="s2">&quot;--debug&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enable debug logging&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--log-level&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set the logging level (default: INFO)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_gui_mode</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-g&quot;</span><span class="p">,</span> <span class="s2">&quot;--gui&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run with GUI&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.parse_log" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_log</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">update_configs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_warnings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.parse_log" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Parse a CommunityShaders log file to extract shader configurations, warnings, and errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>log_file</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the log file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>update_configs</code></td>
            <td>
                  <code>dict | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing shader configurations to update (optional).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>update_warnings</code></td>
            <td>
                  <code>dict | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing warnings to update (optional).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>update_errors</code></td>
            <td>
                  <code>dict | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Existing errors to update (optional).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple[dict, dict, dict]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[dict, dict, dict]: Shader configurations, warnings, and errors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_log</span><span class="p">(</span>
    <span class="n">log_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">update_configs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">update_warnings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">update_errors</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a CommunityShaders log file to extract shader configurations, warnings, and errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        log_file (str): Path to the log file.</span>
<span class="sd">        update_configs (dict | None): Existing shader configurations to update (optional).</span>
<span class="sd">        update_warnings (dict | None): Existing warnings to update (optional).</span>
<span class="sd">        update_errors (dict | None): Existing errors to update (optional).</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[dict, dict, dict]: Shader configurations, warnings, and errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shader_configs</span> <span class="o">=</span> <span class="n">update_configs</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="n">update_warnings</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">update_errors</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="n">collect_tasks</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">shader_configs</span> <span class="o">=</span> <span class="n">populate_configs</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">shader_configs</span><span class="p">)</span>
    <span class="n">total_logs</span> <span class="o">=</span> <span class="n">count_log_blocks</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>
    <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">collect_warnings_and_errors</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">tasks</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">total_logs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">shader_configs</span><span class="p">,</span> <span class="n">warnings</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.parse_timestamp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_timestamp</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.parse_timestamp" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Parse a timestamp from a log line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>line</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The log line containing a timestamp.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>datetime</code></td>            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parsed datetime object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_timestamp</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a timestamp from a log line.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (str): The log line containing a timestamp.</span>

<span class="sd">    Returns:</span>
<span class="sd">        datetime: The parsed datetime object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestamp_str</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">timestamp_str</span><span class="p">,</span> <span class="s2">&quot;%H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.populate_configs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">populate_configs</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">shader_configs</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.populate_configs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Populate shader configurations from compilation tasks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>tasks</code></td>
            <td>
                  <code>list[<a class="autorefs autorefs-internal" title="hlslkit.generate_shader_defines.CompilationTask" href="#hlslkit.generate_shader_defines.CompilationTask">CompilationTask</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of compilation tasks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>shader_configs</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store shader configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated shader configurations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">populate_configs</span><span class="p">(</span><span class="n">tasks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CompilationTask</span><span class="p">],</span> <span class="n">shader_configs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Populate shader configurations from compilation tasks.</span>

<span class="sd">    Args:</span>
<span class="sd">        tasks (list[CompilationTask]): List of compilation tasks.</span>
<span class="sd">        shader_configs (dict): Dictionary to store shader configurations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Updated shader configurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total_lines</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Parsing compiling lines&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">normalize_path</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_path</span>
            <span class="n">entry_point</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">entry_point</span>
            <span class="n">shader_type</span> <span class="o">=</span> <span class="n">get_shader_type_from_entry</span><span class="p">(</span><span class="n">entry_point</span><span class="p">)</span>
            <span class="n">defines</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">defines</span><span class="p">)</span>  <span class="c1"># Sort for better anchor deduplication</span>

            <span class="k">if</span> <span class="n">file_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shader_configs</span><span class="p">:</span>
                <span class="n">shader_configs</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;PSHADER&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;VSHADER&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;CSHADER&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">}</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;entry&quot;</span><span class="p">:</span> <span class="n">entry_point</span><span class="p">,</span> <span class="s2">&quot;defines&quot;</span><span class="p">:</span> <span class="n">defines</span><span class="p">}</span>
            <span class="n">existing_configs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">shader_configs</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="n">shader_type</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;entry&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">existing_configs</span><span class="p">:</span>
                <span class="n">existing</span> <span class="o">=</span> <span class="n">existing_configs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">existing</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Warning: Updating defines for </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">shader_type</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">existing</span><span class="p">[</span><span class="s1">&#39;defines&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;defines&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">existing</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;defines&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shader_configs</span><span class="p">[</span><span class="n">file_name</span><span class="p">][</span><span class="n">shader_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">shader_configs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hlslkit.generate_shader_defines.save_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_yaml</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span></code>

<a href="#hlslkit.generate_shader_defines.save_yaml" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Save the YAML data to a file, using anchors for repeated lists to reduce repetition.
The data is pre-processed by optimize_anchor_deduplication() to maximize anchor usage
with O(n log n) complexity instead of the previous (n) approach.
Args:
    yaml_data (dict): YAML data to save.
    output_file (str): Path to the output YAML file.</p>

            <details class="quote">
              <summary>Source code in <code>hlslkit/generate_shader_defines.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_yaml</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the YAML data to a file, using anchors for repeated lists to reduce repetition.</span>
<span class="sd">    The data is pre-processed by optimize_anchor_deduplication() to maximize anchor usage</span>
<span class="sd">    with O(n log n) complexity instead of the previous (n) approach.</span>
<span class="sd">    Args:</span>
<span class="sd">        yaml_data (dict): YAML data to save.</span>
<span class="sd">        output_file (str): Path to the output YAML file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">OptimizedAnchorDumper</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">SafeDumper</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_anchor_id</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">ignore_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">represent_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">flow_style</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">obj_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_map</span><span class="p">:</span>
                <span class="n">anchor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_map</span><span class="p">[</span><span class="n">obj_id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">anchor</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_seen_objects&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">obj_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seen_objects</span><span class="p">:</span>
                        <span class="n">anchor</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;anchor_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_anchor_id</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_next_anchor_id</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_anchor_map</span><span class="p">[</span><span class="n">obj_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">anchor</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_seen_objects</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_seen_objects</span> <span class="o">=</span> <span class="p">{</span><span class="n">obj_id</span><span class="p">}</span>
            <span class="n">node</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">represent_sequence</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">flow_style</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">anchor</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">anchor</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="k">return</span> <span class="n">node</span>

    <span class="n">deduped</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">optimize_anchor_deduplication</span><span class="p">(</span><span class="n">yaml_data</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
            <span class="n">deduped</span><span class="p">,</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="n">Dumper</span><span class="o">=</span><span class="n">OptimizedAnchorDumper</span><span class="p">,</span>
            <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Deduplication stats: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_lists&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> total lists, </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;unique_lists&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> unique &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;unique_lists&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_lists&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% unique), &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;anchored_lists&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> anchored (</span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;anchored_lists&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_lists&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of total), &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;anchor_references&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> references saved &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;(reduction: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;anchor_references&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_lists&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;unique_lists&#39;</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of duplicates)&quot;</span>
        <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;total_lists&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;unique_lists&quot;</span><span class="p">]</span>
        <span class="k">else</span> <span class="s2">&quot;no duplicates found&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_source: true</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maintained by <a href="https://github.com/alandtse/">alandtse</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/alandtse/hlslkit" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/hlslkit" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>